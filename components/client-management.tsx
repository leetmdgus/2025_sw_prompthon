"use client"

import { useState, useEffect, useRef, useCallback, useMemo, memo } from "react"
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card"
import { Button } from "@/components/ui/button"
import { Badge } from "@/components/ui/badge"
import { Avatar, AvatarFallback, AvatarImage } from "@/components/ui/avatar"
import { Input } from "@/components/ui/input"
import {
  ArrowLeft,
  Search,
  Phone,
  MapPin,
  User,
  Calendar,
  TrendingUp,
  TrendingDown,
  Minus,
  MessageCircle,
  Brain,
  BarChart3,
  RefreshCw,
} from "lucide-react"
import { AICounselingGuide } from "./ai-counseling-guide"
import { EmotionalStateTracking } from "./emotional-state-tracking"

interface Client {
  id: string
  name: string
  photo?: string
  birthDate: string
  age: number
  phone: string
  address: string
  guardian: {
    name: string
    phone: string
    relationship: string
  }
  lastVisit: string
  emotionalState: {
    current: "ì¢‹ìŒ" | "ë³´í†µ" | "ì£¼ì˜" | "ìœ„í—˜"
    trend: "ê°œì„ " | "ìœ ì§€" | "ì•…í™”"
    summary: string
  }
  priority: "ë†’ìŒ" | "ë³´í†µ" | "ë‚®ìŒ"
  totalSessions: number
}

interface CounselingRecord {
  id: string
  date: string
  type: "ì •ê¸°" | "ê¸´ê¸‰" | "ì´ˆê¸°"
  duration: number
  emotionalScores: {
    depression: number
    anxiety: number
    loneliness: number
    anger: number
  }
  notes: string
  aiSummary: string
  autoSummary?: string
}

const mockClients: Client[] = [
  {
    id: "1",
    name: "ê¹€ìˆœì• ",
    birthDate: "1945-03-15",
    age: 79,
    phone: "010-1234-5678",
    address: "ì„œìš¸ì‹œ ì¢…ë¡œêµ¬ ì²­ìš´ë™ 123-45",
    guardian: {
      name: "ê¹€ì˜ìˆ˜",
      phone: "010-9876-5432",
      relationship: "ì•„ë“¤",
    },
    lastVisit: "2024-01-10",
    emotionalState: {
      current: "ì£¼ì˜",
      trend: "ì•…í™”",
      summary: "ìµœê·¼ ì™¸ë¡œì›€ì´ ì‹¬í™”ë˜ê³  ìˆìœ¼ë©°, ì‚¬íšŒì  êµë¥˜ í•„ìš”",
    },
    priority: "ë†’ìŒ",
    totalSessions: 12,
  },
  {
    id: "2",
    name: "ë°•ì² ìˆ˜",
    birthDate: "1940-07-22",
    age: 84,
    phone: "010-2345-6789",
    address: "ì„œìš¸ì‹œ ì¤‘êµ¬ ëª…ë™ 67-89",
    guardian: {
      name: "ë°•ë¯¸ì˜",
      phone: "010-8765-4321",
      relationship: "ë”¸",
    },
    lastVisit: "2024-01-12",
    emotionalState: {
      current: "ìœ„í—˜",
      trend: "ì•…í™”",
      summary: "ë¶„ë…¸ ì¡°ì ˆ ì–´ë ¤ì›€, ê¸´ê¸‰ ê°œì… í•„ìš”",
    },
    priority: "ë†’ìŒ",
    totalSessions: 8,
  },
  {
    id: "3",
    name: "ì´ì˜í¬",
    birthDate: "1948-11-08",
    age: 76,
    phone: "010-3456-7890",
    address: "ì„œìš¸ì‹œ ê°•ë‚¨êµ¬ ì—­ì‚¼ë™ 234-56",
    guardian: {
      name: "ì´ì¤€í˜¸",
      phone: "010-7654-3210",
      relationship: "ì•„ë“¤",
    },
    lastVisit: "2024-01-08",
    emotionalState: {
      current: "ë³´í†µ",
      trend: "ê°œì„ ",
      summary: "ìš°ìš¸ê°ì´ ì ì§„ì ìœ¼ë¡œ ê°œì„ ë˜ê³  ìˆìŒ",
    },
    priority: "ë³´í†µ",
    totalSessions: 15,
  },
  {
    id: "4",
    name: "ìµœë¯¼ìˆ˜",
    birthDate: "1942-05-30",
    age: 82,
    phone: "010-4567-8901",
    address: "ì„œìš¸ì‹œ ë§ˆí¬êµ¬ í•©ì •ë™ 345-67",
    guardian: {
      name: "ìµœì€ì •",
      phone: "010-6543-2109",
      relationship: "ë”¸",
    },
    lastVisit: "2024-01-05",
    emotionalState: {
      current: "ì¢‹ìŒ",
      trend: "ìœ ì§€",
      summary: "ì•ˆì •ì ì¸ ì •ì„œ ìƒíƒœ ìœ ì§€ ì¤‘",
    },
    priority: "ë‚®ìŒ",
    totalSessions: 6,
  },
]

const mockCounselingRecords: Record<string, CounselingRecord[]> = {
  "1": [
    {
      id: "r1",
      date: "2024-01-15",
      type: "ì •ê¸°",
      duration: 50,
      emotionalScores: {
        depression: 4,
        anxiety: 3,
        loneliness: 5,
        anger: 2,
      },
      notes: "ğŸ” ê¸°ë³¸ ì²´í¬ë¦¬ìŠ¤íŠ¸\nì˜¤ëŠ˜ ê¸°ë¶„ (1-10ì ): 4ì \nâ†’ ì–´ì œë³´ë‹¤ëŠ” ì¡°ê¸ˆ ë‚˜ì•„ì¡Œì§€ë§Œ, ì—¬ì „íˆ ë§ˆìŒì´ ë¬´ê±°ì›Œìš”.\n\nğŸ¯ ì£¼ì œ ì„ ì •\nì§€ë‚œ ì£¼ì— ì•„ë“¤ì´ ë†€ëŸ¬ì™”ëŠ”ë°, ê·¸ë•Œ ê¸°ë¶„ì´ ì–´ë– ì…¨ë‚˜ìš”?\nâ†’ ì •ë§ ì¢‹ì•˜ì–´ìš”. ì†ìë„ í•¨ê»˜ ì™€ì„œ ì§‘ì´ ì‹œëŒë²…ì í–ˆì–´ìš”.\nê°€ì¡± ì‚¬ì§„ì„ ë³´ì‹œë©´ì„œ ì–´ë–¤ ì¶”ì–µì´ ë– ì˜¤ë¥´ì‹œë‚˜ìš”?\nâ†’ ì†ìì™€ í•¨ê»˜í•œ ë†€ì´í„° ì¶”ì–µì´ ë– ì˜¬ë¼ìš”. ê·¸ë•Œ ì›ƒìŒì†Œë¦¬ê°€ ì•„ì§ë„ ê·“ê°€ì— ë§´ëŒì•„ìš”.\n\nìµœê·¼ì— ê°€ì¡±ê³¼ ë‚˜ëˆˆ ëŒ€í™” ì¤‘ ê¸°ì–µì— ë‚¨ëŠ” ê²ƒì´ ìˆë‚˜ìš”?\nâ†’ ì•„ë“¤ì´ \"ì—„ë§ˆ, ê±±ì •í•˜ì§€ ë§ˆì„¸ìš”\"ë¼ê³  ë§í•œ ê²Œ ê¸°ì–µì— ë‚¨ì•„ìš”.\n\nì´ì›ƒê³¼ì˜ ì†Œí†µì—ì„œ ëŠë‚€ ì ì´ ìˆìœ¼ì‹ ê°€ìš”?\nâ†’ ì´ì›ƒê³¼ ì´ì•¼ê¸°í•˜ë©´ì„œ í˜¼ìê°€ ì•„ë‹ˆë¼ëŠ” ëŠë‚Œì„ ë°›ì•„ìš”.\n\nğŸ’­ ê°ì • í‘œí˜„ ìœ ë„\n\nìš”ì¦˜ ê°€ì¥ ë§ì´ ëŠë¼ì‹œëŠ” ê°ì •ì€ ë¬´ì—‡ì¸ê°€ìš”?\nâ†’ ì™¸ë¡œì›€ê³¼ ë™ì‹œì— ê°ì‚¬í•¨ì„ ëŠê»´ìš”.\n\nê·¸ ê°ì •ì„ ëŠë¼ì‹¤ ë•Œ ëª¸ì— ì–´ë–¤ ë³€í™”ê°€ ìˆë‚˜ìš”?\nâ†’ ì™¸ë¡œì›€ì„ ëŠë¼ë©´ ê°€ìŠ´ì´ ë‹µë‹µí•´ì§€ê³ , ê°ì‚¬í•¨ì„ ëŠë¼ë©´ ë§ˆìŒì´ ë”°ëœ»í•´ì ¸ìš”.ğŸ› ï¸ ëŒ€ì²˜ ì „ëµ ì œì•ˆ\n\nì™¸ë¡œì›€ì„ ëŠë¼ì‹¤ ë•Œ ì–´ë–¤ ì¼ì„ í•˜ì‹œë©´ ê¸°ë¶„ì´ ì¢‹ì•„ì§€ë‚˜ìš”?\nâ†’ ì´ì›ƒê³¼ ëŒ€í™”í•˜ê±°ë‚˜, ê°€ì¡± ì‚¬ì§„ì„ ë³´ê±°ë‚˜, ì‚°ì±…ì„ ë‚˜ê°€ìš”.\n\nì§§ì€ ì‚°ì±…ì´ë‚˜ í˜¸í¡ ìš´ë™ì„ í•´ë³´ì‹  ì ì´ ìˆë‚˜ìš”?\nâ†’ ë„¤, í˜¸í¡ ìš´ë™ì€ ë§¤ì¼ ì•„ì¹¨ì— í•˜ê³  ìˆì–´ìš”. ë„ì›€ì´ ë§ì´ ë¼ìš”.\n\nê°ì • ì¼ê¸°ë¥¼ ì¨ë³´ëŠ” ê²ƒì€ ì–´ë–¨ê¹Œìš”?\nâ†’ ê¸€ì”¨ë¥¼ ì˜ ëª» ì¨ì„œ ì–´ë ¤ìš¸ ê²ƒ ê°™ì•„ìš”.\n\nìŒì•…ì„ ë“£ê±°ë‚˜ TVë¥¼ ë³´ëŠ” ê²ƒì´ ë„ì›€ì´ ë˜ë‚˜ìš”?\nâ†’ íŠ¸ë¡œíŠ¸ ìŒì•…ì„ ë“¤ìœ¼ë©´ ê¸°ë¶„ì´ ì¢‹ì•„ì ¸ìš”.\n\nì·¨ë¯¸ í™œë™ì„ í†µí•´ ê¸°ë¶„ ì „í™˜ì„ í•´ë³´ì‹  ì ì´ ìˆë‚˜ìš”?\nâ†’ ìš”ì¦˜ì€ í™”ë¶„ ê°€ê¾¸ê¸°ì— ê´€ì‹¬ì´ ìƒê²¼ì–´ìš”.\n\nğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ ê°€ì¡± ì—°ê³„\n\nê°€ì¡±ì—ê²Œ ê¸ì •ì ì¸ ê°ì •ì„ í‘œí˜„í•´ë³¸ë‹¤ë©´ ì–´ë–¤ ë§ì„ í•˜ê³  ì‹¶ìœ¼ì„¸ìš”?\nâ†’ \"ë„ˆí¬ê°€ ìˆì–´ì„œ ë‚´ ì¸ìƒì´ í–‰ë³µí–ˆì–´. ê³ ë§ˆì›Œ.\"\n\nê°€ì¡±ê³¼ì˜ ì†Œí†µì—ì„œ ê°œì„ í•˜ê³  ì‹¶ì€ ë¶€ë¶„ì´ ìˆë‚˜ìš”?\nâ†’ ë” ìì£¼ ì—°ë½í•˜ê³  ì‹¶ì–´ìš”. ì¼ì£¼ì¼ì— í•œ ë²ˆì€ ê¼­ ì „í™”í•˜ê³  ì‹¶ì–´ìš”.\n\nê°€ì¡±ê³¼ì˜ ì¶”ì–µ ì¤‘ ê°€ì¥ ì†Œì¤‘í•œ ê²ƒì€ ë¬´ì—‡ì¸ê°€ìš”?\nâ†’ ì†ìê°€ íƒœì–´ë‚¬ì„ ë•Œì˜ ìˆœê°„ì´ì—ìš”. ê·¸ë•Œì˜ ê¸°ì¨ì€ ìŠì„ ìˆ˜ ì—†ì–´ìš”.\n\nê°€ì¡±ì—ê²Œ ë„ì›€ì„ ë°›ê³  ì‹¶ì€ ë¶€ë¶„ì´ ìˆë‚˜ìš”?\nâ†’ ê±´ê°•í•  ë•Œê¹Œì§€ í˜¼ì ì‚´ ìˆ˜ ìˆë„ë¡ ê²©ë ¤í•´ì£¼ê³  ì‹¶ì–´ìš”.",
      aiSummary: "5íšŒì°¨ ìƒë‹´(2024-01-15)ì—ì„œ ì™¸ë¡œì›€ ì ìˆ˜ 5ì ìœ¼ë¡œ 1-2íšŒì°¨ ëŒ€ë¹„ 3ì  ê°œì„  í™•ì¸. ê°€ì¡± ì‚¬ì§„ì„ í†µí•œ ì¶”ì–µ ëŒ€í™”ê°€ 3-4íšŒì°¨ì—ì„œ íš¨ê³¼ì ì´ì—ˆë˜ íŒ¨í„´ê³¼ ì¼ì¹˜í•˜ì—¬ ì§€ì†ì  ì ìš© ê¶Œì¥. í˜¸í¡ ìš´ë™ì€ 2-4íšŒì°¨ì—ì„œ ê·œì¹™ì ìœ¼ë¡œ ì‹¤ì²œë˜ì–´ ì˜¨ ì „ëµìœ¼ë¡œ í˜„ì¬ê¹Œì§€ ìœ ì§€ ì¤‘. ì´ì›ƒê³¼ì˜ ì†Œí†µì´ 4íšŒì°¨ì—ì„œ í™•ì¸ëœ 'í˜¼ìê°€ ì•„ë‹ˆë¼ëŠ” ëŠë‚Œ' íš¨ê³¼ë¥¼ ì¬í™•ì¸. ì‚°ì±…, ìŒì•… ê°ìƒ, í™”ë¶„ ê°€ê¾¸ê¸° ë“± ìƒˆë¡œìš´ ì·¨ë¯¸ í™œë™ì´ 1-4íšŒì°¨ì˜ ê°€ì¡± ì¤‘ì‹¬ ì ‘ê·¼ê³¼ ì°¨ë³„í™”ëœ ê°œì¸ì  ëŒ€ì²˜ ì „ëµìœ¼ë¡œ ë°œì „. ê°€ì¡±ê³¼ì˜ ì •ê¸°ì  ì—°ë½ ì²´ê³„ êµ¬ì¶•ì€ 2íšŒì°¨ì—ì„œ í™•ì¸ëœ ì—°ë½ ë¹ˆë„ ê°ì†Œ ë¬¸ì œì˜ í•´ê²°ì±…ìœ¼ë¡œ ì œì‹œë¨. ì „ë°˜ì ìœ¼ë¡œ 1-4íšŒì°¨ì˜ ì ì§„ì  ê°œì„  ê²½í—˜ì„ ë°”íƒ•ìœ¼ë¡œ í•œ ì¢…í•©ì  ì •ì„œ ì•ˆì •í™” ë‹¬ì„±.",
    },
    {
      id: "r2",
      date: "2024-01-08",
      type: "ì •ê¸°",
      duration: 45,
      emotionalScores: {
        depression: 5,
        anxiety: 3,
        loneliness: 6,
        anger: 2,
      },
      notes: "ğŸ” ê¸°ë³¸ ì²´í¬ë¦¬ìŠ¤íŠ¸\n\nì˜¤ëŠ˜ ê¸°ë¶„ (1-10ì ): 6ì \nâ†’ ì´ì›ƒê³¼ ì¸ì‚¬ ë‚˜ëˆ„ë©´ì„œ ê¸°ë¶„ì´ ì¡°ê¸ˆ ë‚˜ì•„ì¡Œì–´ìš”.\n\nì ì€ ì˜ ì£¼ë¬´ì…¨ë‚˜ìš”?\nâ†’ ì–´ì œë³´ë‹¤ëŠ” ì¡°ê¸ˆ ë” ì˜ ì¤ì–´ìš”. 6ì‹œê°„ ì •ë„ ì” ê²ƒ ê°™ì•„ìš”.\n\nì‹ì‚¬ëŠ” ì œëŒ€ë¡œ í•˜ì…¨ë‚˜ìš”?\nâ†’ ì•„ì¹¨ì€ ê°„ë‹¨í•˜ê²Œ, ì ì‹¬ì€ ë§ˆíŠ¸ì—ì„œ ì´ì›ƒ í• ë¨¸ë‹ˆì™€ í•¨ê»˜ ë¨¹ì—ˆì–´ìš”.\n\nëª¸ì— ì•„í”ˆ ê³³ì€ ì—†ìœ¼ì‹ ê°€ìš”?\nâ†’ ì–´ê¹¨ê°€ ì¡°ê¸ˆ ë»ê·¼í•˜ì§€ë§Œ ì–´ì œë³´ë‹¤ëŠ” ë‚˜ì•„ì¡Œì–´ìš”.\n\nì˜¤ëŠ˜ í•˜ë£¨ ê³„íšì´ ìˆìœ¼ì‹ ê°€ìš”?\nâ†’ ì˜¤í›„ì— ì´ì›ƒ í• ë¨¸ë‹ˆì™€ í•¨ê»˜ ë§ˆíŠ¸ì— ê°€ê¸°ë¡œ í–ˆì–´ìš”.\n\nğŸ¯ ì£¼ì œ ì„ ì •\n\nì§€ë‚œ ì£¼ì— ê°€ì¡±ê³¼ ë‚˜ëˆˆ ëŒ€í™” ì¤‘ ê¸°ì–µì— ë‚¨ëŠ” ê²ƒì´ ìˆë‚˜ìš”?\nâ†’ ì•„ë“¤ì´ \"ì—„ë§ˆ, ê±±ì •í•˜ì§€ ë§ˆì„¸ìš”\"ë¼ê³  ë§í•œ ê²Œ ê¸°ì–µì— ë‚¨ì•„ìš”.\n\nì‚°ì±…ì€ ì˜ í•˜ê³  ê³„ì‹œë‚˜ìš”?\nâ†’ ë„¤, ë§¤ì¼ ì•„ì¹¨ 30ë¶„ì”© ì‚°ì±…í•˜ê³  ìˆì–´ìš”.\n\nì´ì›ƒê³¼ ì¸ì‚¬ ë‚˜ëˆ„ì‹¤ ë•Œ ê¸°ë¶„ì´ ì–´ë– ì‹ ê°€ìš”?\nâ†’ ì²˜ìŒì—ëŠ” ì–´ìƒ‰í–ˆì§€ë§Œ, ìš”ì¦˜ì€ ê¸°ë‹¤ë ¤ì§€ëŠ” ì‹œê°„ì´ì—ìš”.\n\nìµœê·¼ì— ê°€ì¡±ê³¼ í•¨ê»˜í•œ ìµœê·¼ í™œë™ì´ ìˆë‚˜ìš”?\nâ†’ ì§€ë‚œ ì£¼ì— ì•„ë“¤ì´ ë†€ëŸ¬ì™”ì–´ìš”. ì†ìë„ í•¨ê»˜ ì™€ì„œ ì •ë§ ì¢‹ì•˜ì–´ìš”.\n\nì´ì›ƒê³¼ì˜ ì†Œí†µì—ì„œ ëŠë‚€ ì ì´ ìˆìœ¼ì‹ ê°€ìš”?\nâ†’ ì´ì›ƒê³¼ ì´ì•¼ê¸°í•˜ë©´ì„œ í˜¼ìê°€ ì•„ë‹ˆë¼ëŠ” ëŠë‚Œì„ ë°›ì•„ìš”.\n\nê°€ì¡±ì—ê²Œ ì „í™”ë¥¼ ë°›ì€ ì ì´ ìˆë‚˜ìš”?\nâ†’ ë„¤, ì–´ì œ ì•„ë“¤ì´ ì „í™”ë¥¼ ê±¸ì–´ì™”ì–´ìš”.\n\nğŸ’­ ê°ì • í‘œí˜„ ìœ ë„\n\nìš”ì¦˜ ê°€ì¥ ë§ì´ ëŠë¼ì‹œëŠ” ê°ì •ì€ ë¬´ì—‡ì¸ê°€ìš”?\nâ†’ ì™¸ë¡œì›€ì´ ì¤„ì–´ë“¤ë©´ì„œ ê¸°ëŒ€ê°ì´ ìƒê¸°ê³  ìˆì–´ìš”.\n\nê·¸ ê°ì •ì„ ëŠë¼ì‹¤ ë•Œ ëª¸ì— ì–´ë–¤ ë³€í™”ê°€ ìˆë‚˜ìš”?\nâ†’ ê¸°ëŒ€ê°ì„ ëŠë¼ë©´ ê°€ìŠ´ì´ ë‘ê·¼ê±°ë¦¬ê³ , ì™¸ë¡œì›€ì„ ëŠë¼ë©´ ì–´ê¹¨ê°€ ì¶• ì²˜ì ¸ìš”.\n\nê·¸ ê°ì •ì„ ëˆ„êµ°ê°€ì™€ ë‚˜ëˆ„ê³  ì‹¶ìœ¼ì‹ ê°€ìš”?\nâ†’ ë„¤, ì´ì›ƒ í• ë¨¸ë‹ˆì™€ ë‚˜ëˆ„ê³  ì‹¶ì–´ìš”.\n\nê°ì •ì´ ë³€í™”í•˜ëŠ” ìˆœê°„ì„ ëŠë¼ì‹  ì ì´ ìˆë‚˜ìš”?\nâ†’ ì´ì›ƒê³¼ ëŒ€í™”í•  ë•Œë§ˆë‹¤ ê¸°ë¶„ì´ ì¢‹ì•„ì ¸ìš”.\n\nì–´ë–¤ ìƒí™©ì—ì„œ ê¸°ë¶„ì´ ì¢‹ì•„ì§€ì‹œë‚˜ìš”?\nâ†’ ì´ì›ƒê³¼ ëŒ€í™”í•  ë•Œ, ê°€ì¡±ê³¼ í•¨ê»˜ ìˆì„ ë•Œ, ì‚°ì±…í•  ë•Œì˜ˆìš”.\n\nğŸ› ï¸ ëŒ€ì²˜ ì „ëµ ì œì•ˆ\n\nì™¸ë¡œì›€ì„ ëŠë¼ì‹¤ ë•Œ ì–´ë–¤ ì¼ì„ í•˜ì‹œë©´ ê¸°ë¶„ì´ ì¢‹ì•„ì§€ë‚˜ìš”?\nâ†’ ì´ì›ƒê³¼ ëŒ€í™”í•˜ê±°ë‚˜, ì‚°ì±…ì„ ë‚˜ê°€ê±°ë‚˜, ê°€ì¡± ì‚¬ì§„ì„ ë´ìš”.\n\nì§§ì€ ì‚°ì±…ì´ë‚˜ í˜¸í¡ ìš´ë™ì„ í•´ë³´ì‹  ì ì´ ìˆë‚˜ìš”?\nâ†’ ë„¤, í˜¸í¡ ìš´ë™ì€ ë§¤ì¼ ì•„ì¹¨ì— í•˜ê³  ìˆì–´ìš”.\n\nê°ì • ì¼ê¸°ë¥¼ ì¨ë³´ëŠ” ê²ƒì€ ì–´ë–¨ê¹Œìš”?\nâ†’ ê¸€ì”¨ë¥¼ ì˜ ëª» ì¨ì„œ ì–´ë ¤ìš¸ ê²ƒ ê°™ì•„ìš”.\n\nìŒì•…ì„ ë“£ê±°ë‚˜ TVë¥¼ ë³´ëŠ” ê²ƒì´ ë„ì›€ì´ ë˜ë‚˜ìš”?\nâ†’ íŠ¸ë¡œíŠ¸ ìŒì•…ì„ ë“¤ìœ¼ë©´ ê¸°ë¶„ì´ ì¢‹ì•„ì ¸ìš”.\n\nì·¨ë¯¸ í™œë™ì„ í†µí•´ ê¸°ë¶„ ì „í™˜ì„ í•´ë³´ì‹  ì ì´ ìˆë‚˜ìš”?\nâ†’ ìš”ì¦˜ì€ í™”ë¶„ ê°€ê¾¸ê¸°ì— ê´€ì‹¬ì´ ìƒê²¼ì–´ìš”.\n\nğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ ê°€ì¡± ì—°ê³„\n\nê°€ì¡±ì—ê²Œ ê¸ì •ì ì¸ ê°ì •ì„ í‘œí˜„í•´ë³¸ë‹¤ë©´ ì–´ë–¤ ë§ì„ í•˜ê³  ì‹¶ìœ¼ì„¸ìš”?\nâ†’ \"ë„ˆí¬ê°€ ìˆì–´ì„œ ë‚´ ì¸ìƒì´ í–‰ë³µí–ˆì–´. ê³ ë§ˆì›Œ.\"\n\nê°€ì¡±ê³¼ í•¨ê»˜í•˜ê³  ì‹¶ì€ í™œë™ì´ ìˆë‚˜ìš”?\nâ†’ ì†ìì™€ í•¨ê»˜ ê³µì›ì—ì„œ ë†€ì´ë¥¼ í•˜ê³  ì‹¶ì–´ìš”.\n\nê°€ì¡±ê³¼ì˜ ì†Œí†µì—ì„œ ê°œì„ í•˜ê³  ì‹¶ì€ ë¶€ë¶„ì´ ìˆë‚˜ìš”?\nâ†’ ë” ìì£¼ ì—°ë½í•˜ê³  ì‹¶ì–´ìš”.\n\nê°€ì¡±ê³¼ì˜ ì¶”ì–µ ì¤‘ ê°€ì¥ ì†Œì¤‘í•œ ê²ƒì€ ë¬´ì—‡ì¸ê°€ìš”?\nâ†’ ì†ìê°€ íƒœì–´ë‚¬ì„ ë•Œì˜ ìˆœê°„ì´ì—ìš”.\n\nê°€ì¡±ì—ê²Œ ë„ì›€ì„ ë°›ê³  ì‹¶ì€ ë¶€ë¶„ì´ ìˆë‚˜ìš”?\nâ†’ ê±´ê°•í•  ë•Œê¹Œì§€ í˜¼ì ì‚´ ìˆ˜ ìˆë„ë¡ ê²©ë ¤í•´ì£¼ê³  ì‹¶ì–´ìš”.",
      aiSummary: "4íšŒì°¨ ìƒë‹´(2024-01-08)ì—ì„œ ì™¸ë¡œì›€ ì ìˆ˜ 6ì ìœ¼ë¡œ 1-2íšŒì°¨ ëŒ€ë¹„ 2ì  ê°œì„ , 3íšŒì°¨ì™€ ë™ì¼ ìˆ˜ì¤€ ìœ ì§€. ì´ì›ƒê³¼ì˜ ë§ˆíŠ¸ ë°©ë¬¸ ë° ì¸ì‚¬ ë‚˜ëˆ„ê¸°ê°€ 2-3íšŒì°¨ì—ì„œ í™•ì¸ëœ ì‚¬íšŒì  ê³ ë¦½ ë¬¸ì œì˜ êµ¬ì²´ì  í•´ê²°ì±…ìœ¼ë¡œ ì‘ìš©. ì•„ë“¤ê³¼ ì†ì ë°©ë¬¸ì€ 3íšŒì°¨ì—ì„œ íš¨ê³¼ì ì´ì—ˆë˜ ê°€ì¡± ì¤‘ì‹¬ ëŒ€í™” íŒ¨í„´ì˜ ì¬í˜„ìœ¼ë¡œ ì •ì„œì  ì•ˆì •ì— ê¸°ì—¬. ë§¤ì¼ ì•„ì¹¨ 30ë¶„ ì‚°ì±…ì€ 1-3íšŒì°¨ì˜ 20ë¶„ì—ì„œ 30ë¶„ìœ¼ë¡œ í™•ëŒ€ë˜ì–´ í™œë™ëŸ‰ ì¦ê°€ ê²½í—˜. í˜¸í¡ ìš´ë™ì€ 2-3íšŒì°¨ì—ì„œ íš¨ê³¼ì ì´ì—ˆë˜ ëŒ€ì²˜ ì „ëµì˜ ì§€ì†ì  ì ìš©. ì´ì›ƒê³¼ì˜ ëŒ€í™”ì—ì„œ 'í˜¼ìê°€ ì•„ë‹ˆë¼ëŠ” ëŠë‚Œ'ì„ ë°›ì•„ 1-2íšŒì°¨ì˜ ì‚¬íšŒì  ê³ ë¦½ ë¬¸ì œê°€ ì ì§„ì  ì™„í™”ë¨ì„ í™•ì¸. ì§€ì—­ì‚¬íšŒ í™œë™ ì°¸ì—¬ ì˜í–¥ ì¦ê°€ëŠ” 1-3íšŒì°¨ì˜ ê°œì¸ì  ëŒ€ì²˜ì—ì„œ ì‚¬íšŒì  êµë¥˜ë¡œ ì „í™˜ë˜ëŠ” ì¤‘ìš”í•œ ë³€í™”ì .",
    },
    {
      id: "r3",
      date: "2024-01-01",
      type: "ì •ê¸°",
      duration: 40,
      emotionalScores: {
        depression: 5,
        anxiety: 4,
        loneliness: 6,
        anger: 2,
      },
      notes: "ğŸ” ê¸°ë³¸ ì²´í¬ë¦¬ìŠ¤íŠ¸\n\nì˜¤ëŠ˜ ê¸°ë¶„ (1-10ì ): 5ì \nâ†’ ê°€ì¡± ì‚¬ì§„ì„ ë³´ë©´ì„œ ì¶”ì–µì— ì ê²¨ìˆì–´ìš”.\n\nì ì€ ì˜ ì£¼ë¬´ì…¨ë‚˜ìš”?\nâ†’ ì–´ì œëŠ” ê°€ì¡± ì‚¬ì§„ì„ ë³´ë©´ì„œ ì ë“¤ì—ˆì–´ìš”. ê¿ˆë„ ì¢‹ì•˜ì–´ìš”.\n\nì‹ì‚¬ëŠ” ì œëŒ€ë¡œ í•˜ì…¨ë‚˜ìš”?\nâ†’ ì•„ì¹¨ì€ ê°„ë‹¨í•˜ê²Œ, ì ì‹¬ì€ ê°€ì¡± ì‚¬ì§„ì„ ë³´ë©´ì„œ ë¨¹ì—ˆì–´ìš”.\n\nëª¸ì— ì•„í”ˆ ê³³ì€ ì—†ìœ¼ì‹ ê°€ìš”?\nâ†’ ì–´ê¹¨ê°€ ì¡°ê¸ˆ ë»ê·¼í•˜ì§€ë§Œ ì°¸ì„ ë§Œí•´ìš”.\n\nì˜¤ëŠ˜ í•˜ë£¨ ê³„íšì´ ìˆìœ¼ì‹ ê°€ìš”?\nâ†’ ì˜¤í›„ì— ê°€ì¡± ì‚¬ì§„ì„ ì •ë¦¬í•˜ê³ , ì†ìì™€ ì „í™”í•˜ê³  ì‹¶ì–´ìš”.\n\nğŸ¯ ì£¼ì œ ì„ ì •\n\nê°€ì¡± ì‚¬ì§„ì„ ë³´ì‹œë©´ì„œ ì–´ë–¤ ì¶”ì–µì´ ë– ì˜¤ë¥´ì‹œë‚˜ìš”?\nâ†’ ì†ìì™€ í•¨ê»˜í•œ ë†€ì´í„° ì¶”ì–µì´ ë– ì˜¬ë¼ìš”. ê·¸ë•Œ ì›ƒìŒì†Œë¦¬ê°€ ì•„ì§ë„ ê·“ê°€ì— ë§´ëŒì•„ìš”.\n\nìµœê·¼ì— ê°€ì¡±ê³¼ ë‚˜ëˆˆ ëŒ€í™” ì¤‘ ê¸°ì–µì— ë‚¨ëŠ” ê²ƒì´ ìˆë‚˜ìš”?\nâ†’ ì•„ë“¤ì´ \"ì—„ë§ˆ, ê±´ê°•í•˜ì„¸ìš”\"ë¼ê³  ë§í•œ ê²Œ ê¸°ì–µì— ë‚¨ì•„ìš”.\n\nì‚°ì±…ì€ ì˜ í•˜ê³  ê³„ì‹œë‚˜ìš”?\nâ†’ ë„¤, ë§¤ì¼ ì•„ì¹¨ 20ë¶„ì”© ì‚°ì±…í•˜ê³  ìˆì–´ìš”.\n\nì´ì›ƒê³¼ ì¸ì‚¬ ë‚˜ëˆ„ì‹¤ ë•Œ ê¸°ë¶„ì´ ì–´ë– ì‹ ê°€ìš”?\nâ†’ ì²˜ìŒì—ëŠ” ì–´ìƒ‰í–ˆì§€ë§Œ, ìš”ì¦˜ì€ ì¡°ê¸ˆì”© ìµìˆ™í•´ì§€ê³  ìˆì–´ìš”.\n\nìµœê·¼ì— ê°€ì¡±ê³¼ í•¨ê»˜í•œ ìµœê·¼ í™œë™ì´ ìˆë‚˜ìš”?\nâ†’ ì§€ë‚œ ì£¼ì— ì•„ë“¤ì´ ë†€ëŸ¬ì™”ì–´ìš”. ì†ìë„ í•¨ê»˜ ì™€ì„œ ì •ë§ ì¢‹ì•˜ì–´ìš”.\n\nì´ì›ƒê³¼ì˜ ëŒ€í™” ì¤‘ ê¸°ì–µì— ë‚¨ëŠ” ê²ƒì´ ìˆë‚˜ìš”?\nâ†’ ì´ì›ƒ í• ë¨¸ë‹ˆê°€ ì†ì ì´ì•¼ê¸°ë¥¼ í•´ì£¼ì‹  ê²Œ ê¸°ì–µì— ë‚¨ì•„ìš”.\n\nê°€ì¡±ì—ê²Œ ì „í™”ë¥¼ ë°›ì€ ì ì´ ìˆë‚˜ìš”?\nâ†’ ë„¤, ì–´ì œ ì•„ë“¤ì´ ì „í™”ë¥¼ ê±¸ì–´ì™”ì–´ìš”.\n\nğŸ’­ ê°ì • í‘œí˜„ ìœ ë„\n\nìš”ì¦˜ ê°€ì¥ ë§ì´ ëŠë¼ì‹œëŠ” ê°ì •ì€ ë¬´ì—‡ì¸ê°€ìš”?\nâ†’ ê·¸ë¦¬ì›€ê³¼ ë™ì‹œì— ê°ì‚¬í•¨ì„ ëŠê»´ìš”.\n\nê·¸ ê°ì •ì„ ëŠë¼ì‹¤ ë•Œ ëª¸ì— ì–´ë–¤ ë³€í™”ê°€ ìˆë‚˜ìš”?\nâ†’ ê·¸ë¦¬ì›€ì„ ëŠë¼ë©´ ê°€ìŠ´ì´ ë‹µë‹µí•´ì§€ê³ , ê°ì‚¬í•¨ì„ ëŠë¼ë©´ ë§ˆìŒì´ ë”°ëœ»í•´ì ¸ìš”.\n\nê·¸ ê°ì •ì„ ëˆ„êµ°ê°€ì™€ ë‚˜ëˆ„ê³  ì‹¶ìœ¼ì‹ ê°€ìš”?\nâ†’ ë„¤, ê°€ì¡±ê³¼ ë‚˜ëˆ„ê³  ì‹¶ì–´ìš”.\n\nê°ì •ì´ ë³€í™”í•˜ëŠ” ìˆœê°„ì„ ëŠë¼ì‹  ì ì´ ìˆë‚˜ìš”?\nâ†’ ê°€ì¡± ì‚¬ì§„ì„ ë³¼ ë•Œë§ˆë‹¤ ê¸°ë¶„ì´ ì¢‹ì•„ì ¸ìš”.\n\nì–´ë–¤ ìƒí™©ì—ì„œ ê¸°ë¶„ì´ ì¢‹ì•„ì§€ì‹œë‚˜ìš”?\nâ†’ ê°€ì¡±ê³¼ í•¨ê»˜ ìˆì„ ë•Œ, ê°€ì¡± ì‚¬ì§„ì„ ë³¼ ë•Œ, ì†ìì™€ ì „í™”í•  ë•Œì˜ˆìš”.\n\nğŸ› ï¸ ëŒ€ì²˜ ì „ëµ ì œì•ˆ\n\nì™¸ë¡œì›€ì„ ëŠë¼ì‹¤ ë•Œ ì–´ë–¤ ì¼ì„ í•˜ì‹œë©´ ê¸°ë¶„ì´ ì¢‹ì•„ì§€ë‚˜ìš”?\nâ†’ ê°€ì¡± ì‚¬ì§„ì„ ë³´ê±°ë‚˜, ê°€ì¡±ê³¼ ì „í™”í•˜ê±°ë‚˜, ì‚°ì±…ì„ ë‚˜ê°€ìš”.\n\nì§§ì€ ì‚°ì±…ì´ë‚˜ í˜¸í¡ ìš´ë™ì„ í•´ë³´ì‹  ì ì´ ìˆë‚˜ìš”?\nâ†’ ë„¤, í˜¸í¡ ìš´ë™ì€ ë§¤ì¼ ì•„ì¹¨ì— í•˜ê³  ìˆì–´ìš”.\n\nê°ì • ì¼ê¸°ë¥¼ ì¨ë³´ëŠ” ê²ƒì€ ì–´ë–¨ê¹Œìš”?\nâ†’ ê¸€ì”¨ë¥¼ ì˜ ëª» ì¨ì„œ ì–´ë ¤ìš¸ ê²ƒ ê°™ì•„ìš”.\n\nìŒì•…ì„ ë“£ê±°ë‚˜ TVë¥¼ ë³´ëŠ” ê²ƒì´ ë„ì›€ì´ ë˜ë‚˜ìš”?\nâ†’ íŠ¸ë¡œíŠ¸ ìŒì•…ì„ ë“¤ìœ¼ë©´ ê¸°ë¶„ì´ ì¢‹ì•„ì ¸ìš”.\n\nì·¨ë¯¸ í™œë™ì„ í†µí•´ ê¸°ë¶„ ì „í™˜ì„ í•´ë³´ì‹  ì ì´ ìˆë‚˜ìš”?\nâ†’ ìš”ì¦˜ì€ ê°€ì¡± ì‚¬ì§„ ì •ë¦¬ì— ê´€ì‹¬ì´ ìƒê²¼ì–´ìš”.\n\nğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ ê°€ì¡± ì—°ê³„\n\nê°€ì¡±ì—ê²Œ ê¸ì •ì ì¸ ê°ì •ì„ í‘œí˜„í•´ë³¸ë‹¤ë©´ ì–´ë–¤ ë§ì„ í•˜ê³  ì‹¶ìœ¼ì„¸ìš”?\nâ†’ \"ë„ˆí¬ê°€ ìˆì–´ì„œ ë‚´ ì¸ìƒì´ í–‰ë³µí–ˆì–´. ê³ ë§ˆì›Œ.\"\n\nê°€ì¡±ê³¼ í•¨ê»˜í•˜ê³  ì‹¶ì€ í™œë™ì´ ìˆë‚˜ìš”?\nâ†’ ì†ìì™€ í•¨ê»˜ ê³µì›ì—ì„œ ë†€ì´ë¥¼ í•˜ê³  ì‹¶ì–´ìš”.\n\nê°€ì¡±ê³¼ì˜ ì†Œí†µì—ì„œ ê°œì„ í•˜ê³  ì‹¶ì€ ë¶€ë¶„ì´ ìˆë‚˜ìš”?\nâ†’ ë” ìì£¼ ì—°ë½í•˜ê³  ì‹¶ì–´ìš”.\n\nê°€ì¡±ê³¼ì˜ ì¶”ì–µ ì¤‘ ê°€ì¥ ì†Œì¤‘í•œ ê²ƒì€ ë¬´ì—‡ì¸ê°€ìš”?\nâ†’ ì†ìê°€ íƒœì–´ë‚¬ì„ ë•Œì˜ ìˆœê°„ì´ì—ìš”.\n\nê°€ì¡±ì—ê²Œ ë„ì›€ì„ ë°›ê³  ì‹¶ì€ ë¶€ë¶„ì´ ìˆë‚˜ìš”?\nâ†’ ê±´ê°•í•  ë•Œê¹Œì§€ í˜¼ì ì‚´ ìˆ˜ ìˆë„ë¡ ê²©ë ¤í•´ì£¼ê³  ì‹¶ì–´ìš”.",
      aiSummary: "3íšŒì°¨ ìƒë‹´(2024-01-01)ì—ì„œ ì™¸ë¡œì›€ ì ìˆ˜ 6ì ìœ¼ë¡œ 1-2íšŒì°¨ ëŒ€ë¹„ 2ì  ê°œì„ , ì•ˆì •ì  ìƒíƒœ ìœ ì§€. ê°€ì¡± ì‚¬ì§„ì„ í†µí•œ ì¶”ì–µ íšŒìƒì´ 1-2íšŒì°¨ì—ì„œ í™•ì¸ëœ ê°€ì¡±ê³¼ì˜ ì—°ê²° ë¶€ì¡± ë¬¸ì œì— ëŒ€í•œ ìƒˆë¡œìš´ ì ‘ê·¼ë²•ìœ¼ë¡œ íš¨ê³¼ì ì„ì„ í™•ì¸. ì†ìì™€ì˜ ë†€ì´í„° ì¶”ì–µì´ 1-2íšŒì°¨ì˜ ìš°ìš¸ê°ê³¼ ì™¸ë¡œì›€ì—ì„œ ìì•„ì¡´ì¤‘ê° í–¥ìƒìœ¼ë¡œ ì „í™˜ë˜ëŠ” ì¤‘ìš”í•œ ê³„ê¸°ë¡œ ì‘ìš©. ì•„ë“¤ì˜ 'ì—„ë§ˆ, ê±´ê°•í•˜ì„¸ìš”'ë¼ëŠ” ë§ì´ 2íšŒì°¨ì—ì„œ ê²½í—˜í•œ ê°€ì¡±ê³¼ì˜ ì—°ë½ ë‹¨ì ˆ ë¬¸ì œì— ëŒ€í•œ êµ¬ì²´ì  í•´ê²°ì±… ì œì‹œ. ë§¤ì¼ ì•„ì¹¨ 20ë¶„ ì‚°ì±…ì€ 1-2íšŒì°¨ì˜ ì‹¤ë‚´ í™œë™ ì¤‘ì‹¬ì—ì„œ ì™¸ë¶€ í™œë™ìœ¼ë¡œ ì „í™˜ë˜ëŠ” ì²« ì‹œë„ë¡œ ê·œì¹™ì  ìƒí™œ íŒ¨í„´ êµ¬ì¶•ì— ë„ì›€. ì´ì›ƒê³¼ì˜ ëŒ€í™”ì—ì„œ ì†ì ì´ì•¼ê¸°ë¥¼ ë‚˜ëˆ„ë©° 1-2íšŒì°¨ì˜ ì‚¬íšŒì  ê³ ë¦½ì—ì„œ ì§€ì—­ì‚¬íšŒ êµë¥˜ë¡œ ë°œì „í•˜ëŠ” ë³€í™” ê²½í—˜. ê°€ì¡± ì¤‘ì‹¬ ëŒ€í™”ê°€ 1-2íšŒì°¨ì˜ ê°œì¸ì  ë¬¸ì œ í•´ê²°ì—ì„œ ê´€ê³„ ì¤‘ì‹¬ ì ‘ê·¼ìœ¼ë¡œ ì „í™˜ë˜ëŠ” ì¹˜ë£Œì  ë³€í™”ì .",
    },
    {
      id: "r4",
      date: "2024-12-25",
      type: "ì •ê¸°",
      duration: 45,
      emotionalScores: {
        depression: 7,
        anxiety: 5,
        loneliness: 8,
        anger: 3,
      },
      notes: "ğŸ” ê¸°ë³¸ ì²´í¬ë¦¬ìŠ¤íŠ¸\n\nì˜¤ëŠ˜ ê¸°ë¶„ (1-10ì ): 2ì \nâ†’ ì™¸ë¡œì›€ì´ ë„ˆë¬´ ì‹¬í•´ìš”. ê°€ì¡±ë“¤ì´ ì—°ë½ì´ ëœ¸í•´ìš”.\n\nğŸ¯ ì£¼ì œ ì„ ì •\n\nê°€ì¡±ê³¼ì˜ ì—°ë½ ë¹ˆë„ ê°ì†Œ:\nâ†’ ì•„ë“¤ì´ ì¼ì£¼ì¼ì§¸ ì „í™”ë¥¼ ì•ˆ í•´ìš”. ë¬´ìŠ¨ ì¼ì´ ìˆëŠ” ê±´ì§€ ê±±ì •ì´ ë©ë‹ˆë‹¤.\n\nğŸ’­ ê°ì • í‘œí˜„ ìœ ë„\n\nì™¸ë¡œì›€ì„ ëŠë‚„ ë•Œì˜ ê°ì •:\nâ†’ ë§ˆìŒì´ í…… ë¹„ì–´ìˆëŠ” ê²ƒ ê°™ì•„ìš”. ëˆ„êµ°ê°€ì™€ ì´ì•¼ê¸°í•˜ê³  ì‹¶ì€ë° ëŒ€í™”í•  ì‚¬ëŒì´ ì—†ì–´ìš”.\n\nğŸ› ï¸ ëŒ€ì²˜ ì „ëµ\n\nì™¸ë¡œì›€ ê·¹ë³µ ë°©ë²•:\nâ†’ TVë¥¼ ë³´ê±°ë‚˜ ë¼ë””ì˜¤ë¥¼ ë“¤ìœ¼ë©´ì„œ í˜¼ìê°€ ì•„ë‹ˆë¼ëŠ” ëŠë‚Œì„ ë°›ìœ¼ë ¤ê³  í•´ìš”.\n\nğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ ê°€ì¡± ì—°ê³„\n\nê°€ì¡±ì—ê²Œ í•˜ê³  ì‹¶ì€ ë§:\nâ†’ \"ì—°ë½ì´ ì•ˆ ë˜ë©´ ê±±ì •ë¼. ê´œì°®ì€ì§€ ì•Œë ¤ì¤˜.\"",
      aiSummary: "2íšŒì°¨ ìƒë‹´(2024-12-25)ì—ì„œ ì™¸ë¡œì›€ ì ìˆ˜ 8ì , ìš°ìš¸ê° ì ìˆ˜ 7ì ìœ¼ë¡œ 1íšŒì°¨ ëŒ€ë¹„ ì™¸ë¡œì›€ ë™ì¼ ìˆ˜ì¤€, ìš°ìš¸ê° 1ì  ì¦ê°€ë¡œ ì •ì„œì  ì•…í™” í™•ì¸. ê°€ì¡±ê³¼ì˜ ì—°ë½ ë¹ˆë„ ê°ì†Œê°€ 1íšŒì°¨ì—ì„œ í™•ì¸ëœ ì‚¬íšŒì  ê³ ë¦½ ë¬¸ì œì˜ ì‹¬í™”ë¡œ ë‚˜íƒ€ë‚¨. ì•„ë“¤ì´ ì¼ì£¼ì¼ì§¸ ì „í™”ë¥¼ ì•ˆ í•´ì„œ ë¬´ìŠ¨ ì¼ì´ ìˆëŠ”ì§€ ê±±ì •ì´ ë˜ëŠ” ìƒí™©ì€ 1íšŒì°¨ì˜ 'í˜¼ìì„œëŠ” í•´ê²°í•  ìˆ˜ ì—†ëŠ” ë¬¸ì œë“¤'ê³¼ ì—°ê²°ë˜ëŠ” ê°€ì¡± ê´€ê³„ ì•…í™” íŒ¨í„´. ì™¸ë¡œì›€ì„ ëŠë‚„ ë•Œ 'ë§ˆìŒì´ í…… ë¹„ì–´ìˆëŠ” ê²ƒ ê°™ë‹¤'ê³  í‘œí˜„í•˜ë©° 1íšŒì°¨ì˜ ê¸´ì¥ê³¼ ê¸°ëŒ€ì—ì„œ ì ˆë§ê³¼ ë¬´ë ¥ê°ìœ¼ë¡œ ì „í™˜ë˜ëŠ” ê°ì • ë³€í™” ê²½í—˜. TVë‚˜ ë¼ë””ì˜¤ë¥¼ í†µí•œ ê°€ìƒì  ì†Œí†µì€ 1íšŒì°¨ì—ì„œ ì‹œë„í•œ í˜¸í¡ ìš´ë™ê³¼ ì°¨ë³„í™”ëœ ìƒˆë¡œìš´ ëŒ€ì²˜ ì „ëµìœ¼ë¡œ ì™¸ë¡œì›€ ê·¹ë³µ ì‹œë„. ê°€ì¡±ì—ê²Œ 'ì—°ë½ì´ ì•ˆ ë˜ë©´ ê±±ì •ë¼. ê´œì°®ì€ì§€ ì•Œë ¤ì¤˜'ë¼ëŠ” ë©”ì‹œì§€ ì „ë‹¬ ì˜ì§€ëŠ” 1íšŒì°¨ì˜ 'ìƒë‹´ì„ ë°›ìœ¼ëŸ¬ ì™”ì–´. ì¡°ê¸ˆë§Œ ê¸°ë‹¤ë ¤ì¤˜'ì™€ ëŒ€ë¹„ë˜ëŠ” ì ê·¹ì  ì˜ì‚¬ì†Œí†µ ì˜ì§€ í‘œí˜„. ê°€ì¡±ê³¼ì˜ ì—°ê²° ê°•í™”ê°€ ì‹œê¸‰í•œ ìƒí™©ìœ¼ë¡œ íŒë‹¨ë˜ë©°, 1íšŒì°¨ì—ì„œ ê³„íšëœ ì²´ê³„ì  ê°œì…ì˜ ì¦‰ì‹œ ì‹¤í–‰ì´ í•„ìš”í•œ ìœ„ê¸° ë‹¨ê³„.",
    },
    {
      id: "r5",
      date: "2024-12-18",
      type: "ì´ˆê¸°",
      duration: 60,
      emotionalScores: {
        depression: 6,
        anxiety: 4,
        loneliness: 8,
        anger: 3,
      },
      notes: "ğŸ” ê¸°ë³¸ ì²´í¬ë¦¬ìŠ¤íŠ¸\n\nì˜¤ëŠ˜ ê¸°ë¶„ (1-10ì ): 1ì \nâ†’ ì²˜ìŒ ìƒë‹´ì„ ë°›ìœ¼ëŸ¬ ì™”ëŠ”ë° ê¸´ì¥ë˜ê³  ë¶ˆì•ˆí•´ìš”.\n\nğŸ¯ ì£¼ì œ ì„ ì •\n\nìƒë‹´ì— ëŒ€í•œ ê¸°ëŒ€ì™€ ê±±ì •:\nâ†’ í˜¼ìì„œëŠ” í•´ê²°í•  ìˆ˜ ì—†ëŠ” ë¬¸ì œë“¤ì´ ìˆì–´ì„œ ë„ì›€ì„ ë°›ê³  ì‹¶ì–´ìš”.\n\nğŸ’­ ê°ì • í‘œí˜„ ìœ ë„\n\nìƒë‹´ì‹¤ì— ì™€ì„œ ëŠë¼ëŠ” ê°ì •:\nâ†’ ê¸´ì¥ê³¼ ê¸°ëŒ€ê°€ ì„ì—¬ ìˆì–´ìš”. ëˆ„êµ°ê°€ ë‚´ ì´ì•¼ê¸°ë¥¼ ë“¤ì–´ì¤„ ìˆ˜ ìˆë‹¤ëŠ” ê²Œ ê¸°ì˜ê¸°ë„ í•´ìš”.\n\nğŸ› ï¸ ëŒ€ì²˜ ì „ëµ\n\nê¸´ì¥ ì™„í™” ë°©ë²•:\nâ†’ ê¹Šê²Œ ìˆ¨ì„ ë“¤ì´ë§ˆì‹œë©´ì„œ ë§ˆìŒì„ ì§„ì •ì‹œí‚¤ë ¤ê³  í•´ìš”.\n\nğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ ê°€ì¡± ì—°ê³„\n\nê°€ì¡±ì—ê²Œ í•˜ê³  ì‹¶ì€ ë§:\nâ†’ \"ìƒë‹´ì„ ë°›ìœ¼ëŸ¬ ì™”ì–´. ì¡°ê¸ˆë§Œ ê¸°ë‹¤ë ¤ì¤˜.\"",
      aiSummary: "1íšŒì°¨ ìƒë‹´(2024-12-18) ì´ˆê¸° ì‚¬ì •ì—ì„œ ì™¸ë¡œì›€ ì ìˆ˜ 8ì , ìš°ìš¸ê° ì ìˆ˜ 6ì ìœ¼ë¡œ ì •ì„œì  ë¶ˆì•ˆì • ìƒíƒœ í™•ì¸. ìƒë‹´ì— ëŒ€í•œ ê¸´ì¥ê³¼ ê¸°ëŒ€ê°€ ì„ì¸ ë³µí•©ì  ê°ì • ê²½í—˜ìœ¼ë¡œ 'í˜¼ìì„œëŠ” í•´ê²°í•  ìˆ˜ ì—†ëŠ” ë¬¸ì œë“¤'ì— ëŒ€í•œ ì¸ì‹ê³¼ ë™ì‹œì— 'ë„ì›€ì„ ë°›ê³  ì‹¶ë‹¤'ëŠ” ì ê·¹ì  ì˜ì§€ í‘œí˜„. ìƒë‹´ì‹¤ì—ì„œ ëŠë¼ëŠ” ê¸´ì¥ê³¼ ê¸°ëŒ€ê°€ ì„ì¸ ê°ì • ìƒíƒœë¡œ 'ëˆ„êµ°ê°€ ë‚´ ì´ì•¼ê¸°ë¥¼ ë“¤ì–´ì¤„ ìˆ˜ ìˆë‹¤ëŠ” ê²Œ ê¸°ì˜ê¸°ë„ í•´ìš”'ë¼ê³  í‘œí˜„í•˜ë©° ìƒë‹´ì— ëŒ€í•œ ê¸ì •ì  ê¸°ëŒ€ê° í™•ì¸. ê¹Šê²Œ ìˆ¨ì„ ë“¤ì´ë§ˆì‹œë©´ì„œ ë§ˆìŒì„ ì§„ì •ì‹œí‚¤ë ¤ëŠ” ìì²´ì  ëŒ€ì²˜ ì‹œë„ëŠ” ë¬¸ì œ í•´ê²°ì„ ìœ„í•œ ì ê·¹ì  ë…¸ë ¥ì˜ í‘œí˜„. ê°€ì¡±ì—ê²Œ 'ìƒë‹´ì„ ë°›ìœ¼ëŸ¬ ì™”ì–´. ì¡°ê¸ˆë§Œ ê¸°ë‹¤ë ¤ì¤˜'ë¼ëŠ” ë©”ì‹œì§€ ì „ë‹¬ ì˜ì§€ëŠ” ê°€ì¡±ê³¼ì˜ ì†Œí†µ ìœ ì§€ ì˜ì§€ì™€ ìƒë‹´ ê³¼ì •ì— ëŒ€í•œ íˆ¬ëª…ì„± í™•ë³´ ë…¸ë ¥. ì™¸ë¡œì›€ê³¼ ì‚¬íšŒì  ê³ ë¦½ ë¬¸ì œì˜ ì²´ê³„ì  ê°œì… ê³„íš ìˆ˜ë¦½ì´ í•„ìš”í•œ ì´ˆê¸° ë‹¨ê³„ë¡œ, ìƒë‹´ ë™ê¸°ì™€ ë¬¸ì œ ì¸ì‹ì´ ëª…í™•í•˜ì—¬ ì¹˜ë£Œì  ê°œì…ì˜ ê¸°ë°˜ì´ ì–‘í˜¸í•œ ìƒíƒœ.",
    },
  ],
}

// React.memoë¡œ ì»´í¬ë„ŒíŠ¸ ìµœì í™” (ë¬´í•œ ë¡œë”© ë°©ì§€)
const ClientManagement = memo(function ClientManagement({ onBack }: { onBack: () => void }) {
  const [searchTerm, setSearchTerm] = useState("")
  const [selectedClient, setSelectedClient] = useState<Client | null>(null)
  const [filterPriority, setFilterPriority] = useState<"ì „ì²´" | "ë†’ìŒ" | "ë³´í†µ" | "ë‚®ìŒ">("ì „ì²´")
  const [showAIGuide, setShowAIGuide] = useState(false)
  const [showEmotionalTracking, setShowEmotionalTracking] = useState(false)
  
  // ìƒë‹´ ì§„í–‰ì„ ìœ„í•œ ìƒíƒœë“¤
  const [emotionalScores, setEmotionalScores] = useState({
    depression: 4,
    anxiety: 3,
    loneliness: 5,
    anger: 2
  })
  const [selectedMood, setSelectedMood] = useState("ë³´í†µ")
  const [counselingNotes, setCounselingNotes] = useState("")
  const [sessionStatus, setSessionStatus] = useState<"ì¤€ë¹„" | "ì§„í–‰ì¤‘" | "ì¼ì‹œì •ì§€" | "ì™„ë£Œ">("ì¤€ë¹„")
  const [sessionStartTime, setSessionStartTime] = useState<Date | null>(null)
  const [sessionTopic, setSessionTopic] = useState("")
  const [sessionMethod, setSessionMethod] = useState("ëŒ€í™” ì¤‘ì‹¬")
  const [clientReaction, setClientReaction] = useState("")
  const [importantStatements, setImportantStatements] = useState("")
  const [sessionSummary, setSessionSummary] = useState("")
  const [nextSessionTopic, setNextSessionTopic] = useState("")
  const [nextSessionDate, setNextSessionDate] = useState("")
  const [specialNotes, setSpecialNotes] = useState("")

  // AI ê°€ì´ë“œ ë‹¨ê³„ë³„ ì§ˆë¬¸ ìƒíƒœ (ì´ˆê¸°ê°’ ë‹¨ìˆœí™”ë¡œ ë¬´í•œ ë¡œë”© ë°©ì§€)
  const [stepQuestions, setStepQuestions] = useState({
    1: [
      "ì˜¤ëŠ˜ ê¸°ë¶„ì€ ì–´ë– ì‹ ê°€ìš”? (1-10ì )",
      "ì ì€ ì˜ ì£¼ë¬´ì…¨ë‚˜ìš”?",
      "ì‹ì‚¬ëŠ” ì œëŒ€ë¡œ í•˜ì…¨ë‚˜ìš”?",
      "ëª¸ì— ì•„í”ˆ ê³³ì€ ì—†ìœ¼ì‹ ê°€ìš”?",
      "ì˜¤ëŠ˜ í•˜ë£¨ ê³„íšì´ ìˆìœ¼ì‹ ê°€ìš”?",
      "ì–´ì œ ë¬´ì—‡ì„ í•˜ì…¨ë‚˜ìš”?",
      "ì˜¤ëŠ˜ ì•„ì¹¨ì— ê¸°ë¶„ì´ ì–´ë– ì…¨ë‚˜ìš”?",
      "ìµœê·¼ì— ì¢‹ì•˜ë˜ ì¼ì´ ìˆë‚˜ìš”?"
    ],
    2: [
      "ì§€ë‚œ ì£¼ì— ê°€ì¡±ê³¼ ë‚˜ëˆˆ ëŒ€í™” ì¤‘ ê¸°ì–µì— ë‚¨ëŠ” ê²ƒì´ ìˆë‚˜ìš”?",
      "ì‚°ì±…ì€ ì˜ í•˜ê³  ê³„ì‹œë‚˜ìš”?",
      "ì´ì›ƒê³¼ ì¸ì‚¬ ë‚˜ëˆ„ì‹¤ ë•Œ ê¸°ë¶„ì´ ì–´ë– ì‹ ê°€ìš”?",
      "ìµœê·¼ì— ê°€ì¡±ê³¼ í•¨ê»˜í•œ ìµœê·¼ í™œë™ì´ ìˆë‚˜ìš”?",
      "ì´ì›ƒê³¼ì˜ ì†Œí†µì—ì„œ ëŠë‚€ ì ì´ ìˆìœ¼ì‹ ê°€ìš”?",
      "ê°€ì¡±ì—ê²Œ ì „í™”ë¥¼ ë°›ì€ ì ì´ ìˆë‚˜ìš”?",
      "ê°€ì¡± ì‚¬ì§„ì„ ë³´ì‹œë©´ì„œ ì–´ë–¤ ì¶”ì–µì´ ë– ì˜¤ë¥´ì‹œë‚˜ìš”?",
      "ì´ì›ƒê³¼ì˜ ëŒ€í™” ì¤‘ ê¸°ì–µì— ë‚¨ëŠ” ê²ƒì´ ìˆë‚˜ìš”?"
    ],
        3: [
    "ìš”ì¦˜ ê°€ì¥ ë§ì´ ëŠë¼ì‹œëŠ” ê°ì •ì€ ë¬´ì—‡ì¸ê°€ìš”? (1-5íšŒì°¨ì—ì„œ í™•ì¸ëœ ì™¸ë¡œì›€, ìš°ìš¸ê°, ê°ì‚¬í•¨ ë“± ê°ì • ë³€í™” ì¶”ì´)",
    "ê·¸ ê°ì •ì„ ëŠë¼ì‹¤ ë•Œ ëª¸ì— ì–´ë–¤ ë³€í™”ê°€ ìˆë‚˜ìš”? (2-5íšŒì°¨ì—ì„œ ê²½í—˜í•œ 'ê°€ìŠ´ì´ ë‹µë‹µí•´ì§€ê³ ', 'ë§ˆìŒì´ ë”°ëœ»í•´ì§€ëŠ”' ì‹ ì²´ ë°˜ì‘)",
    "ê·¸ ê°ì •ì„ ëˆ„êµ°ê°€ì™€ ë‚˜ëˆ„ê³  ì‹¶ìœ¼ì‹ ê°€ìš”? (3-5íšŒì°¨ì—ì„œ íš¨ê³¼ì ì´ì—ˆë˜ ê°€ì¡±, ì´ì›ƒê³¼ì˜ ê°ì • ê³µìœ )",
    "ê°ì •ì´ ë³€í™”í•˜ëŠ” ìˆœê°„ì„ ëŠë¼ì‹  ì ì´ ìˆë‚˜ìš”? (4-5íšŒì°¨ì—ì„œ í™•ì¸ëœ 'ì´ì›ƒê³¼ ëŒ€í™”í•  ë•Œë§ˆë‹¤ ê¸°ë¶„ì´ ì¢‹ì•„ì§€ëŠ”' ê²½í—˜)",
    "ì–´ë–¤ ìƒí™©ì—ì„œ ê¸°ë¶„ì´ ì¢‹ì•„ì§€ì‹œë‚˜ìš”? (1-5íšŒì°¨ì—ì„œ íš¨ê³¼ì ì´ì—ˆë˜ ê°€ì¡±ê³¼ì˜ ì‹œê°„, ì‚°ì±…, ìŒì•… ê°ìƒ ë“±)",
    "ì™¸ë¡œì›€ì„ ëŠë‚„ ë•Œì™€ ê°ì‚¬í•¨ì„ ëŠë‚„ ë•Œì˜ ì°¨ì´ì ì€ ë¬´ì—‡ì¸ê°€ìš”? (5íšŒì°¨ì—ì„œ ê²½í—˜í•œ ë³µí•©ì  ê°ì • ìƒíƒœ ë¶„ì„)",
    "ê°€ì¡± ì‚¬ì§„ì„ ë³¼ ë•Œì™€ ì´ì›ƒê³¼ ëŒ€í™”í•  ë•Œì˜ ê°ì • ë³€í™”ëŠ” ì–´ë– ì‹ ê°€ìš”? (3-5íšŒì°¨ì—ì„œ í™•ì¸ëœ ì •ì„œì  ì•ˆì • íš¨ê³¼)",
    "ì†ìì™€ í•¨ê»˜ ìˆì„ ë•Œì˜ ê°ì • ìƒíƒœëŠ” ì–´ë– ì‹ ê°€ìš”? (3-5íšŒì°¨ì—ì„œ ìì•„ì¡´ì¤‘ê° í–¥ìƒì— ê¸°ì—¬í•œ ê°ì • ê²½í—˜)",
    "í˜¸í¡ ìš´ë™ì„ í•  ë•Œì˜ ê°ì • ë³€í™”ëŠ” ì–´ë– ì‹ ê°€ìš”? (2-5íšŒì°¨ì—ì„œ íš¨ê³¼ì ì´ì—ˆë˜ ëŒ€ì²˜ ì „ëµì˜ ê°ì •ì  íš¨ê³¼)",
    "ì´ì›ƒê³¼ ë§ˆíŠ¸ì— ê°ˆ ë•Œì˜ ê¸°ëŒ€ê°ì€ ì–´ë– ì‹ ê°€ìš”? (4íšŒì°¨ì—ì„œ ì‚¬íšŒì  êµë¥˜ ì¦ì§„ì— ë„ì›€ì´ ë˜ì—ˆë˜ ê¸ì •ì  ê°ì •)"
  ],
        4: [
    "ì™¸ë¡œì›€ì„ ëŠë¼ì‹¤ ë•Œ ì–´ë–¤ ì¼ì„ í•˜ì‹œë©´ ê¸°ë¶„ì´ ì¢‹ì•„ì§€ë‚˜ìš”? (1-5íšŒì°¨ì—ì„œ íš¨ê³¼ì ì´ì—ˆë˜ ì´ì›ƒê³¼ì˜ ëŒ€í™”, ê°€ì¡± ì‚¬ì§„ ë³´ê¸°, ì‚°ì±… ë“±)",
    "ì§§ì€ ì‚°ì±…ì´ë‚˜ í˜¸í¡ ìš´ë™ì„ í•´ë³´ì‹  ì ì´ ìˆë‚˜ìš”? (2-5íšŒì°¨ì—ì„œ ê·œì¹™ì ìœ¼ë¡œ ì‹¤ì²œë˜ì–´ ì˜¨ ëŒ€ì²˜ ì „ëµì˜ ì§€ì†ì  íš¨ê³¼)",
    "ê°ì • ì¼ê¸°ë¥¼ ì¨ë³´ëŠ” ê²ƒì€ ì–´ë–¨ê¹Œìš”? (1íšŒì°¨ì—ì„œ 'ê¸€ì”¨ë¥¼ ì˜ ëª» ì¨ì„œ ì–´ë ¤ìš¸ ê²ƒ ê°™ì•„ìš”'ë¼ê³  í‘œí˜„í–ˆë˜ ëŒ€ì•ˆì  ë°©ë²• ëª¨ìƒ‰)",
    "ìŒì•…ì„ ë“£ê±°ë‚˜ TVë¥¼ ë³´ëŠ” ê²ƒì´ ë„ì›€ì´ ë˜ë‚˜ìš”? (2-5íšŒì°¨ì—ì„œ íŠ¸ë¡œíŠ¸ ìŒì•…ì´ ê¸°ë¶„ ì „í™˜ì— íš¨ê³¼ì ì´ì—ˆë˜ ê²½í—˜)",
    "ì·¨ë¯¸ í™œë™ì„ í†µí•´ ê¸°ë¶„ ì „í™˜ì„ í•´ë³´ì‹  ì ì´ ìˆë‚˜ìš”? (3-5íšŒì°¨ì—ì„œ ê°€ì¡± ì‚¬ì§„ ì •ë¦¬, í™”ë¶„ ê°€ê¾¸ê¸° ë“± ìƒˆë¡œìš´ ì·¨ë¯¸ ê°œë°œ)",
    "ì´ì›ƒê³¼ í•¨ê»˜ ë§ˆíŠ¸ì— ê°€ëŠ” ê²ƒì´ ì–´ë– ì‹ ê°€ìš”? (4íšŒì°¨ì—ì„œ ì‚¬íšŒì  êµë¥˜ ì¦ì§„ì— íš¨ê³¼ì ì´ì—ˆë˜ ì§€ì—­ì‚¬íšŒ í™œë™)",
    "ê°€ì¡±ê³¼ì˜ ì •ê¸°ì  ì—°ë½ ì²´ê³„ë¥¼ êµ¬ì¶•í•˜ëŠ” ê²ƒì€ ì–´ë–¨ê¹Œìš”? (2íšŒì°¨ì—ì„œ í™•ì¸ëœ ì—°ë½ ë¹ˆë„ ê°ì†Œ ë¬¸ì œì˜ êµ¬ì²´ì  í•´ê²°ì±…)",
    "ì†ìì™€ í•¨ê»˜ ê³µì›ì—ì„œ ë†€ì´ë¥¼ í•˜ëŠ” ê²ƒì€ ì–´ë– ì‹ ê°€ìš”? (3-4íšŒì°¨ì—ì„œ ìì•„ì¡´ì¤‘ê° í–¥ìƒì— ê¸°ì—¬í–ˆë˜ ê°€ì¡± í™œë™)",
    "ë§¤ì¼ ì•„ì¹¨ ì‚°ì±… ì‹œê°„ì„ 30ë¶„ì—ì„œ 40ë¶„ìœ¼ë¡œ ëŠ˜ë ¤ë³´ëŠ” ê²ƒì€ ì–´ë–¨ê¹Œìš”? (4-5íšŒì°¨ì—ì„œ 20ë¶„â†’30ë¶„ìœ¼ë¡œ í™•ëŒ€ëœ í™œë™ëŸ‰ ì¦ê°€ ê²½í—˜)",
    "ì´ì›ƒê³¼ì˜ ëŒ€í™”ì—ì„œ ì†ì ì´ì•¼ê¸°ë¥¼ ë‚˜ëˆ„ëŠ” ê²ƒì´ ì–´ë– ì‹ ê°€ìš”? (3-4íšŒì°¨ì—ì„œ ì‚¬íšŒì  êµë¥˜ ì¦ì§„ì— ë„ì›€ì´ ë˜ì—ˆë˜ ì£¼ì œ)"
  ],
    5: [
      "ê°€ì¡±ì—ê²Œ ê¸ì •ì ì¸ ê°ì •ì„ í‘œí˜„í•´ë³¸ë‹¤ë©´ ì–´ë–¤ ë§ì„ í•˜ê³  ì‹¶ìœ¼ì„¸ìš”?",
      "ê°€ì¡±ê³¼ í•¨ê»˜í•˜ê³  ì‹¶ì€ í™œë™ì´ ìˆë‚˜ìš”?",
      "ê°€ì¡±ê³¼ì˜ ì†Œí†µì—ì„œ ê°œì„ í•˜ê³  ì‹¶ì€ ë¶€ë¶„ì´ ìˆë‚˜ìš”?",
      "ê°€ì¡±ê³¼ì˜ ì¶”ì–µ ì¤‘ ê°€ì¥ ì†Œì¤‘í•œ ê²ƒì€ ë¬´ì—‡ì¸ê°€ìš”?",
      "ê°€ì¡±ì—ê²Œ ë„ì›€ì„ ë°›ê³  ì‹¶ì€ ë¶€ë¶„ì´ ìˆë‚˜ìš”?",
      "ê°€ì¡±ê³¼ í•¨ê»˜í•˜ê³  ì‹¶ì€ ì—¬í–‰ì´ë‚˜ ì™¸ì¶œì´ ìˆë‚˜ìš”?",
      "ê°€ì¡±ì—ê²Œ ê°ì‚¬í•œ ë§ˆìŒì„ í‘œí˜„í•˜ê³  ì‹¶ìœ¼ì‹ ê°€ìš”?",
      "ê°€ì¡±ê³¼ì˜ ê´€ê³„ì—ì„œ ê°€ì¥ ì¤‘ìš”í•˜ë‹¤ê³  ìƒê°í•˜ëŠ” ê²ƒì€ ë¬´ì—‡ì¸ê°€ìš”?"
    ]
  })

  // ì²´í¬ëœ ì§ˆë¬¸ë“¤ì„ ì¶”ì í•˜ëŠ” ìƒíƒœ
  const [checkedQuestions, setCheckedQuestions] = useState<Record<number, Set<number>>>({
    1: new Set(),
    2: new Set(),
    3: new Set(),
    4: new Set(),
    5: new Set()
  })

  // ì²´í¬ëœ ì§ˆë¬¸ë“¤ì„ ì €ì¥í•˜ëŠ” ìƒíƒœ
  const [savedCheckedQuestions, setSavedCheckedQuestions] = useState<Record<number, string[]>>({
    1: [],
    2: [],
    3: [],
    4: [],
    5: []
  })

  // ìƒë‹´ ê¸°ë¡ ìƒì„¸ë³´ê¸° ìƒíƒœ ê´€ë¦¬
  const [showDetailStates, setShowDetailStates] = useState<Record<string, boolean>>({})

  // ìƒë‹´ ê¸°ë¡ í‘œì‹œ ì—¬ë¶€ ìƒíƒœ
  const [showRecords, setShowRecords] = useState(false)
  
  // ìƒë‹´ ê¸°ë¡ ìƒíƒœ
  const [clientRecords, setClientRecords] = useState<any[]>([])

  // ë¬´í•œ ë¡œë”© ë°©ì§€ë¥¼ ìœ„í•œ refë“¤
  const isInitialized = useRef(false)
  const lastClientId = useRef<string | null>(null)
  const stepUpdateCount = useRef<{ [key: number]: number }>({ 1: 0, 2: 0, 3: 0, 4: 0, 5: 0 })
  const isFirstMount = useRef(true) // ì´ˆê¸° ë§ˆìš´íŠ¸ ìƒíƒœ ì¶”ì 

  // selectedClientê°€ ë³€ê²½ë  ë•Œ clientRecords ì´ˆê¸°í™” (ë¬´í•œ ë£¨í”„ ë°©ì§€)
  useEffect(() => {
    // ì´ˆê¸° ë Œë”ë§ ì‹œ ë¬´í•œ ë¡œë”© ë°©ì§€
    if (!selectedClient || !selectedClient.id) return
    
    // ì´ë¯¸ ì´ˆê¸°í™”ëœ ê²½ìš° ì¤‘ë³µ ì‹¤í–‰ ë°©ì§€
    if (isInitialized.current && lastClientId.current === selectedClient.id) {
      return
    }

    // ë¬´í•œ ë¡œë”© ë°©ì§€ë¥¼ ìœ„í•œ ì•ˆì „ì¥ì¹˜
    if (stepUpdateCount.current[1] > 0) {
      console.log("ì´ë¯¸ ì´ˆê¸°í™”ëœ ìƒíƒœ, ì¤‘ë³µ ì‹¤í–‰ ë°©ì§€")
      return
    }

    // ì•ˆì „í•œ ìƒíƒœ ì—…ë°ì´íŠ¸
    try {
      const records = mockCounselingRecords[selectedClient.id] || []
      setClientRecords(records)
      lastClientId.current = selectedClient.id
      isInitialized.current = true
      
      console.log(`í´ë¼ì´ì–¸íŠ¸ ${selectedClient.name}ì˜ ìƒë‹´ ê¸°ë¡ ${records.length}ê°œ ë¡œë“œë¨`)
      
      // regenerateStep ìë™ ì‹¤í–‰ ë°©ì§€ - ìˆ˜ë™ìœ¼ë¡œë§Œ ì‹¤í–‰ë˜ë„ë¡ í•¨
      console.log("ìƒíƒœ ì—…ë°ì´íŠ¸ ì²´ì¸ ìˆœí™˜ ë°©ì§€: regenerateStep ìë™ ì‹¤í–‰ ì•ˆí•¨")
      
    } catch (error) {
      console.error("í´ë¼ì´ì–¸íŠ¸ ê¸°ë¡ ë¡œë“œ ì¤‘ ì˜¤ë¥˜:", error)
      isInitialized.current = false
      lastClientId.current = null
    }
  }, [selectedClient?.id]) // selectedClient.name ì œê±°í•˜ì—¬ ë¬´í•œ ë£¨í”„ ë°©ì§€

  // í´ë¼ì´ì–¸íŠ¸ ì„ íƒ í•´ì œ ì‹œ ì´ˆê¸°í™”
  useEffect(() => {
    if (!selectedClient) {
      // ëª¨ë“  ref ì´ˆê¸°í™”
      isInitialized.current = false
      lastClientId.current = null
      stepUpdateCount.current = { 1: 0, 2: 0, 3: 0, 4: 0, 5: 0 }
      
      // ìƒíƒœ ì´ˆê¸°í™”
      setClientRecords([])
      setStepQuestions({
        1: [        
          "ì˜¤ëŠ˜ ê¸°ë¶„ì€ ì–´ë– ì‹ ê°€ìš”? (1-10ì )",
          "ì–´ì œ ë¬´ì—‡ì„ í•˜ì…¨ë‚˜ìš”?",
          "ì˜¤ëŠ˜ ì•„ì¹¨ì— ê¸°ë¶„ì´ ì–´ë– ì…¨ë‚˜ìš”?",
          "ìµœê·¼ì— ì¢‹ì•˜ë˜ ì¼ì´ ìˆë‚˜ìš”?",
        ],
        2: [
          "ì§€ë‚œ ì£¼ì— ê°€ì¡±ê³¼ ë‚˜ëˆˆ ëŒ€í™” ì¤‘ ê¸°ì–µì— ë‚¨ëŠ” ê²ƒì´ ìˆë‚˜ìš”?",
          "ì‚°ì±…ì€ ì˜ í•˜ê³  ê³„ì‹œë‚˜ìš”?",
          "ì´ì›ƒê³¼ ì¸ì‚¬ ë‚˜ëˆ„ì‹¤ ë•Œ ê¸°ë¶„ì´ ì–´ë– ì‹ ê°€ìš”?",
                  "ì´ì›ƒê³¼ì˜ ëŒ€í™” ì¤‘ ê¸°ì–µì— ë‚¨ëŠ” ê²ƒì´ ìˆë‚˜ìš”?"
        ],
            3: [
        "ìš”ì¦˜ ê°€ì¥ ë§ì´ ëŠë¼ì‹œëŠ” ê°ì •ì€ ë¬´ì—‡ì¸ê°€ìš”? (1-5íšŒì°¨ì—ì„œ í™•ì¸ëœ ì™¸ë¡œì›€, ìš°ìš¸ê°, ê°ì‚¬í•¨ ë“± ê°ì • ë³€í™” ì¶”ì´)",
        "ê·¸ ê°ì •ì„ ëŠë¼ì‹¤ ë•Œ ëª¸ì— ì–´ë–¤ ë³€í™”ê°€ ìˆë‚˜ìš”? (2-5íšŒì°¨ì—ì„œ ê²½í—˜í•œ 'ê°€ìŠ´ì´ ë‹µë‹µí•´ì§€ê³ ', 'ë§ˆìŒì´ ë”°ëœ»í•´ì§€ëŠ”' ì‹ ì²´ ë°˜ì‘)",
        "ê·¸ ê°ì •ì„ ëˆ„êµ°ê°€ì™€ ë‚˜ëˆ„ê³  ì‹¶ìœ¼ì‹ ê°€ìš”? (3-5íšŒì°¨ì—ì„œ íš¨ê³¼ì ì´ì—ˆë˜ ê°€ì¡±, ì´ì›ƒê³¼ì˜ ê°ì • ê³µìœ )",
        "ê°ì •ì´ ë³€í™”í•˜ëŠ” ìˆœê°„ì„ ëŠë¼ì‹  ì ì´ ìˆë‚˜ìš”? (4-5íšŒì°¨ì—ì„œ í™•ì¸ëœ 'ì´ì›ƒê³¼ ëŒ€í™”í•  ë•Œë§ˆë‹¤ ê¸°ë¶„ì´ ì¢‹ì•„ì§€ëŠ”' ê²½í—˜)",
        "ì–´ë–¤ ìƒí™©ì—ì„œ ê¸°ë¶„ì´ ì¢‹ì•„ì§€ì‹œë‚˜ìš”? (1-5íšŒì°¨ì—ì„œ íš¨ê³¼ì ì´ì—ˆë˜ ê°€ì¡±ê³¼ì˜ ì‹œê°„, ì‚°ì±…, ìŒì•… ê°ìƒ ë“±)",
      ],
            4: [
        "ì™¸ë¡œì›€ì„ ëŠë¼ì‹¤ ë•Œ ì–´ë–¤ ì¼ì„ í•˜ì‹œë©´ ê¸°ë¶„ì´ ì¢‹ì•„ì§€ë‚˜ìš”? (1-5íšŒì°¨ì—ì„œ íš¨ê³¼ì ì´ì—ˆë˜ ì´ì›ƒê³¼ì˜ ëŒ€í™”, ê°€ì¡± ì‚¬ì§„ ë³´ê¸°, ì‚°ì±… ë“±)",
        "ì§§ì€ ì‚°ì±…ì´ë‚˜ í˜¸í¡ ìš´ë™ì„ í•´ë³´ì‹  ì ì´ ìˆë‚˜ìš”? (2-5íšŒì°¨ì—ì„œ ê·œì¹™ì ìœ¼ë¡œ ì‹¤ì²œë˜ì–´ ì˜¨ ëŒ€ì²˜ ì „ëµì˜ ì§€ì†ì  íš¨ê³¼)",
        "ê°ì • ì¼ê¸°ë¥¼ ì¨ë³´ëŠ” ê²ƒì€ ì–´ë–¨ê¹Œìš”? (1íšŒì°¨ì—ì„œ 'ê¸€ì”¨ë¥¼ ì˜ ëª» ì¨ì„œ ì–´ë ¤ìš¸ ê²ƒ ê°™ì•„ìš”'ë¼ê³  í‘œí˜„í–ˆë˜ ëŒ€ì•ˆì  ë°©ë²• ëª¨ìƒ‰)",
        "ìŒì•…ì„ ë“£ê±°ë‚˜ TVë¥¼ ë³´ëŠ” ê²ƒì´ ë„ì›€ì´ ë˜ë‚˜ìš”? (2-5íšŒì°¨ì—ì„œ íŠ¸ë¡œíŠ¸ ìŒì•…ì´ ê¸°ë¶„ ì „í™˜ì— íš¨ê³¼ì ì´ì—ˆë˜ ê²½í—˜)",
      ],
        5: [
          "ê°€ì¡±ì—ê²Œ ê¸ì •ì ì¸ ê°ì •ì„ í‘œí˜„í•´ë³¸ë‹¤ë©´ ì–´ë–¤ ë§ì„ í•˜ê³  ì‹¶ìœ¼ì„¸ìš”?",
          "ê°€ì¡±ê³¼ í•¨ê»˜í•˜ê³  ì‹¶ì€ í™œë™ì´ ìˆë‚˜ìš”?",
          "ê°€ì¡±ê³¼ì˜ ì†Œí†µì—ì„œ ê°œì„ í•˜ê³  ì‹¶ì€ ë¶€ë¶„ì´ ìˆë‚˜ìš”?",
          "ê°€ì¡±ê³¼ì˜ ê´€ê³„ì—ì„œ ê°€ì¥ ì¤‘ìš”í•˜ë‹¤ê³  ìƒê°í•˜ëŠ” ê²ƒì€ ë¬´ì—‡ì¸ê°€ìš”?"
        ]
      })
      setCheckedQuestions({
        1: new Set(),
        2: new Set(),
        3: new Set(),
        4: new Set(),
        5: new Set()
      })
      setSavedCheckedQuestions({
        1: [],
        2: [],
        3: [],
        4: [],
        5: []
      })
      setCounselingNotes("")
    }
  }, [selectedClient])

  // ì»´í¬ë„ŒíŠ¸ ì–¸ë§ˆìš´íŠ¸ ì‹œ cleanup (ë¬´í•œ ë¡œë”© ë°©ì§€)
  useEffect(() => {
    return () => {
      // ëª¨ë“  ref ì´ˆê¸°í™”
      isInitialized.current = false
      lastClientId.current = null
      stepUpdateCount.current = { 1: 0, 2: 0, 3: 0, 4: 0, 5: 0 }
      
      console.log("ClientManagement ì»´í¬ë„ŒíŠ¸ cleanup ì™„ë£Œ")
    }
  }, [])

  // ë¬´í•œ ë£¨í”„ ë°©ì§€ë¥¼ ìœ„í•œ ë””ë°”ìš´ìŠ¤ ì²˜ë¦¬
  const [debouncedSearchTerm, setDebouncedSearchTerm] = useState(searchTerm)
  
  useEffect(() => {
    // ì´ˆê¸° ë Œë”ë§ ì‹œ ë¬´í•œ ë¡œë”© ë°©ì§€
    if (searchTerm === debouncedSearchTerm) return
    
    const timer = setTimeout(() => {
      setDebouncedSearchTerm(searchTerm)
    }, 300)
    
    return () => clearTimeout(timer)
  }, [searchTerm, debouncedSearchTerm])

  // filteredClients ë©”ëª¨ì´ì œì´ì…˜ (ë¬´í•œ ë£¨í”„ ë°©ì§€)
  const filteredClients = useMemo(() => {
    return mockClients.filter((client) => {
      const matchesSearch = client.name.toLowerCase().includes(debouncedSearchTerm.toLowerCase())
      const matchesPriority = filterPriority === "ì „ì²´" || client.priority === filterPriority
      return matchesSearch && matchesPriority
    })
  }, [debouncedSearchTerm, filterPriority])

  const toggleDetail = useCallback((recordId: string) => {
    setShowDetailStates(prev => ({
      ...prev,
      [recordId]: !prev[recordId]
    }))
  }, []) // ì˜ì¡´ì„± ë°°ì—´ ë¹„ì›€ - í•¨ìˆ˜ ë‚´ë¶€ì—ì„œ ì™¸ë¶€ ìƒíƒœë¥¼ ì°¸ì¡°í•˜ì§€ ì•ŠìŒ

  // ì²´í¬ë°•ìŠ¤ í† ê¸€ í•¨ìˆ˜
  const toggleQuestionCheck = useCallback((stepNumber: number, questionIndex: number) => {
    setCheckedQuestions(prev => {
      const newChecked = { ...prev }
      const stepSet = new Set(newChecked[stepNumber])
      
      if (stepSet.has(questionIndex)) {
        stepSet.delete(questionIndex)
      } else {
        stepSet.add(questionIndex)
      }
      
      newChecked[stepNumber] = stepSet
      return newChecked
    })
  }, []) // ì˜ì¡´ì„± ë°°ì—´ ë¹„ì›€ - í•¨ìˆ˜ ë‚´ë¶€ì—ì„œ ì™¸ë¶€ ìƒíƒœë¥¼ ì°¸ì¡°í•˜ì§€ ì•ŠìŒ

  // ìƒíƒœ ì´ˆê¸°í™” í•¨ìˆ˜ (ë¬´í•œ ë£¨í”„ ë°©ì§€)
  const resetStates = useCallback(() => {
    setStepQuestions({
      1: [],
      2: [],
      3: [],
      4: [],
      5: []
    })
    setCheckedQuestions({})
    setSavedCheckedQuestions({})
    setCounselingNotes("")
    console.log("ëª¨ë“  ìƒíƒœê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.")
  }, []) // ì˜ì¡´ì„± ë°°ì—´ ë¹„ì›€ - í•¨ìˆ˜ ë‚´ë¶€ì—ì„œ ì™¸ë¶€ ìƒíƒœë¥¼ ì°¸ì¡°í•˜ì§€ ì•ŠìŒ

  // ì²´í¬ëœ ì§ˆë¬¸ë“¤ì„ ì €ì¥í•˜ëŠ” í•¨ìˆ˜ (ë¬´í•œ ë£¨í”„ ë°©ì§€)
  const saveCheckedQuestions = useCallback(() => {
    // ì¤‘ë³µ ì‹¤í–‰ ë°©ì§€
    if (Object.values(checkedQuestions).every(set => set.size === 0)) {
      alert("ì²´í¬ëœ ì§ˆë¬¸ì´ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ì§ˆë¬¸ì„ ì²´í¬í•´ì£¼ì„¸ìš”.")
      return
    }

    const newSavedQuestions: Record<number, string[]> = { 1: [], 2: [], 3: [], 4: [], 5: [] }
    
    // ì²´í¬ëœ ì§ˆë¬¸ë“¤ ìˆ˜ì§‘ (ì•ˆì „í•œ ì²˜ë¦¬)
    Object.keys(checkedQuestions).forEach(stepNum => {
      const stepNumber = parseInt(stepNum)
      const checkedIndices = checkedQuestions[stepNumber]
      const currentQuestions = stepQuestions[stepNumber as keyof typeof stepQuestions] || []
      
      if (checkedIndices && currentQuestions) {
        checkedIndices.forEach(index => {
          if (currentQuestions[index]) {
            newSavedQuestions[stepNumber].push(currentQuestions[index])
          }
        })
      }
    })
    
    // ì²´í¬ëœ ì§ˆë¬¸ì´ ì—†ìœ¼ë©´ ì•Œë¦¼
    const totalChecked = Object.values(newSavedQuestions).reduce((sum, questions) => sum + questions.length, 0)
    if (totalChecked === 0) {
      alert("ì²´í¬ëœ ì§ˆë¬¸ì´ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ì§ˆë¬¸ì„ ì²´í¬í•´ì£¼ì„¸ìš”.")
      return
    }
    
    // ìƒíƒœ ì—…ë°ì´íŠ¸ë¥¼ í•œ ë²ˆì— ì²˜ë¦¬ (ë¬´í•œ ë£¨í”„ ë°©ì§€)
    setSavedCheckedQuestions(newSavedQuestions)
    
    // ìƒë‹´ ë©”ëª¨ì— ì²´í¬ëœ ì§ˆë¬¸ë“¤ ì¶”ê°€ (ë¬´í•œ ë£¨í”„ ë°©ì§€)
    const checkedQuestionsText = Object.entries(newSavedQuestions)
      .filter(([_, questions]) => questions.length > 0)
      .map(([stepNum, questions]) => {
        const stepNames = {
          1: "ğŸ” ê¸°ë³¸ ì²´í¬ë¦¬ìŠ¤íŠ¸",
          2: "ğŸ¯ ì£¼ì œ ì„ ì •",
          3: "ğŸ’­ ê°ì • í‘œí˜„ ìœ ë„",
          4: "ğŸ› ï¸ ëŒ€ì²˜ ì „ëµ",
          5: "ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ ê°€ì¡± ì—°ê³„"
        }
        return `${stepNames[parseInt(stepNum) as keyof typeof stepNames]}\n${questions.map(q => `â€¢ ${q}`).join('\n')}`
      })
      .join("\n\n")
    
    if (checkedQuestionsText) {
      const timestamp = new Date().toLocaleString('ko-KR', { 
        month: 'short', 
        day: 'numeric', 
        hour: '2-digit', 
        minute: '2-digit' 
      })
      
      const newNote = `[ì²´í¬ëœ ì§ˆë¬¸ë“¤ - ${timestamp}]\n${checkedQuestionsText}`
      
      // ê¸°ì¡´ ë©”ëª¨ê°€ ìˆìœ¼ë©´ ì¶”ê°€, ì—†ìœ¼ë©´ ìƒˆë¡œ ìƒì„±
      setCounselingNotes(prev => {
        if (!prev || prev.trim() === '') {
          return newNote
        }
        return prev + "\n\n" + newNote
      })
    }
    
    // ì„±ê³µ ì•Œë¦¼
    alert(`âœ… ${totalChecked}ê°œì˜ ì²´í¬ëœ ì§ˆë¬¸ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!\n\nìƒë‹´ ë©”ëª¨ì— ìë™ìœ¼ë¡œ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.`)
    console.log("ì €ì¥ëœ ì²´í¬ëœ ì§ˆë¬¸ë“¤:", newSavedQuestions)
  }, [checkedQuestions, stepQuestions]) // í•„ìš”í•œ ì˜ì¡´ì„±ë§Œ í¬í•¨

  const getEmotionalStateColor = (state: string) => {
    switch (state) {
      case "ì¢‹ìŒ":
        return "text-green-600 bg-green-50"
      case "ë³´í†µ":
        return "text-blue-600 bg-blue-50"
      case "ì£¼ì˜":
        return "text-orange-600 bg-orange-50"
      case "ìœ„í—˜":
        return "text-red-600 bg-red-50"
      default:
        return "text-gray-600 bg-gray-50"
    }
  }

  const getTrendIcon = (trend: string) => {
    switch (trend) {
      case "ê°œì„ ":
        return <TrendingUp className="h-4 w-4 text-green-600" />
      case "ì•…í™”":
        return <TrendingDown className="h-4 w-4 text-red-600" />
      case "ìœ ì§€":
        return <Minus className="h-4 w-4 text-blue-600" />
      default:
        return null
    }
  }

  // ìƒë‹´ ì§„í–‰ ê´€ë ¨ í•¸ë“¤ëŸ¬ë“¤
  const handleScoreChange = (type: keyof typeof emotionalScores, value: number) => {
    setEmotionalScores(prev => ({ ...prev, [type]: value }))
  }

  const handleMoodSelect = (mood: string) => {
    setSelectedMood(mood)
  }

  const handleStartSession = () => {
    setSessionStatus("ì§„í–‰ì¤‘")
    setSessionStartTime(new Date())
    // ìƒë‹´ ì‹œì‘ ì‹œ ì„ì‹œ ì €ì¥ ë°ì´í„°ê°€ ìˆìœ¼ë©´ ë¶ˆëŸ¬ì˜¤ê¸°
    loadDraft()
  }

  const handlePauseSession = () => {
    setSessionStatus("ì¼ì‹œì •ì§€")
  }

  const handleResumeSession = () => {
    setSessionStatus("ì§„í–‰ì¤‘")
  }

  const handleCompleteSession = () => {
    if (!selectedClient) return
    
          // ì²´í¬ëœ ì§ˆë¬¸ë“¤ ì •ë³´ ì¶”ê°€
      const checkedQuestionsInfo = Object.entries(savedCheckedQuestions)
        .filter(([_, questions]) => questions.length > 0)
        .map(([stepNum, questions]) => {
          const stepNames = {
            1: "ê¸°ë³¸ ì²´í¬ë¦¬ìŠ¤íŠ¸",
            2: "ì£¼ì œ ì„ ì •",
            3: "ê°ì • í‘œí˜„ ìœ ë„", 
            4: "ëŒ€ì²˜ ì „ëµ",
            5: "ê°€ì¡± ì—°ê³„"
          }
          return `${stepNames[parseInt(stepNum) as keyof typeof stepNames]}: ${questions.join(", ")}`
        })
        .join(" | ")

      // ìƒë‹´ ë©”ëª¨ ì „ì²´ ë‚´ìš© êµ¬ì„±
      const fullCounselingNotes = (() => {
        let notes = counselingNotes || "AI ê°€ì´ë“œ ê¸°ë°˜ ìƒë‹´ ì§„í–‰"
        
        // ì²´í¬ëœ ì§ˆë¬¸ë“¤ì´ ìˆìœ¼ë©´ ì¶”ê°€ (ì‚¬ìš©ìê°€ ì›í•˜ëŠ” í˜•ì‹ìœ¼ë¡œ)
        if (Object.values(savedCheckedQuestions).some(questions => questions.length > 0)) {
          const timestamp = new Date().toLocaleString('ko-KR', { 
            month: 'short', 
            day: 'numeric', 
            hour: '2-digit', 
            minute: '2-digit' 
          })
          
          notes += `\n\n[ì²´í¬ëœ ì§ˆë¬¸ë“¤ - ${timestamp}]`
          
          Object.entries(savedCheckedQuestions).forEach(([stepNum, questions]) => {
            if (questions.length > 0) {
              const stepNames = {
                1: "ğŸ” ê¸°ë³¸ ì²´í¬ë¦¬ìŠ¤íŠ¸",
                2: "ğŸ¯ ì£¼ì œ ì„ ì •",
                3: "ğŸ’­ ê°ì • í‘œí˜„ ìœ ë„",
                4: "ğŸ› ï¸ ëŒ€ì²˜ ì „ëµ",
                5: "ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ ê°€ì¡± ì—°ê³„"
              }
              notes += `\n${stepNames[parseInt(stepNum) as keyof typeof stepNames]}`
              questions.forEach(question => {
                notes += `\nâ€¢ ${question}`
              })
            }
          })
        }
        
        // ë‹¤ìŒ ìƒë‹´ ê³„íšì´ ìˆìœ¼ë©´ ì¶”ê°€
        if (nextSessionTopic || nextSessionDate || specialNotes) {
          notes += "\n\n[ë‹¤ìŒ ìƒë‹´ ê³„íš]"
          if (nextSessionTopic) notes += `\nâ€¢ ë‹¤ìŒ ìƒë‹´ ì£¼ì œ: ${nextSessionTopic}`
          if (nextSessionDate) notes += `\nâ€¢ ì˜ˆì •ì¼: ${nextSessionDate}`
          if (specialNotes) notes += `\nâ€¢ íŠ¹ì´ì‚¬í•­: ${specialNotes}`
        }
        
        return notes
      })()

      // ìƒˆë¡œìš´ ìƒë‹´ ê¸°ë¡ ìƒì„±
      const newCounselingRecord = {
        id: `session_${Date.now()}`,
        date: new Date().toISOString().split('T')[0], // ì˜¤ëŠ˜ ë‚ ì§œ
        type: "ì¼ë°˜" as const,
        duration: 60, // ê¸°ë³¸ 60ë¶„
        notes: fullCounselingNotes,
        aiSummary: `6íšŒì°¨ ìƒë‹´: ${selectedMood} ê¸°ë¶„, ìš°ìš¸(${emotionalScores.depression}) ë¶ˆì•ˆ(${emotionalScores.anxiety}) ì™¸ë¡œì›€(${emotionalScores.loneliness}) ë¶„ë…¸(${emotionalScores.anger}) ì ìˆ˜. ${nextSessionTopic ? `ë‹¤ìŒ ìƒë‹´ ì£¼ì œ: ${nextSessionTopic}` : ''}${checkedQuestionsInfo ? ` | ì²´í¬ëœ ì§ˆë¬¸ë“¤: ${checkedQuestionsInfo}` : ''}`,
        emotionalScores: {
          depression: emotionalScores.depression,
          anxiety: emotionalScores.anxiety,
          loneliness: emotionalScores.loneliness,
          anger: emotionalScores.anger
        }
      }

    // ìƒë‹´ ê¸°ë¡ì— ì¶”ê°€
    setClientRecords((prev: any[]) => [newCounselingRecord, ...prev])
    
          // ì…ë ¥ í•„ë“œë“¤ ì´ˆê¸°í™”
      setEmotionalScores({
        depression: 5,
        anxiety: 5,
        loneliness: 5,
        anger: 5
      })
      setSelectedMood("ë³´í†µ")
      setCounselingNotes("")
      setSessionTopic("")
      setSessionMethod("ëŒ€í™” ì¤‘ì‹¬")
      setClientReaction("")
      setImportantStatements("")
      setSessionSummary("")
      setNextSessionTopic("")
      setNextSessionDate("")
      setSpecialNotes("")
      setSessionStatus("ì¤€ë¹„")
      
      // ì²´í¬ëœ ì§ˆë¬¸ë“¤ ìƒíƒœ ì´ˆê¸°í™”
      setCheckedQuestions({
        1: new Set(),
        2: new Set(),
        3: new Set(),
        4: new Set(),
        5: new Set()
      })
      setSavedCheckedQuestions({
        1: [],
        2: [],
        3: [],
        4: [],
        5: []
      })
    
    // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ì„ì‹œ ì €ì¥ ë°ì´í„° ì‚­ì œ
    localStorage.removeItem(`counseling_draft_${selectedClient.id}`)
    
    // ìƒë‹´ ì™„ë£Œ ì•Œë¦¼
    alert("6íšŒì°¨ ìƒë‹´ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ìƒë‹´ ê¸°ë¡ì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.")
    
    console.log("ìƒë‹´ ì™„ë£Œ ë° ê¸°ë¡ ì¶”ê°€:", newCounselingRecord)
  }

  const handleSaveDraft = () => {
    // ì„ì‹œ ì €ì¥ ë¡œì§
    const draftData = {
      emotionalScores,
      selectedMood,
      counselingNotes,
      sessionTopic,
      sessionMethod,
      clientReaction,
      importantStatements,
      sessionSummary,
      nextSessionTopic,
      nextSessionDate,
      specialNotes,
      timestamp: new Date().toISOString()
    }
    localStorage.setItem(`counseling_draft_${selectedClient?.id}`, JSON.stringify(draftData))
    alert("ì„ì‹œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.")
  }

  const loadDraft = () => {
    if (selectedClient) {
      const draftData = localStorage.getItem(`counseling_draft_${selectedClient.id}`)
      if (draftData) {
        try {
          const parsed = JSON.parse(draftData)
          setEmotionalScores(parsed.emotionalScores || emotionalScores)
          setSelectedMood(parsed.selectedMood || "ë³´í†µ")
          setCounselingNotes(parsed.counselingNotes || "")
          setSessionTopic(parsed.sessionTopic || "")
          setSessionMethod(parsed.sessionMethod || "ëŒ€í™” ì¤‘ì‹¬")
          setClientReaction(parsed.clientReaction || "")
          setImportantStatements(parsed.importantStatements || "")
          setSessionSummary(parsed.sessionSummary || "")
          setNextSessionTopic(parsed.nextSessionTopic || "")
          setNextSessionDate(parsed.nextSessionDate || "")
          setSpecialNotes(parsed.specialNotes || "")
        } catch (error) {
          console.error("ì„ì‹œ ì €ì¥ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:", error)
        }
      }
    }
  }

  // AI ê°€ì´ë“œ ë‹¨ê³„ë³„ ì¬ìƒì„± í•¨ìˆ˜ (ë”ë¯¸ ë°ì´í„°) - ë¬´í•œ ë£¨í”„ ë°©ì§€
  const regenerateStep = useCallback((stepNumber: number) => {
    if (!selectedClient) return

    // ë¬´í•œ ë£¨í”„ ë°©ì§€: ê° ë‹¨ê³„ë³„ ì—…ë°ì´íŠ¸ íšŸìˆ˜ ì œí•œ
    const currentUpdateCount = stepUpdateCount.current[stepNumber] || 0
    if (currentUpdateCount > 2) { // 3ì—ì„œ 2ë¡œ ì¤„ì„
      console.warn(`Step ${stepNumber} ì—…ë°ì´íŠ¸ íšŸìˆ˜ ì œí•œ ë„ë‹¬: ${currentUpdateCount}`)
      return
    }

    console.log(`Step ${stepNumber} ì¬ìƒì„± ì‹œì‘ (${currentUpdateCount + 1}ë²ˆì§¸ ì‹œë„)`)

    // í˜„ì¬ ë‹¨ê³„ì˜ ì§ˆë¬¸ë“¤
    const currentQuestions = stepQuestions[stepNumber as keyof typeof stepQuestions] || []
    const checkedIndices = checkedQuestions[stepNumber] || new Set()
    
    // ì²´í¬ëœ ì§ˆë¬¸ë“¤ì€ ë³´ì¡´
    const preservedQuestions: string[] = []
    const preservedIndices: number[] = []
    
    currentQuestions.forEach((question: string, index: number) => {
      if (checkedIndices.has(index)) {
        preservedQuestions.push(question)
        preservedIndices.push(index)
      }
    })

    // ë”ë¯¸ ë°ì´í„°ë¡œ ìƒˆë¡œìš´ ì§ˆë¬¸ë“¤ ìƒì„± (ë¹„ë™ê¸° ì²˜ë¦¬ ë°©ì§€)
    const newQuestions = generateDummyQuestions(stepNumber, selectedClient, clientRecords, emotionalScores)
    
    // ë³´ì¡´ëœ ì§ˆë¬¸ë“¤ê³¼ ìƒˆë¡œìš´ ì§ˆë¬¸ë“¤ í•©ì¹˜ê¸°
    const finalQuestions = [...preservedQuestions, ...newQuestions]
    
    // ìƒíƒœ ì—…ë°ì´íŠ¸ë¡œ UIì— ë°”ë¡œ ë°˜ì˜ (ë¬´í•œ ë£¨í”„ ë°©ì§€)
    setStepQuestions(prev => {
      // ì´ì „ ìƒíƒœì™€ ë™ì¼í•œ ê²½ìš° ì—…ë°ì´íŠ¸í•˜ì§€ ì•ŠìŒ (ë¬´í•œ ë£¨í”„ ë°©ì§€)
      const stepKey = stepNumber as keyof typeof prev
      
      // ê°„ë‹¨í•œ ê¸¸ì´ ë¹„êµë¡œ ë¬´í•œ ë£¨í”„ ë°©ì§€
      if (prev[stepKey] && prev[stepKey].length === finalQuestions.length) {
        const isSame = prev[stepKey].every((q, i) => q === finalQuestions[i])
        if (isSame) {
          console.log(`Step ${stepNumber} ë™ì¼í•œ ë‚´ìš©ìœ¼ë¡œ ì—…ë°ì´íŠ¸ ê±´ë„ˆëœ€`)
          return prev
        }
      }
      
      const newState = {
        ...prev,
        [stepKey]: finalQuestions
      }
      
      // ì—…ë°ì´íŠ¸ íšŸìˆ˜ ì¦ê°€
      stepUpdateCount.current[stepNumber] = (stepUpdateCount.current[stepNumber] || 0) + 1
      
      console.log(`Step ${stepNumber} ìƒíƒœ ì—…ë°ì´íŠ¸ ì™„ë£Œ (${stepUpdateCount.current[stepNumber]}ë²ˆì§¸)`)
      return newState
    })
    
    // ì²´í¬ëœ ì§ˆë¬¸ë“¤ì˜ ì¸ë±ìŠ¤ ì¬ì¡°ì •
    const newCheckedIndices = new Set<number>()
    preservedIndices.forEach((oldIndex, newIndex) => {
      newCheckedIndices.add(newIndex)
    })
    
    setCheckedQuestions(prev => ({
      ...prev,
      [stepNumber]: newCheckedIndices
    }))
    
    console.log(`Step ${stepNumber} ë”ë¯¸ ì¬ìƒì„± ì™„ë£Œ:`, {
      preservedCount: preservedQuestions.length,
      newCount: newQuestions.length,
      totalCount: finalQuestions.length,
      updateCount: stepUpdateCount.current[stepNumber]
    })
  }, [selectedClient?.id, clientRecords.length, emotionalScores]) // ì˜ì¡´ì„± ë°°ì—´ ìµœì í™”í•˜ì—¬ ë¬´í•œ ë£¨í”„ ë°©ì§€

  // ë”ë¯¸ ì§ˆë¬¸ ìƒì„± í•¨ìˆ˜
  const generateDummyQuestions = useCallback((stepNumber: number, client: Client, records: any[], emotionalScores: any): string[] => {
    const baseQuestions = {
      1: [
        "ì˜¤ëŠ˜ ê¸°ë¶„ì€ ì–´ë– ì‹ ê°€ìš”? (1-10ì )",
        "ì ì€ ì˜ ì£¼ë¬´ì…¨ë‚˜ìš”?",
        "ì‹ì‚¬ëŠ” ì œëŒ€ë¡œ í•˜ì…¨ë‚˜ìš”?",
        "ëª¸ì— ì•„í”ˆ ê³³ì€ ì—†ìœ¼ì‹ ê°€ìš”?",
        "ì˜¤ëŠ˜ í•˜ë£¨ ê³„íšì´ ìˆìœ¼ì‹ ê°€ìš”?",
        "ì–´ì œ ë¬´ì—‡ì„ í•˜ì…¨ë‚˜ìš”?",
        "ì˜¤ëŠ˜ ì•„ì¹¨ì— ê¸°ë¶„ì´ ì–´ë– ì…¨ë‚˜ìš”?",
        "ìµœê·¼ì— ì¢‹ì•˜ë˜ ì¼ì´ ìˆë‚˜ìš”?"
      ],
      2: [
        "ì§€ë‚œ ì£¼ì— ê°€ì¡±ê³¼ ë‚˜ëˆˆ ëŒ€í™” ì¤‘ ê¸°ì–µì— ë‚¨ëŠ” ê²ƒì´ ìˆë‚˜ìš”?",
        "ì‚°ì±…ì€ ì˜ í•˜ê³  ê³„ì‹œë‚˜ìš”?",
        "ì´ì›ƒê³¼ ì¸ì‚¬ ë‚˜ëˆ„ì‹¤ ë•Œ ê¸°ë¶„ì´ ì–´ë– ì‹ ê°€ìš”?",
        "ìµœê·¼ì— ê°€ì¡±ê³¼ í•¨ê»˜í•œ ìµœê·¼ í™œë™ì´ ìˆë‚˜ìš”?",
        "ì´ì›ƒê³¼ì˜ ì†Œí†µì—ì„œ ëŠë‚€ ì ì´ ìˆìœ¼ì‹ ê°€ìš”?",
        "ê°€ì¡±ì—ê²Œ ì „í™”ë¥¼ ë°›ì€ ì ì´ ìˆë‚˜ìš”?",
        "ê°€ì¡± ì‚¬ì§„ì„ ë³´ì‹œë©´ì„œ ì–´ë–¤ ì¶”ì–µì´ ë– ì˜¤ë¥´ì‹œë‚˜ìš”?",
        "ì´ì›ƒê³¼ì˜ ëŒ€í™” ì¤‘ ê¸°ì–µì— ë‚¨ëŠ” ê²ƒì´ ìˆë‚˜ìš”?"
      ],
          3: [
      "ìš”ì¦˜ ê°€ì¥ ë§ì´ ëŠë¼ì‹œëŠ” ê°ì •ì€ ë¬´ì—‡ì¸ê°€ìš”? (1-5íšŒì°¨ì—ì„œ í™•ì¸ëœ ì™¸ë¡œì›€, ìš°ìš¸ê°, ê°ì‚¬í•¨ ë“± ê°ì • ë³€í™” ì¶”ì´)",
      "ê·¸ ê°ì •ì„ ëŠë¼ì‹¤ ë•Œ ëª¸ì— ì–´ë–¤ ë³€í™”ê°€ ìˆë‚˜ìš”? (2-5íšŒì°¨ì—ì„œ ê²½í—˜í•œ 'ê°€ìŠ´ì´ ë‹µë‹µí•´ì§€ê³ ', 'ë§ˆìŒì´ ë”°ëœ»í•´ì§€ëŠ”' ì‹ ì²´ ë°˜ì‘)",
      "ê·¸ ê°ì •ì„ ëˆ„êµ°ê°€ì™€ ë‚˜ëˆ„ê³  ì‹¶ìœ¼ì‹ ê°€ìš”? (3-5íšŒì°¨ì—ì„œ íš¨ê³¼ì ì´ì—ˆë˜ ê°€ì¡±, ì´ì›ƒê³¼ì˜ ê°ì • ê³µìœ )",
      "ê°ì •ì´ ë³€í™”í•˜ëŠ” ìˆœê°„ì„ ëŠë¼ì‹  ì ì´ ìˆë‚˜ìš”? (4-5íšŒì°¨ì—ì„œ í™•ì¸ëœ 'ì´ì›ƒê³¼ ëŒ€í™”í•  ë•Œë§ˆë‹¤ ê¸°ë¶„ì´ ì¢‹ì•„ì§€ëŠ”' ê²½í—˜)",
      "ì–´ë–¤ ìƒí™©ì—ì„œ ê¸°ë¶„ì´ ì¢‹ì•„ì§€ì‹œë‚˜ìš”? (1-5íšŒì°¨ì—ì„œ íš¨ê³¼ì ì´ì—ˆë˜ ê°€ì¡±ê³¼ì˜ ì‹œê°„, ì‚°ì±…, ìŒì•… ê°ìƒ ë“±)",
      "ì™¸ë¡œì›€ì„ ëŠë‚„ ë•Œì™€ ê°ì‚¬í•¨ì„ ëŠë‚„ ë•Œì˜ ì°¨ì´ì ì€ ë¬´ì—‡ì¸ê°€ìš”? (5íšŒì°¨ì—ì„œ ê²½í—˜í•œ ë³µí•©ì  ê°ì • ìƒíƒœ ë¶„ì„)",
      "ê°€ì¡± ì‚¬ì§„ì„ ë³¼ ë•Œì™€ ì´ì›ƒê³¼ ëŒ€í™”í•  ë•Œì˜ ê°ì • ë³€í™”ëŠ” ì–´ë– ì‹ ê°€ìš”? (3-5íšŒì°¨ì—ì„œ í™•ì¸ëœ ì •ì„œì  ì•ˆì • íš¨ê³¼)",
      "ì†ìì™€ í•¨ê»˜ ìˆì„ ë•Œì˜ ê°ì • ìƒíƒœëŠ” ì–´ë– ì‹ ê°€ìš”? (3-5íšŒì°¨ì—ì„œ ìì•„ì¡´ì¤‘ê° í–¥ìƒì— ê¸°ì—¬í•œ ê°ì • ê²½í—˜)",
      "í˜¸í¡ ìš´ë™ì„ í•  ë•Œì˜ ê°ì • ë³€í™”ëŠ” ì–´ë– ì‹ ê°€ìš”? (2-5íšŒì°¨ì—ì„œ íš¨ê³¼ì ì´ì—ˆë˜ ëŒ€ì²˜ ì „ëµì˜ ê°ì •ì  íš¨ê³¼)",
      "ì´ì›ƒê³¼ ë§ˆíŠ¸ì— ê°ˆ ë•Œì˜ ê¸°ëŒ€ê°ì€ ì–´ë– ì‹ ê°€ìš”? (4íšŒì°¨ì—ì„œ ì‚¬íšŒì  êµë¥˜ ì¦ì§„ì— ë„ì›€ì´ ë˜ì—ˆë˜ ê¸ì •ì  ê°ì •)"
    ],
          4: [
      "ì™¸ë¡œì›€ì„ ëŠë¼ì‹¤ ë•Œ ì–´ë–¤ ì¼ì„ í•˜ì‹œë©´ ê¸°ë¶„ì´ ì¢‹ì•„ì§€ë‚˜ìš”? (1-5íšŒì°¨ì—ì„œ íš¨ê³¼ì ì´ì—ˆë˜ ì´ì›ƒê³¼ì˜ ëŒ€í™”, ê°€ì¡± ì‚¬ì§„ ë³´ê¸°, ì‚°ì±… ë“±)",
      "ì§§ì€ ì‚°ì±…ì´ë‚˜ í˜¸í¡ ìš´ë™ì„ í•´ë³´ì‹  ì ì´ ìˆë‚˜ìš”? (2-5íšŒì°¨ì—ì„œ ê·œì¹™ì ìœ¼ë¡œ ì‹¤ì²œë˜ì–´ ì˜¨ ëŒ€ì²˜ ì „ëµì˜ ì§€ì†ì  íš¨ê³¼)",
      "ê°ì • ì¼ê¸°ë¥¼ ì¨ë³´ëŠ” ê²ƒì€ ì–´ë–¨ê¹Œìš”? (1íšŒì°¨ì—ì„œ 'ê¸€ì”¨ë¥¼ ì˜ ëª» ì¨ì„œ ì–´ë ¤ìš¸ ê²ƒ ê°™ì•„ìš”'ë¼ê³  í‘œí˜„í–ˆë˜ ëŒ€ì•ˆì  ë°©ë²• ëª¨ìƒ‰)",
      "ìŒì•…ì„ ë“£ê±°ë‚˜ TVë¥¼ ë³´ëŠ” ê²ƒì´ ë„ì›€ì´ ë˜ë‚˜ìš”? (2-5íšŒì°¨ì—ì„œ íŠ¸ë¡œíŠ¸ ìŒì•…ì´ ê¸°ë¶„ ì „í™˜ì— íš¨ê³¼ì ì´ì—ˆë˜ ê²½í—˜)",
      "ì·¨ë¯¸ í™œë™ì„ í†µí•´ ê¸°ë¶„ ì „í™˜ì„ í•´ë³´ì‹  ì ì´ ìˆë‚˜ìš”? (3-5íšŒì°¨ì—ì„œ ê°€ì¡± ì‚¬ì§„ ì •ë¦¬, í™”ë¶„ ê°€ê¾¸ê¸° ë“± ìƒˆë¡œìš´ ì·¨ë¯¸ ê°œë°œ)",
      "ì´ì›ƒê³¼ í•¨ê»˜ ë§ˆíŠ¸ì— ê°€ëŠ” ê²ƒì´ ì–´ë– ì‹ ê°€ìš”? (4íšŒì°¨ì—ì„œ ì‚¬íšŒì  êµë¥˜ ì¦ì§„ì— íš¨ê³¼ì ì´ì—ˆë˜ ì§€ì—­ì‚¬íšŒ í™œë™)",
      "ê°€ì¡±ê³¼ì˜ ì •ê¸°ì  ì—°ë½ ì²´ê³„ë¥¼ êµ¬ì¶•í•˜ëŠ” ê²ƒì€ ì–´ë–¨ê¹Œìš”? (2íšŒì°¨ì—ì„œ í™•ì¸ëœ ì—°ë½ ë¹ˆë„ ê°ì†Œ ë¬¸ì œì˜ êµ¬ì²´ì  í•´ê²°ì±…)",
      "ì†ìì™€ í•¨ê»˜ ê³µì›ì—ì„œ ë†€ì´ë¥¼ í•˜ëŠ” ê²ƒì€ ì–´ë– ì‹ ê°€ìš”? (3-4íšŒì°¨ì—ì„œ ìì•„ì¡´ì¤‘ê° í–¥ìƒì— ê¸°ì—¬í–ˆë˜ ê°€ì¡± í™œë™)",
      "ë§¤ì¼ ì•„ì¹¨ ì‚°ì±… ì‹œê°„ì„ 30ë¶„ì—ì„œ 40ë¶„ìœ¼ë¡œ ëŠ˜ë ¤ë³´ëŠ” ê²ƒì€ ì–´ë–¨ê¹Œìš”? (4-5íšŒì°¨ì—ì„œ 20ë¶„â†’30ë¶„ìœ¼ë¡œ í™•ëŒ€ëœ í™œë™ëŸ‰ ì¦ê°€ ê²½í—˜)",
      "ì´ì›ƒê³¼ì˜ ëŒ€í™”ì—ì„œ ì†ì ì´ì•¼ê¸°ë¥¼ ë‚˜ëˆ„ëŠ” ê²ƒì´ ì–´ë– ì‹ ê°€ìš”? (3-4íšŒì°¨ì—ì„œ ì‚¬íšŒì  êµë¥˜ ì¦ì§„ì— ë„ì›€ì´ ë˜ì—ˆë˜ ì£¼ì œ)"
    ],
      5: [
        "ê°€ì¡±ì—ê²Œ ê¸ì •ì ì¸ ê°ì •ì„ í‘œí˜„í•´ë³¸ë‹¤ë©´ ì–´ë–¤ ë§ì„ í•˜ê³  ì‹¶ìœ¼ì„¸ìš”?",
        "ê°€ì¡±ê³¼ í•¨ê»˜í•˜ê³  ì‹¶ì€ í™œë™ì´ ìˆë‚˜ìš”?",
        "ê°€ì¡±ê³¼ì˜ ì†Œí†µì—ì„œ ê°œì„ í•˜ê³  ì‹¶ì€ ë¶€ë¶„ì´ ìˆë‚˜ìš”?",
        "ê°€ì¡±ê³¼ì˜ ì¶”ì–µ ì¤‘ ê°€ì¥ ì†Œì¤‘í•œ ê²ƒì€ ë¬´ì—‡ì¸ê°€ìš”?",
        "ê°€ì¡±ì—ê²Œ ë„ì›€ì„ ë°›ê³  ì‹¶ì€ ë¶€ë¶„ì´ ìˆë‚˜ìš”?",
        "ê°€ì¡±ê³¼ í•¨ê»˜í•˜ê³  ì‹¶ì€ ì—¬í–‰ì´ë‚˜ ì™¸ì¶œì´ ìˆë‚˜ìš”?",
        "ê°€ì¡±ì—ê²Œ ê°ì‚¬í•œ ë§ˆìŒì„ í‘œí˜„í•˜ê³  ì‹¶ìœ¼ì‹ ê°€ìš”?",
        "ê°€ì¡±ê³¼ì˜ ê´€ê³„ì—ì„œ ê°€ì¥ ì¤‘ìš”í•˜ë‹¤ê³  ìƒê°í•˜ëŠ” ê²ƒì€ ë¬´ì—‡ì¸ê°€ìš”?"
      ]
    }

    // ê¸°ë³¸ ì§ˆë¬¸ë“¤ì—ì„œ ëœë¤í•˜ê²Œ ì„ íƒ
    const questions = baseQuestions[stepNumber as keyof typeof baseQuestions] || []
    const shuffled = [...questions].sort(() => 0.5 - Math.random())
    
    // íšŒì°¨ë³„ ë§ì¶¤í˜• ì§ˆë¬¸ ì¶”ê°€
    const customQuestions = generateCustomQuestions(stepNumber, client, records, emotionalScores)
    
    return [...shuffled.slice(0, 4), ...customQuestions].slice(0, 4)
  }, []) // ì˜ì¡´ì„± ë°°ì—´ ë¹„ì›€ - í•¨ìˆ˜ ë‚´ë¶€ì—ì„œ ì™¸ë¶€ ìƒíƒœë¥¼ ì°¸ì¡°í•˜ì§€ ì•ŠìŒ

  // íšŒì°¨ë³„ ë§ì¶¤í˜• ì§ˆë¬¸ ìƒì„±
  const generateCustomQuestions = useCallback((stepNumber: number, client: Client, records: any[], emotionalScores: any): string[] => {
    const customQuestions = []
    
    if (stepNumber === 2 && records.length > 0) {
      const latestRecord = records[0]
      if (latestRecord.notes.includes('ê°€ì¡±')) {
        customQuestions.push("ê°€ì¡±ê³¼ì˜ ìµœê·¼ ëŒ€í™”ì—ì„œ íŠ¹ë³„íˆ ê¸°ì–µì— ë‚¨ëŠ” ê²ƒì´ ìˆë‚˜ìš”?")
      }
      if (latestRecord.notes.includes('ì´ì›ƒ')) {
        customQuestions.push("ì´ì›ƒê³¼ì˜ ì†Œí†µì—ì„œ ìƒˆë¡­ê²Œ ë°°ìš´ ì ì´ ìˆë‚˜ìš”?")
      }
    }
    
    if (stepNumber === 3) {
      if (emotionalScores.loneliness > 6) {
        customQuestions.push("ì™¸ë¡œì›€ì„ ëŠë¼ì‹¤ ë•Œ ì–´ë–¤ ìƒê°ì´ ë“œì‹œë‚˜ìš”?")
      }
      if (emotionalScores.depression > 5) {
        customQuestions.push("ê¸°ë¶„ì´ ì¢‹ì•„ì§€ë©´ ì–´ë–¤ ì¼ì„ í•˜ê³  ì‹¶ìœ¼ì‹ ê°€ìš”?")
      }
    }
    
    if (stepNumber === 4) {
      if (records.some(r => r.notes.includes('í˜¸í¡'))) {
        customQuestions.push("í˜¸í¡ ìš´ë™ì´ ë„ì›€ì´ ë˜ì‹œë‚˜ìš”? ì–´ë–¤ ë•Œ ê°€ì¥ íš¨ê³¼ì ì¸ê°€ìš”?")
      }
      if (records.some(r => r.notes.includes('ì‚°ì±…'))) {
        customQuestions.push("ì‚°ì±…í•  ë•Œ ì–´ë–¤ ê²½ë¡œë¥¼ ì„ í˜¸í•˜ì‹œë‚˜ìš”?")
      }
    }
    
    if (stepNumber === 5) {
      if (records.some(r => r.notes.includes('ì†ì'))) {
        customQuestions.push("ì†ìì™€ í•¨ê»˜í•˜ê³  ì‹¶ì€ íŠ¹ë³„í•œ í™œë™ì´ ìˆë‚˜ìš”?")
      }
      if (records.some(r => r.notes.includes('ê°€ì¡±'))) {
        customQuestions.push("ê°€ì¡±ì—ê²Œ ì „í•˜ê³  ì‹¶ì€ ë©”ì‹œì§€ê°€ ìˆë‚˜ìš”?")
      }
    }
    
    return customQuestions
  }, []) // ì˜ì¡´ì„± ë°°ì—´ ë¹„ì›€ - í•¨ìˆ˜ ë‚´ë¶€ì—ì„œ ì™¸ë¶€ ìƒíƒœë¥¼ ì°¸ì¡°í•˜ì§€ ì•ŠìŒ

  // API í˜¸ì¶œ ì‹¤íŒ¨ ì‹œ ì‚¬ìš©í•  ê¸°ë³¸ ì§ˆë¬¸ë“¤
  const getFallbackQuestions = (stepNumber: number): string[] => {
    const fallbackQuestions = {
      1: ["ì˜¤ëŠ˜ ê¸°ë¶„ì€ ì–´ë– ì‹ ê°€ìš”? (1-10ì )", "ì ì€ ì˜ ì£¼ë¬´ì…¨ë‚˜ìš”?", "ì‹ì‚¬ëŠ” ì œëŒ€ë¡œ í•˜ì…¨ë‚˜ìš”?", "ëª¸ì— ì•„í”ˆ ê³³ì€ ì—†ìœ¼ì‹ ê°€ìš”?"],
      2: ["ì§€ë‚œ ì£¼ì— ê°€ì¡±ê³¼ ë‚˜ëˆˆ ëŒ€í™” ì¤‘ ê¸°ì–µì— ë‚¨ëŠ” ê²ƒì´ ìˆë‚˜ìš”?", "ì‚°ì±…ì€ ì˜ í•˜ê³  ê³„ì‹œë‚˜ìš”?", "ì´ì›ƒê³¼ì˜ ì†Œí†µì—ì„œ ëŠë‚€ ì ì´ ìˆìœ¼ì‹ ê°€ìš”?"],
      3: ["ìš”ì¦˜ ê°€ì¥ ë§ì´ ëŠë¼ì‹œëŠ” ê°ì •ì€ ë¬´ì—‡ì¸ê°€ìš”?", "ê·¸ ê°ì •ì„ ëŠë¼ì‹¤ ë•Œ ëª¸ì— ì–´ë–¤ ë³€í™”ê°€ ìˆë‚˜ìš”?", "ê°ì •ì„ í‘œí˜„í•˜ëŠ” ê²ƒì´ ì–´ë ¤ìš°ì‹ ê°€ìš”?"],
      4: ["ì™¸ë¡œì›€ì„ ëŠë¼ì‹¤ ë•Œ ì–´ë–¤ ì¼ì„ í•˜ì‹œë©´ ê¸°ë¶„ì´ ì¢‹ì•„ì§€ë‚˜ìš”?", "ì§§ì€ ì‚°ì±…ì´ë‚˜ í˜¸í¡ ìš´ë™ì„ í•´ë³´ì‹  ì ì´ ìˆë‚˜ìš”?", "ì·¨ë¯¸ í™œë™ì„ í†µí•´ ê¸°ë¶„ ì „í™˜ì„ í•´ë³´ì‹  ì ì´ ìˆë‚˜ìš”?"],
      5: ["ê°€ì¡±ì—ê²Œ ê¸ì •ì ì¸ ê°ì •ì„ í‘œí˜„í•´ë³¸ë‹¤ë©´ ì–´ë–¤ ë§ì„ í•˜ê³  ì‹¶ìœ¼ì„¸ìš”?", "ê°€ì¡±ê³¼ í•¨ê»˜í•˜ê³  ì‹¶ì€ í™œë™ì´ ìˆë‚˜ìš”?", "ê°€ì¡±ê³¼ì˜ ì†Œí†µì—ì„œ ê°œì„ í•˜ê³  ì‹¶ì€ ë¶€ë¶„ì´ ìˆë‚˜ìš”?"]
    }
    return fallbackQuestions[stepNumber as keyof typeof fallbackQuestions] || []
  }

  // ìƒë‹´ ê¸°ë¡ AI ìš”ì•½ í•¨ìˆ˜ (ë”ë¯¸ ë°ì´í„°) - ë¬´í•œ ë£¨í”„ ë°©ì§€
  const summarizeNotes = (notes: string, clientName: string, sessionNumber: number, date: string) => {
    try {
      console.log('ë”ë¯¸ ìš”ì•½ ì‹œì‘:', { clientName, sessionNumber, date, notesLength: notes.length })
      
      // ë”ë¯¸ ìš”ì•½ ë°ì´í„° ìƒì„± (ë™ê¸° ì²˜ë¦¬ë¡œ ë¬´í•œ ë£¨í”„ ë°©ì§€)
      const demoSummary = generateDummySummary(clientName, sessionNumber, date, notes)
      const lineCount = demoSummary.split('\n').filter(line => line.trim().length > 0).length
      
      // ìš”ì•½ ê²°ê³¼ë¥¼ ìƒˆ ì°½ìœ¼ë¡œ í‘œì‹œ (í•œ ë²ˆë§Œ ì‹¤í–‰)
      const summaryWindow = window.open('', '_blank', 'width=800,height=600')
      if (summaryWindow && !summaryWindow.closed) {
        summaryWindow.document.write(`
          <!DOCTYPE html>
          <html>
          <head>
            <title>${clientName} ì–´ë¥´ì‹  ${sessionNumber}íšŒì°¨ ìƒë‹´ ìš”ì•½</title>
            <style>
              body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 20px; line-height: 1.6; }
              .header { background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
              .summary { white-space: pre-wrap; background: white; padding: 20px; border: 1px solid #e9ecef; border-radius: 8px; }
              .stats { color: #6c757d; font-size: 14px; margin-top: 10px; }
              .demo-badge { background: #ffc107; color: #000; padding: 4px 8px; border-radius: 4px; font-size: 12px; margin-left: 10px; }
            </style>
          </head>
          <body>
            <div class="header">
              <h1>${clientName} ì–´ë¥´ì‹  ${sessionNumber}íšŒì°¨ ìƒë‹´ ìš”ì•½ <span class="demo-badge">DEMO</span></h1>
              <p><strong>ìƒë‹´ì¼:</strong> ${date}</p>
              <p><strong>ìš”ì•½ ì¤„ ìˆ˜:</strong> ${lineCount}ì¤„</p>
            </div>
            <div class="summary">${demoSummary}</div>
            <div class="stats">
              <p>ì´ ìš”ì•½ì€ ë”ë¯¸ ë°ì´í„°ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤. ì‹¤ì œ AI APIë¥¼ í˜¸ì¶œí•˜ì§€ ì•Šê³  í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ìƒì„±í•œ ì˜ˆì‹œì…ë‹ˆë‹¤.</p>
            </div>
          </body>
          </html>
        `)
        summaryWindow.document.close()
        
        console.log(`${sessionNumber}íšŒì°¨ ìƒë‹´ ìš”ì•½ ì™„ë£Œ:`, { lineCount, summary: demoSummary.substring(0, 200) + '...' })
      }
      
    } catch (error) {
      console.error('ìƒë‹´ ê¸°ë¡ ìš”ì•½ ì˜¤ë¥˜:', error)
      alert('ìƒë‹´ ê¸°ë¡ ìš”ì•½ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.')
    }
  }

  // AI ë¶„ì„ ìš”ì•½ ìƒì„± í•¨ìˆ˜ (ìƒë‹´ ê¸°ë¡ ë‚´ìš© ê¸°ë°˜)
  const generateAutoSummary = (notes: string, date: string): string => {
    const lines = notes.split('\n').filter(line => line.trim().length > 0)
    
    // ê°ì • ìƒíƒœ ë¶„ì„
    const emotionalKeywords = {
      'ì™¸ë¡œì›€': 0, 'ìš°ìš¸': 0, 'ë¶ˆì•ˆ': 0, 'í™”': 0, 'ê¸°ì¨': 0, 'ê°ì‚¬': 0, 'ê·¸ë¦¬ì›€': 0
    }
    
    // ì£¼ìš” ì£¼ì œ ë¶„ì„
    const topicKeywords = {
      'ê°€ì¡±': 0, 'ì†ì': 0, 'ì´ì›ƒ': 0, 'ì‚°ì±…': 0, 'í˜¸í¡': 0, 'ìŒì•…': 0, 'ì‚¬ì§„': 0
    }
    
    // ìƒë‹´ ì§„í–‰ë„ ë¶„ì„
    const progressKeywords = {
      'ê°œì„ ': 0, 'ì•…í™”': 0, 'ìœ ì§€': 0, 'ë³€í™”': 0, 'íš¨ê³¼': 0
    }
    
    // í‚¤ì›Œë“œ ë¹ˆë„ ê³„ì‚°
    lines.forEach(line => {
      Object.keys(emotionalKeywords).forEach(keyword => {
        if (line.includes(keyword)) emotionalKeywords[keyword as keyof typeof emotionalKeywords]++
      })
      Object.keys(topicKeywords).forEach(keyword => {
        if (line.includes(keyword)) topicKeywords[keyword as keyof typeof topicKeywords]++
      })
      Object.keys(progressKeywords).forEach(keyword => {
        if (line.includes(keyword)) progressKeywords[keyword as keyof typeof progressKeywords]++
      })
    })
    
    // ì£¼ìš” ê°ì • ìƒíƒœ íŒŒì•…
    const dominantEmotion = Object.entries(emotionalKeywords)
      .filter(([_, count]) => count > 0)
      .sort(([_, a], [__, b]) => b - a)[0]
    
    // ì£¼ìš” ê´€ì‹¬ ì£¼ì œ íŒŒì•…
    const dominantTopic = Object.entries(topicKeywords)
      .filter(([_, count]) => count > 0)
      .sort(([_, a], [__, b]) => b - a)[0]
    
    // ìƒë‹´ ì§„í–‰ ë°©í–¥ ë¶„ì„
    const progressDirection = progressKeywords.ê°œì„  > progressKeywords.ì•…í™” ? 'ê°œì„ ' : 
                             progressKeywords.ì•…í™” > progressKeywords.ê°œì„  ? 'ì•…í™”' : 'ìœ ì§€'
    
    // êµ¬ì²´ì ì¸ ë¶„ì„ ê²°ê³¼ ìƒì„±
    let analysis = `ğŸ¤– AI ë¶„ì„ ìš”ì•½ - ${date}\n\n`
    
    // ê°ì • ìƒíƒœ ë¶„ì„
    analysis += `ğŸ’­ ê°ì • ìƒíƒœ ë¶„ì„\n`
    analysis += `â€¢ ì£¼ìš” ê°ì •: ${dominantEmotion ? dominantEmotion[0] : 'ì•ˆì •ì '} (ì–¸ê¸‰ ${dominantEmotion ? dominantEmotion[1] : 0}íšŒ)\n`
    analysis += `â€¢ ê°ì • ê°•ë„: ${dominantEmotion && dominantEmotion[1] > 3 ? 'ë†’ìŒ' : 'ë³´í†µ'}\n`
    
    // ì£¼ìš” ì£¼ì œ ë¶„ì„
    analysis += `\nğŸ¯ ì£¼ìš” ê´€ì‹¬ ì£¼ì œ\n`
    analysis += `â€¢ í•µì‹¬ ì£¼ì œ: ${dominantTopic ? dominantTopic[0] : 'ì¼ë°˜ì '} (ì–¸ê¸‰ ${dominantTopic ? dominantTopic[1] : 0}íšŒ)\n`
    analysis += `â€¢ ìƒë‹´ ì´ˆì : ${dominantTopic ? `${dominantTopic[0]} ê´€ë ¨ ì´ìŠˆ` : 'ì „ë°˜ì  ìƒë‹´'}\n`
    
    // ìƒë‹´ ì§„í–‰ë„ ë¶„ì„
    analysis += `\nğŸ“ˆ ìƒë‹´ ì§„í–‰ë„\n`
    analysis += `â€¢ ì§„í–‰ ë°©í–¥: ${progressDirection === 'ê°œì„ ' ? 'ğŸŸ¢ ì ì§„ì  ê°œì„ ' : progressDirection === 'ì•…í™”' ? 'ğŸ”´ ì£¼ì˜ í•„ìš”' : 'ğŸŸ¡ í˜„ìƒ ìœ ì§€'}\n`
    analysis += `â€¢ ê°œì„  ì˜ì—­: ${progressKeywords.ê°œì„  > 0 ? `${progressKeywords.ê°œì„ }ê°œ ì˜ì—­ì—ì„œ ê°œì„ ` : 'ê°œì„  ì˜ì—­ íŒŒì•… í•„ìš”'}\n`
    
    // êµ¬ì²´ì  ê¶Œì¥ì‚¬í•­
    analysis += `\nğŸ’¡ AI ê¶Œì¥ì‚¬í•­\n`
    if (dominantEmotion && dominantEmotion[0] === 'ì™¸ë¡œì›€') {
      analysis += `â€¢ ì‚¬íšŒì  êµë¥˜ ì¦ì§„ í”„ë¡œê·¸ë¨ ì°¸ì—¬ ê¶Œì¥\n`
      analysis += `â€¢ ê°€ì¡±ê³¼ì˜ ì •ê¸°ì  ì—°ë½ ì²´ê³„ êµ¬ì¶•\n`
    }
    if (dominantTopic && dominantTopic[0] === 'ê°€ì¡±') {
      analysis += `â€¢ ê°€ì¡± ê´€ê³„ ê°œì„ ì„ ìœ„í•œ êµ¬ì²´ì  ì „ëµ ìˆ˜ë¦½\n`
      analysis += `â€¢ ê°€ì¡±ê³¼ì˜ ì†Œí†µ ë°©ì‹ ê°œì„  ë°©ì•ˆ ëª¨ìƒ‰\n`
    }
    if (progressDirection === 'ê°œì„ ') {
      analysis += `â€¢ í˜„ì¬ ì ‘ê·¼ë²• ìœ ì§€ ë° ê°•í™”\n`
      analysis += `â€¢ ì„±ê³µ ê²½í—˜ì„ ë°”íƒ•ìœ¼ë¡œ í•œ í™•ì¥ ì „ëµ ìˆ˜ë¦½\n`
    }
    
    analysis += `\nğŸ“Š ìƒë‹´ íš¨ê³¼ì„±: ${progressDirection === 'ê°œì„ ' ? 'ì–‘í˜¸' : progressDirection === 'ì•…í™”' ? 'ì£¼ì˜' : 'ë³´í†µ'}`
    
    return analysis
  }

  // ì‹¤ì œ ìƒë‹´ ë‚´ìš© ê¸°ë°˜ AI ë¶„ì„ ìš”ì•½ ìƒì„± í•¨ìˆ˜
  const generateDummyAISummary = (notes: string, date: string, emotionalScores: any): string => {
    const totalScore = emotionalScores.depression + emotionalScores.anxiety + emotionalScores.loneliness + emotionalScores.anger
    const avgScore = totalScore / 4
    
    // ìƒë‹´ ë‚´ìš©ì—ì„œ í•µì‹¬ ì •ë³´ ì¶”ì¶œ
    const hasFamilyContent = notes.includes('ê°€ì¡±') || notes.includes('ì•„ë“¤') || notes.includes('ì†ì')
    const hasNeighborContent = notes.includes('ì´ì›ƒ') || notes.includes('ì†Œí†µ')
    const hasActivityContent = notes.includes('ì‚°ì±…') || notes.includes('í˜¸í¡') || notes.includes('ìŒì•…') || notes.includes('í™”ë¶„')
    const hasEmotionalContent = notes.includes('ì™¸ë¡œì›€') || notes.includes('ê°ì‚¬') || notes.includes('ê¸°ì¨') || notes.includes('ê·¸ë¦¬ì›€')
    
    // ê°ì • ìƒíƒœë³„ êµ¬ì²´ì  ë¶„ì„
    let emotionalAnalysis = ""
    if (emotionalScores.depression >= 7) {
      emotionalAnalysis += "â€¢ ìš°ìš¸ê°ì´ ë†’ì•„ ì£¼ì˜ê°€ í•„ìš”í•©ë‹ˆë‹¤\n"
    } else if (emotionalScores.depression >= 5) {
      emotionalAnalysis += "â€¢ ìš°ìš¸ê°ì´ ë³´í†µ ìˆ˜ì¤€ìœ¼ë¡œ ì ì§„ì  ê°œì„  í•„ìš”í•©ë‹ˆë‹¤\n"
    } else {
      emotionalAnalysis += "â€¢ ìš°ìš¸ê°ì´ ë‚®ì•„ ì•ˆì •ì ì¸ ìƒíƒœì…ë‹ˆë‹¤\n"
    }
    
    if (emotionalScores.anxiety >= 7) {
      emotionalAnalysis += "â€¢ ë¶ˆì•ˆê°ì´ ì‹¬í•´ ì•ˆì •í™” ê¸°ë²•ì´ í•„ìš”í•©ë‹ˆë‹¤\n"
    } else if (emotionalScores.anxiety >= 5) {
      emotionalAnalysis += "â€¢ ë¶ˆì•ˆê°ì´ ë³´í†µ ìˆ˜ì¤€ìœ¼ë¡œ ê´€ë¦¬ ê¸°ë²• ì ìš© í•„ìš”í•©ë‹ˆë‹¤\n"
    } else {
      emotionalAnalysis += "â€¢ ë¶ˆì•ˆê°ì´ ë‚®ì•„ ì•ˆì •ì ì¸ ìƒíƒœì…ë‹ˆë‹¤\n"
    }
    
    if (emotionalScores.loneliness >= 7) {
      emotionalAnalysis += "â€¢ ì™¸ë¡œì›€ì´ ì‹¬í•´ ì‚¬íšŒì  êµë¥˜ ì¦ì§„ì´ í•„ìš”í•©ë‹ˆë‹¤\n"
    } else if (emotionalScores.loneliness >= 5) {
      emotionalAnalysis += "â€¢ ì™¸ë¡œì›€ì´ ë³´í†µ ìˆ˜ì¤€ìœ¼ë¡œ ì´ì›ƒê³¼ì˜ ì†Œí†µ ì¦ì§„ í•„ìš”í•©ë‹ˆë‹¤\n"
    } else {
      emotionalAnalysis += "â€¢ ì™¸ë¡œì›€ì´ ë‚®ì•„ ì‚¬íšŒì  ì—°ê²°ê°ì´ ì–‘í˜¸í•©ë‹ˆë‹¤\n"
    }
    
    if (emotionalScores.anger >= 7) {
      emotionalAnalysis += "â€¢ ë¶„ë…¸ ì¡°ì ˆ ê¸°ë²• ì ìš©ì´ í•„ìš”í•©ë‹ˆë‹¤\n"
    } else if (emotionalScores.anger >= 5) {
      emotionalAnalysis += "â€¢ ë¶„ë…¸ê°€ ë³´í†µ ìˆ˜ì¤€ìœ¼ë¡œ ì¡°ì ˆ ê¸°ë²• ì—°ìŠµ í•„ìš”í•©ë‹ˆë‹¤\n"
    } else {
      emotionalAnalysis += "â€¢ ë¶„ë…¸ê°€ ë‚®ì•„ ì•ˆì •ì ì¸ ìƒíƒœì…ë‹ˆë‹¤\n"
    }
    
    // ìƒë‹´ ë‚´ìš© ê¸°ë°˜ êµ¬ì²´ì  ë¶„ì„
    let contentAnalysis = ""
    if (hasFamilyContent) {
      contentAnalysis += "â€¢ ê°€ì¡±ê³¼ì˜ ì†Œí†µì´ ìƒë‹´ì˜ í•µì‹¬ ì£¼ì œë¡œ í™•ì¸ë¨\n"
    }
    if (hasNeighborContent) {
      contentAnalysis += "â€¢ ì´ì›ƒê³¼ì˜ ì†Œí†µì´ ì™¸ë¡œì›€ ì™„í™”ì— íš¨ê³¼ì ì„\n"
    }
    if (hasActivityContent) {
      contentAnalysis += "â€¢ ì‚°ì±…, í˜¸í¡ ìš´ë™, ìŒì•… ë“± í™œë™ì  ëŒ€ì²˜ ì „ëµ í™œìš© ì¤‘\n"
    }
    if (hasEmotionalContent) {
      contentAnalysis += "â€¢ ê°ì • í‘œí˜„ê³¼ ì¸ì‹ì´ ì ê·¹ì ìœ¼ë¡œ ì´ë£¨ì–´ì§\n"
    }
    
    // ìœ„í—˜ë„ ë° ê¶Œì¥ì‚¬í•­
    let riskLevel = "ë‚®ìŒ"
    let recommendation = "ì •ê¸°ì  ëª¨ë‹ˆí„°ë§"
    
    if (avgScore >= 7) {
      riskLevel = "ë†’ìŒ"
      recommendation = "ì¦‰ì‹œ ê°œì… í•„ìš”"
    } else if (avgScore >= 5) {
      riskLevel = "ë³´í†µ"
      recommendation = "ì£¼ì˜ ê¹Šì€ ê´€ì°° í•„ìš”"
    }
    
    // ìƒë‹´ íš¨ê³¼ì„± í‰ê°€
    let effectiveness = "ë³´í†µ"
    let nextFocus = "ì •ì„œ ì•ˆì •í™” ê°•í™”"
    
    if (avgScore < 4) {
      effectiveness = "ì–‘í˜¸"
      nextFocus = "í˜„ì¬ ì ‘ê·¼ë²• ìœ ì§€ ë° ê°•í™”"
    } else if (avgScore >= 7) {
      effectiveness = "ì£¼ì˜ í•„ìš”"
      nextFocus = "ìœ„í—˜ ìš”ì†Œ ê´€ë¦¬ ë° ê¸´ê¸‰ ê°œì…"
    }
    
    return `ğŸ¤– AI ë¶„ì„ ìš”ì•½ - ${date}

ğŸ’­ ê°ì • ìƒíƒœ ë¶„ì„
â€¢ í‰ê·  ì ìˆ˜: ${avgScore.toFixed(1)}/10
â€¢ ìœ„í—˜ë„: ${riskLevel}
â€¢ ê¶Œì¥ì‚¬í•­: ${recommendation}

${emotionalAnalysis}
ğŸ“‹ ìƒë‹´ ë‚´ìš© ë¶„ì„
${contentAnalysis}
ğŸ“Š ìƒë‹´ íš¨ê³¼ì„±: ${effectiveness}
ğŸ¯ ë‹¤ìŒ ìƒë‹´ ì´ˆì : ${nextFocus}
ğŸ’¡ í•µì‹¬ í†µì°°: ${hasFamilyContent ? 'ê°€ì¡± ì¤‘ì‹¬ ì ‘ê·¼ì´ íš¨ê³¼ì ' : 'ê°œì¸ì  ëŒ€ì²˜ ì „ëµ ê°•í™” í•„ìš”'}`
  }

  // ìš”ì•½ ì¬ìƒì„± í•¨ìˆ˜
  const regenerateSummary = useCallback((notes: string, recordId: string) => {
    const newSummary = generateAutoSummary(notes, new Date().toLocaleDateString())
    
    // í´ë¼ì´ì–¸íŠ¸ ë ˆì½”ë“œ ì—…ë°ì´íŠ¸
    setClientRecords(prev => prev.map(record => 
      record.id === recordId 
        ? { ...record, autoSummary: newSummary }
        : record
    ))
    
    console.log(`ìš”ì•½ ì¬ìƒì„± ì™„ë£Œ: ${recordId}`, newSummary)
  }, []) // ì˜ì¡´ì„± ë°°ì—´ ë¹„ì›€ - í•¨ìˆ˜ ë‚´ë¶€ì—ì„œ ì™¸ë¶€ ìƒíƒœë¥¼ ì°¸ì¡°í•˜ì§€ ì•ŠìŒ

  // ë”ë¯¸ ìš”ì•½ ë°ì´í„° ìƒì„± í•¨ìˆ˜
  const generateDummySummary = useCallback((clientName: string, sessionNumber: number, date: string, notes: string): string => {
    const summaries = {
      1: `ğŸ” ${clientName} ì–´ë¥´ì‹  ${sessionNumber}íšŒì°¨ ìƒë‹´ ìš”ì•½ (ì´ˆê¸° ì‚¬ì •)

ğŸ“… ìƒë‹´ ì •ë³´
â€¢ ìƒë‹´ì¼: ${date}
â€¢ íšŒì°¨: ${sessionNumber}íšŒì°¨
â€¢ í´ë¼ì´ì–¸íŠ¸: ${clientName} ì–´ë¥´ì‹ 
â€¢ ìƒë‹´ ìœ í˜•: ì´ˆê¸° ìƒë‹´

ğŸ“ ìƒë‹´ ë‚´ìš© ë¶„ì„
â€¢ ì£¼ìš” ì£¼ì œ: ì™¸ë¡œì›€, ì‚¬íšŒì  ê³ ë¦½, ê°€ì¡±ê³¼ì˜ ì†Œí†µ
â€¢ ê°ì • ìƒíƒœ: ê¸´ì¥, ê¸°ëŒ€, ë¶ˆì•ˆ
â€¢ ì ìš©ëœ ì „ëµ: í˜¸í¡ ìš´ë™, ê¸´ì¥ ì™„í™” ê¸°ë²•

ğŸ’¡ í•µì‹¬ í†µì°°
â€¢ ìƒë‹´ì— ëŒ€í•œ ê¸ì •ì  ê¸°ëŒ€ê° ì¡´ì¬
â€¢ í˜¼ìì„œëŠ” í•´ê²°í•˜ê¸° ì–´ë ¤ìš´ ë¬¸ì œë“¤ ì¸ì‹
â€¢ ë„ì›€ì„ ë°›ê³ ì í•˜ëŠ” ì ê·¹ì  ì˜í–¥

ğŸ¯ ê°œì„  ë°©í–¥
â€¢ ì²´ê³„ì ì¸ ìƒë‹´ ê³„íš ìˆ˜ë¦½
â€¢ ì •ê¸°ì ì¸ ìƒë‹´ ì¼ì • ì¡°ìœ¨
â€¢ ë‹¨ê³„ë³„ ëª©í‘œ ì„¤ì •

ğŸ“Š ì„¸ì…˜ íš¨ê³¼ì„±
â€¢ ê¸´ì¥ ì™„í™”: íš¨ê³¼ì 
â€¢ ìƒë‹´ ë™ê¸°: ë†’ìŒ
â€¢ ì „ë°˜ì  ë§Œì¡±ë„: ì–‘í˜¸

ğŸ”® ë‹¤ìŒ ìƒë‹´ ê³„íš
â€¢ ìƒë‹´ ëª©í‘œ êµ¬ì²´í™”
â€¢ ê°œì¸ë³„ ë§ì¶¤ ì „ëµ ìˆ˜ë¦½
â€¢ ê°€ì¡±ê³¼ì˜ ì†Œí†µ ê°œì„  ë°©ì•ˆ

ğŸ“‹ íŠ¹ì´ì‚¬í•­
â€¢ í˜¸í¡ ìš´ë™ì´ ê¸´ì¥ ì™„í™”ì— íš¨ê³¼ì 
â€¢ ìƒë‹´ì— ëŒ€í•œ ê¸ì •ì  íƒœë„
â€¢ ë¬¸ì œ í•´ê²° ì˜ì§€ê°€ ê°•í•¨

ğŸ’ª ê¶Œì¥ì‚¬í•­
â€¢ ë§¤ì¼ ì•„ì¹¨ í˜¸í¡ ìš´ë™ ì‹¤ì²œ
â€¢ ìƒë‹´ ì¼ì • ì¤€ìˆ˜
â€¢ ê°€ì¡±ê³¼ì˜ ì •ê¸°ì  ì†Œí†µ
â€¢ ì¼ìƒìƒí™œ íŒ¨í„´ ìœ ì§€

ğŸŒŸ ê¸ì •ì  ë³€í™”
â€¢ ê¸´ì¥ê° ê°ì†Œ
â€¢ ìƒë‹´ì— ëŒ€í•œ ê¸°ëŒ€ê° ì¦ê°€
â€¢ ë¬¸ì œ í•´ê²° ì˜ì§€ ê°•í™”

âš ï¸ ì£¼ì˜ì‚¬í•­
â€¢ ì§€ì†ì ì¸ ë™ê¸° ë¶€ì—¬ í•„ìš”
â€¢ ë‹¨ê³„ì  ì ‘ê·¼ ë°©ì‹ ì ìš©
â€¢ ê°€ì¡±ê³¼ì˜ ì†Œí†µ ì¦ì§„

ì´ ìš”ì•½ì€ ë”ë¯¸ ë°ì´í„°ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.`,

      2: `ğŸ” ${clientName} ì–´ë¥´ì‹  ${sessionNumber}íšŒì°¨ ìƒë‹´ ìš”ì•½ (ì™¸ë¡œì›€ ì‹¬í™”)

ğŸ“… ìƒë‹´ ì •ë³´
â€¢ ìƒë‹´ì¼: ${date}
â€¢ íšŒì°¨: ${sessionNumber}íšŒì°¨
â€¢ í´ë¼ì´ì–¸íŠ¸: ${clientName} ì–´ë¥´ì‹ 
â€¢ ìƒë‹´ ìœ í˜•: ì •ê¸° ìƒë‹´

ğŸ“ ìƒë‹´ ë‚´ìš© ë¶„ì„
â€¢ ì£¼ìš” ì£¼ì œ: ì™¸ë¡œì›€ ì‹¬í™”, ê°€ì¡±ê³¼ì˜ ì—°ë½ ê°ì†Œ
â€¢ ê°ì • ìƒíƒœ: ì™¸ë¡œì›€, ìš°ìš¸ê°, ê±±ì •
â€¢ ì ìš©ëœ ì „ëµ: TV/ë¼ë””ì˜¤ í™œìš©, ì¼ìƒìƒí™œ ìœ ì§€

ğŸ’¡ í•µì‹¬ í†µì°°
â€¢ ê°€ì¡±ê³¼ì˜ ì—°ë½ ë¹ˆë„ ê°ì†Œë¡œ ì¸í•œ ì™¸ë¡œì›€ ì¦ê°€
â€¢ ì¼ìƒìƒí™œ ìœ ì§€ë¥¼ í†µí•œ ì •ì„œì  ì•ˆì • ì¶”êµ¬
â€¢ ì™¸ë¶€ ìê·¹ì„ í†µí•œ í˜¼ì ìˆìŒ ê·¹ë³µ ì‹œë„

ğŸ¯ ê°œì„  ë°©í–¥
â€¢ ê°€ì¡±ê³¼ì˜ ì—°ë½ ë¹ˆë„ ì¦ê°€
â€¢ ì§€ì—­ì‚¬íšŒ í™œë™ ì°¸ì—¬ ì¦ì§„
â€¢ ì •ì„œì  ì§€ì§€ ì²´ê³„ êµ¬ì¶•

ğŸ“Š ì„¸ì…˜ íš¨ê³¼ì„±
â€¢ ì™¸ë¡œì›€ ì ìˆ˜: ì¦ê°€ (8ì )
â€¢ ìš°ìš¸ê°: ì¦ê°€ (7ì )
â€¢ ì „ë°˜ì  ë§Œì¡±ë„: ê°ì†Œ

ğŸ”® ë‹¤ìŒ ìƒë‹´ ê³„íš
â€¢ ê°€ì¡±ê³¼ì˜ ì†Œí†µ ë¹ˆë„ ì¡°ìœ¨
â€¢ ì´ì›ƒê³¼ì˜ ê´€ê³„ ê°œì„ 
â€¢ ì·¨ë¯¸ í™œë™ ë„ì…

ğŸ“‹ íŠ¹ì´ì‚¬í•­
â€¢ TV/ë¼ë””ì˜¤ê°€ ì™¸ë¡œì›€ ì™„í™”ì— ì¼ë¶€ ë„ì›€
â€¢ ê°€ì¡± ì—°ë½ ê°ì†Œì— ëŒ€í•œ ìš°ë ¤
â€¢ ì¼ìƒìƒí™œ íŒ¨í„´ ìœ ì§€ ë…¸ë ¥

ğŸ’ª ê¶Œì¥ì‚¬í•­
â€¢ ê°€ì¡±ê³¼ì˜ ì •ê¸°ì  ì—°ë½
â€¢ ì´ì›ƒê³¼ì˜ ëŒ€í™” ì‹œê°„ í™•ëŒ€
â€¢ ìƒˆë¡œìš´ ì·¨ë¯¸ í™œë™ íƒìƒ‰
â€¢ ì •ê¸°ì ì¸ ì™¸ì¶œ í™œë™

ğŸŒŸ ê¸ì •ì  ë³€í™”
â€¢ ì¼ìƒìƒí™œ ìœ ì§€ ì˜ì§€
â€¢ ì™¸ë¡œì›€ ê·¹ë³µì„ ìœ„í•œ ë…¸ë ¥
â€¢ ë¬¸ì œ ìƒí™© ì¸ì‹

âš ï¸ ì£¼ì˜ì‚¬í•­
â€¢ ì™¸ë¡œì›€ ì‹¬í™” ëª¨ë‹ˆí„°ë§
â€¢ ê°€ì¡±ê³¼ì˜ ì—°ê²° ê°•í™”
â€¢ ì‚¬íšŒì  ê³ ë¦½ ë°©ì§€

ì´ ìš”ì•½ì€ ë”ë¯¸ ë°ì´í„°ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.`,

      3: `ğŸ” ${clientName} ì–´ë¥´ì‹  ${sessionNumber}íšŒì°¨ ìƒë‹´ ìš”ì•½ (ê°€ì¡± ì¤‘ì‹¬ ëŒ€í™”)

ğŸ“… ìƒë‹´ ì •ë³´
â€¢ ìƒë‹´ì¼: ${date}
â€¢ íšŒì°¨: ${sessionNumber}íšŒì°¨
â€¢ í´ë¼ì´ì–¸íŠ¸: ${clientName} ì–´ë¥´ì‹ 
â€¢ ìƒë‹´ ìœ í˜•: ì •ê¸° ìƒë‹´

ğŸ“ ìƒë‹´ ë‚´ìš© ë¶„ì„
â€¢ ì£¼ìš” ì£¼ì œ: ê°€ì¡± ì¶”ì–µ, ê°€ì¡± ì‚¬ì§„, ìì•„ì¡´ì¤‘ê°
â€¢ ê°ì • ìƒíƒœ: ê·¸ë¦¬ì›€, ê°ì‚¬í•¨, ë”°ëœ»í•¨
â€¢ ì ìš©ëœ ì „ëµ: ê°€ì¡± ì‚¬ì§„ì„ í†µí•œ ì¶”ì–µ ëŒ€í™”, ê°€ì¡±ê³¼ì˜ ì†Œí†µ

ğŸ’¡ í•µì‹¬ í†µì°°
â€¢ ê°€ì¡±ê³¼ì˜ ì¶”ì–µì´ ì •ì„œì  ì•ˆì •ì— í•µì‹¬ ì—­í• 
â€¢ ê°€ì¡± ì‚¬ì§„ì´ ê¸ì •ì  ê°ì • íšŒìƒì— íš¨ê³¼ì 
â€¢ ìì•„ì¡´ì¤‘ê° í–¥ìƒì„ ìœ„í•œ ê°€ì¡± ì¤‘ì‹¬ ì ‘ê·¼

ğŸ¯ ê°œì„  ë°©í–¥
â€¢ ê°€ì¡±ê³¼ì˜ ì†Œí†µ ë¹ˆë„ ì¦ê°€
â€¢ ê°€ì¡± ì¶”ì–µ í™œìš© ì „ëµ í™•ëŒ€
â€¢ ìì•„ì¡´ì¤‘ê° ì§€ì†ì  í–¥ìƒ

ğŸ“Š ì„¸ì…˜ íš¨ê³¼ì„±
â€¢ ì™¸ë¡œì›€ ì ìˆ˜: ê°œì„  (6ì )
â€¢ ìì•„ì¡´ì¤‘ê°: í–¥ìƒ
â€¢ ì „ë°˜ì  ë§Œì¡±ë„: í–¥ìƒ

ğŸ”® ë‹¤ìŒ ìƒë‹´ ê³„íš
â€¢ ê°€ì¡±ê³¼ì˜ ì •ê¸°ì  ì—°ë½
â€¢ ê°€ì¡± ì‚¬ì§„ ì •ë¦¬ í™œë™
â€¢ ì†ìì™€ì˜ ì†Œí†µ ê°•í™”

ğŸ“‹ íŠ¹ì´ì‚¬í•­
â€¢ ê°€ì¡± ì‚¬ì§„ì´ ì¶”ì–µ íšŒìƒì— ë„ì›€
â€¢ ê°€ì¡±ê³¼ì˜ ëŒ€í™”ê°€ ê¸°ë¶„ ì „í™˜ì— íš¨ê³¼ì 
â€¢ ì†ìì™€ì˜ ê´€ê³„ê°€ íŠ¹ë³„í•¨

ğŸ’ª ê¶Œì¥ì‚¬í•­
â€¢ ê°€ì¡±ê³¼ì˜ ì •ê¸°ì  ì—°ë½
â€¢ ê°€ì¡± ì‚¬ì§„ ì •ë¦¬ ë° ê°ìƒ
â€¢ ì†ìì™€ì˜ ë†€ì´ í™œë™
â€¢ ê°€ì¡± ì¶”ì–µ ê³µìœ  ì‹œê°„

ğŸŒŸ ê¸ì •ì  ë³€í™”
â€¢ ê°€ì¡±ê³¼ì˜ ê´€ê³„ ê°œì„ 
â€¢ ìì•„ì¡´ì¤‘ê° í–¥ìƒ
â€¢ ê¸ì •ì  ê°ì • ì¦ê°€

âš ï¸ ì£¼ì˜ì‚¬í•­
â€¢ ê°€ì¡±ê³¼ì˜ ì†Œí†µ ë¹ˆë„ ìœ ì§€
â€¢ ì¶”ì–µ ëŒ€í™”ì˜ ì ì ˆí•œ í™œìš©
â€¢ ê°ì •ì  ê· í˜• ìœ ì§€

ì´ ìš”ì•½ì€ ë”ë¯¸ ë°ì´í„°ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.`,

      4: `ğŸ” ${clientName} ì–´ë¥´ì‹  ${sessionNumber}íšŒì°¨ ìƒë‹´ ìš”ì•½ (ì‚¬íšŒì  êµë¥˜ ì¦ì§„)

ğŸ“… ìƒë‹´ ì •ë³´
â€¢ ìƒë‹´ì¼: ${date}
â€¢ íšŒì°¨: ${sessionNumber}íšŒì°¨
â€¢ í´ë¼ì´ì–¸íŠ¸: ${clientName} ì–´ë¥´ì‹ 
â€¢ ìƒë‹´ ìœ í˜•: ì •ê¸° ìƒë‹´

ğŸ“ ìƒë‹´ ë‚´ìš© ë¶„ì„
â€¢ ì£¼ìš” ì£¼ì œ: ì´ì›ƒê³¼ì˜ ì†Œí†µ, ì§€ì—­ì‚¬íšŒ í™œë™, ì‚¬íšŒì  êµë¥˜
â€¢ ê°ì • ìƒíƒœ: ê¸°ëŒ€ê°, ì™¸ë¡œì›€ ê°ì†Œ, ì‚¬íšŒì  ì—°ê²°ê°
â€¢ ì ìš©ëœ ì „ëµ: ì´ì›ƒê³¼ì˜ ëŒ€í™”, ì‚°ì±… í™œë™, ë§ˆíŠ¸ ë°©ë¬¸

ğŸ’¡ í•µì‹¬ í†µì°°
â€¢ ì´ì›ƒê³¼ì˜ ì†Œí†µì´ ì™¸ë¡œì›€ ì™„í™”ì— íš¨ê³¼ì 
â€¢ ì§€ì—­ì‚¬íšŒ í™œë™ ì°¸ì—¬ ì˜í–¥ ì¦ê°€
â€¢ ì‚¬íšŒì  ì—°ê²°ê°ì´ ì •ì„œì  ì•ˆì •ì— ê¸°ì—¬

ğŸ¯ ê°œì„  ë°©í–¥
â€¢ ì´ì›ƒê³¼ì˜ ê´€ê³„ ì‹¬í™”
â€¢ ì§€ì—­ì‚¬íšŒ í™œë™ ì°¸ì—¬ í™•ëŒ€
â€¢ ì‚¬íšŒì  êµë¥˜ ì§€ì†ì  ì¦ì§„

ğŸ“Š ì„¸ì…˜ íš¨ê³¼ì„±
â€¢ ì™¸ë¡œì›€ ì ìˆ˜: ê°œì„  (6ì )
â€¢ ì‚¬íšŒì  êµë¥˜: ì¦ê°€
â€¢ ì „ë°˜ì  ë§Œì¡±ë„: í–¥ìƒ

ğŸ”® ë‹¤ìŒ ìƒë‹´ ê³„íš
â€¢ ì´ì›ƒê³¼ì˜ ì •ê¸°ì  ëŒ€í™”
â€¢ ì§€ì—­ì‚¬íšŒ í™œë™ ì°¸ì—¬
â€¢ ìƒˆë¡œìš´ ì‚¬íšŒì  ê´€ê³„ êµ¬ì¶•

ğŸ“‹ íŠ¹ì´ì‚¬í•­
â€¢ ì´ì›ƒê³¼ì˜ ëŒ€í™”ê°€ ê¸°ë¶„ ì „í™˜ì— íš¨ê³¼ì 
â€¢ ì‚°ì±…ì´ ì‚¬íšŒì  êµë¥˜ì— ë„ì›€
â€¢ ë§ˆíŠ¸ ë°©ë¬¸ì´ ì´ì›ƒê³¼ì˜ ë§Œë‚¨ ê¸°íšŒ ì œê³µ

ğŸ’ª ê¶Œì¥ì‚¬í•­
â€¢ ë§¤ì¼ ì•„ì¹¨ ì‚°ì±… í™œë™
â€¢ ì´ì›ƒê³¼ì˜ ì •ê¸°ì  ëŒ€í™”
â€¢ ì§€ì—­ì‚¬íšŒ í™œë™ ì°¸ì—¬
â€¢ ìƒˆë¡œìš´ ì·¨ë¯¸ í™œë™ íƒìƒ‰

ğŸŒŸ ê¸ì •ì  ë³€í™”
â€¢ ì‚¬íšŒì  êµë¥˜ ì˜í–¥ ì¦ê°€
â€¢ ì™¸ë¡œì›€ ê°ì†Œ ê²½í—˜
â€¢ ì§€ì—­ì‚¬íšŒ í™œë™ ê´€ì‹¬ ì¦ê°€

âš ï¸ ì£¼ì˜ì‚¬í•­
â€¢ ì‚¬íšŒì  êµë¥˜ì˜ ì ì ˆí•œ ìˆ˜ì¤€ ìœ ì§€
â€¢ ê°œì¸ì  ê³µê°„ê³¼ ì‹œê°„ ë³´ì¥
â€¢ ì‚¬íšŒì  í™œë™ì˜ ì§€ì†ì„± í™•ë³´

ì´ ìš”ì•½ì€ ë”ë¯¸ ë°ì´í„°ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.`,

      5: `ğŸ” ${clientName} ì–´ë¥´ì‹  ${sessionNumber}íšŒì°¨ ìƒë‹´ ìš”ì•½ (ì¢…í•©ì  ê°œì„ )

ğŸ“… ìƒë‹´ ì •ë³´
â€¢ ìƒë‹´ì¼: ${date}
â€¢ íšŒì°¨: ${sessionNumber}íšŒì°¨
â€¢ í´ë¼ì´ì–¸íŠ¸: ${clientName} ì–´ë¥´ì‹ 
â€¢ ìƒë‹´ ìœ í˜•: ì •ê¸° ìƒë‹´

ğŸ“ ìƒë‹´ ë‚´ìš© ë¶„ì„
â€¢ ì£¼ìš” ì£¼ì œ: ê°€ì¡± ê´€ê³„, ì™¸ë¡œì›€ ê´€ë¦¬, ì‚¬íšŒì  êµë¥˜, ëŒ€ì²˜ ì „ëµ
â€¢ ê°ì • ìƒíƒœ: ì™¸ë¡œì›€ ì™„í™”, ê°ì‚¬í•¨, ë”°ëœ»í•¨, ê¸°ëŒ€ê°
â€¢ ì ìš©ëœ ì „ëµ: í˜¸í¡ ìš´ë™, ì‚°ì±…, ê°€ì¡± ì‚¬ì§„, ì´ì›ƒê³¼ì˜ ì†Œí†µ

ğŸ’¡ í•µì‹¬ í†µì°°
â€¢ ê°€ì¡±ê³¼ì˜ ì—°ê²°ì´ ì •ì„œì  ì•ˆì •ì˜ í•µì‹¬
â€¢ ì²´ê³„ì ì¸ ëŒ€ì²˜ ì „ëµì´ ì™¸ë¡œì›€ ì™„í™”ì— íš¨ê³¼ì 
â€¢ ì‚¬íšŒì  êµë¥˜ì™€ ê°€ì¡± ê´€ê³„ì˜ ê· í˜•ì´ ì¤‘ìš”

ğŸ¯ ê°œì„  ë°©í–¥
â€¢ ê°€ì¡±ê³¼ì˜ ì†Œí†µ ë¹ˆë„ ì§€ì†ì  ì¦ê°€
â€¢ ì‚¬íšŒì  êµë¥˜ í™œë™ í™•ëŒ€
â€¢ ëŒ€ì²˜ ì „ëµì˜ ì²´ê³„ì  ì ìš©

ğŸ“Š ì„¸ì…˜ íš¨ê³¼ì„±
â€¢ ì™¸ë¡œì›€ ì ìˆ˜: ê°œì„  (5ì )
â€¢ ìš°ìš¸ê°: ê°œì„  (4ì )
â€¢ ì „ë°˜ì  ë§Œì¡±ë„: í¬ê²Œ í–¥ìƒ

ğŸ”® ë‹¤ìŒ ìƒë‹´ ê³„íš
â€¢ ê°€ì¡±ê³¼ì˜ ì£¼ê°„ ì •ê¸° ì—°ë½
â€¢ ìƒˆë¡œìš´ ì·¨ë¯¸ í™œë™ ë„ì…
â€¢ ì´ì›ƒê³¼ì˜ ê´€ê³„ ì‹¬í™”

ğŸ“‹ íŠ¹ì´ì‚¬í•­
â€¢ í˜¸í¡ ìš´ë™ì´ ì •ì„œ ì¡°ì ˆì— ë§¤ìš° íš¨ê³¼ì 
â€¢ ê°€ì¡± ì‚¬ì§„ì´ ì¶”ì–µ íšŒìƒì— í° ë„ì›€
â€¢ ì‚°ì±…ì´ ê¸°ë¶„ ì „í™˜ê³¼ ì‚¬íšŒì  êµë¥˜ì— ìœ ìš©

ğŸ’ª ê¶Œì¥ì‚¬í•­
â€¢ ë§¤ì¼ ì•„ì¹¨ í˜¸í¡ ìš´ë™ ì‹¤ì²œ
â€¢ ì£¼ 3íšŒ ì´ìƒ ì‚°ì±… í™œë™
â€¢ ê°€ì¡±ê³¼ì˜ ì •ê¸°ì  ì—°ë½ ìœ ì§€
â€¢ ì´ì›ƒê³¼ì˜ ëŒ€í™” ì‹œê°„ í™•ëŒ€

ğŸŒŸ ê¸ì •ì  ë³€í™”
â€¢ ì™¸ë¡œì›€ ê°ì†Œ ê²½í—˜
â€¢ ê°€ì¡±ê³¼ì˜ ê´€ê³„ ê°œì„ 
â€¢ ì‚¬íšŒì  êµë¥˜ ì˜í–¥ ì¦ê°€
â€¢ ìì•„ì¡´ì¤‘ê° í–¥ìƒ

âš ï¸ ì£¼ì˜ì‚¬í•­
â€¢ ê°ì • ë³€í™” ëª¨ë‹ˆí„°ë§ í•„ìš”
â€¢ ì§€ì†ì ì¸ ì •ì„œì  ì§€ì§€ ì œê³µ
â€¢ ê°€ì¡±ê³¼ì˜ ì†Œí†µ ë¹ˆë„ ìœ ì§€

ì´ ìš”ì•½ì€ ë”ë¯¸ ë°ì´í„°ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.`
    }

    return summaries[sessionNumber as keyof typeof summaries] || summaries[5]
  }, []) // ì˜ì¡´ì„± ë°°ì—´ ë¹„ì›€ - í•¨ìˆ˜ ë‚´ë¶€ì—ì„œ ì™¸ë¶€ ìƒíƒœë¥¼ ì°¸ì¡°í•˜ì§€ ì•ŠìŒ

  if (showEmotionalTracking && selectedClient) {
    return <EmotionalStateTracking client={selectedClient} onBack={() => setShowEmotionalTracking(false)} />
  }

  if (showAIGuide && selectedClient) {
    return (
      <AICounselingGuide
        client={selectedClient}
        onBack={() => setShowAIGuide(false)}
        onStartSession={(guide) => {
          console.log("Starting session with guide:", guide)
          setShowAIGuide(false)
        }}
      />
    )
  }

  if (selectedClient) {
    return (
      <div className="min-h-screen bg-background">
        {/* Header */}
        <header className="bg-card border-b border-border px-4 py-4">
          <div className="max-w-6xl mx-auto flex items-center justify-between">
            <div className="flex items-center gap-4">
              <Button variant="ghost" size="icon" onClick={() => setSelectedClient(null)}>
                <ArrowLeft className="h-5 w-5" />
              </Button>
              <div>
                <h1 className="text-2xl font-bold text-primary">{selectedClient.name} ì–´ë¥´ì‹ </h1>
                <p className="text-sm text-muted-foreground">ìƒë‹´ ê¸°ë¡ ë° ì •ì„œ ë¶„ì„</p>
              </div>
            </div>
            <div className="flex items-center gap-2">
              <Button
                variant="outline"
                onClick={() => setShowEmotionalTracking(true)}
                className="flex items-center gap-2"
              >
                <BarChart3 className="h-4 w-4" />
                ì •ì„œ ì¶”ì 
              </Button>
              <Button className="flex items-center gap-2" onClick={() => setShowAIGuide(true)}>
                <Brain className="h-4 w-4" />
                AI ê°€ì´ë“œ ìƒì„±
              </Button>
            </div>
          </div>
        </header>

        <main className="max-w-6xl mx-auto px-4 py-6">
          <div className="grid gap-6 lg:grid-cols-3">
            {/* Client Profile */}
            <div className="space-y-6">
              <Card>
                <CardHeader>
                  <CardTitle>ê¸°ë³¸ ì •ë³´</CardTitle>
                </CardHeader>
                <CardContent className="space-y-4">
                  <div className="flex items-center gap-4">
                    <Avatar className="h-16 w-16">
                      <AvatarImage src={selectedClient.photo || "/placeholder.svg"} />
                      <AvatarFallback className="text-lg">{selectedClient.name.charAt(0)}</AvatarFallback>
                    </Avatar>
                    <div>
                      <h3 className="font-semibold text-lg">{selectedClient.name}</h3>
                      <p className="text-sm text-muted-foreground">
                        {selectedClient.age}ì„¸ ({selectedClient.birthDate})
                      </p>
                    </div>
                  </div>

                  <div className="space-y-3">
                    <div className="flex items-center gap-2">
                      <Phone className="h-4 w-4 text-muted-foreground" />
                      <span className="text-sm">{selectedClient.phone}</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <MapPin className="h-4 w-4 text-muted-foreground" />
                      <span className="text-sm">{selectedClient.address}</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <User className="h-4 w-4 text-muted-foreground" />
                      <span className="text-sm">
                        ë³´í˜¸ì: {selectedClient.guardian.name} ({selectedClient.guardian.relationship})
                      </span>
                    </div>
                    <div className="flex items-center gap-2">
                      <Phone className="h-4 w-4 text-muted-foreground" />
                      <span className="text-sm">{selectedClient.guardian.phone}</span>
                    </div>
                  </div>
                </CardContent>
              </Card>

              <Card>
                <CardHeader>
                  <CardTitle>í˜„ì¬ ì •ì„œ ìƒíƒœ</CardTitle>
                </CardHeader>
                <CardContent className="space-y-4">
                  <div className="flex items-center justify-between">
                    <span className="text-sm font-medium">ìƒíƒœ</span>
                    <Badge className={getEmotionalStateColor(selectedClient.emotionalState.current)}>
                      {selectedClient.emotionalState.current}
                    </Badge>
                  </div>
                  <div className="flex items-center justify-between">
                    <span className="text-sm font-medium">ë³€í™” ì¶”ì´</span>
                    <div className="flex items-center gap-2">
                      {getTrendIcon(selectedClient.emotionalState.trend)}
                      <span className="text-sm">{selectedClient.emotionalState.trend}</span>
                    </div>
                  </div>
                  <div className="p-3 bg-muted/50 rounded-lg">
                    <p className="text-sm">{selectedClient.emotionalState.summary}</p>
                  </div>
                  <div className="grid grid-cols-2 gap-4 text-center">
                    <div>
                      <p className="text-2xl font-bold text-primary">{selectedClient.totalSessions}</p>
                      <p className="text-xs text-muted-foreground">ì´ ìƒë‹´ íšŸìˆ˜</p>
                    </div>
                    <div>
                      <p className="text-2xl font-bold text-accent">{selectedClient.lastVisit}</p>
                      <p className="text-xs text-muted-foreground">ìµœê·¼ ë°©ë¬¸</p>
                    </div>
                  </div>
                </CardContent>
              </Card>
            </div>

            {/* Counseling Records */}
            <div className="lg:col-span-2 space-y-6">
              <Card>
                <CardHeader>
                  <CardTitle className="flex items-center justify-between">
                    <div className="flex items-center gap-2">
                    <MessageCircle className="h-5 w-5 text-primary" />
                    ìƒë‹´ ê¸°ë¡
                    </div>
                    <Button
                      variant="outline"
                      size="sm"
                      onClick={() => setShowRecords(!showRecords)}
                      className="flex items-center gap-2"
                    >
                      {showRecords ? "ê¸°ë¡ ìˆ¨ê¸°ê¸°" : "ìƒë‹´ ê¸°ë¡ ë³´ê¸°"}
                    </Button>
                  </CardTitle>
                </CardHeader>
                <CardContent>
                  {!showRecords ? (
                    // ì „ì²´ ìƒë‹´ ìš”ì•½
                  <div className="space-y-4">
                      {/* AI ìƒë‹´ ë¶„ì„ ìš”ì•½ */}
                      <div className="p-4 bg-gradient-to-r from-green-50 to-emerald-50 rounded-lg border border-green-200">
                        <h6 className="font-semibold text-green-800 mb-3">ğŸ¤– ìµœê·¼ AI ìƒë‹´ ë¶„ì„ ìš”ì•½</h6>
                        <div className="space-y-2 text-sm text-green-700">
                          <p>â€¢ ê¹€ìˆœì•  ì–´ë¥´ì‹ ì€ 5íšŒì°¨ ìƒë‹´(2024-01-15)ì—ì„œ ê°€ì¡± ì‚¬ì§„ì„ í†µí•œ ì¶”ì–µ ëŒ€í™”ì™€ í˜¸í¡ ìš´ë™ì„ í†µí•œ ëŒ€ì²˜ ì „ëµì„ ì„±ê³µì ìœ¼ë¡œ ì ìš©í•˜ì—¬ ì™¸ë¡œì›€ ì ìˆ˜ê°€ 8ì ì—ì„œ 5ì ìœ¼ë¡œ ê°œì„ ë˜ì—ˆìœ¼ë©°, ì´ì›ƒê³¼ì˜ ì‚°ì±… í™œë™ì´ ì •ì„œ ê°œì„ ì— í¬ê²Œ ê¸°ì—¬í–ˆìŠµë‹ˆë‹¤.</p>
                          <p>â€¢ 4íšŒì°¨(2024-01-08)ì—ì„œ ì´ì›ƒê³¼ì˜ ì†Œí†µ ê²½í—˜ì„ í†µí•´ ì§€ì—­ì‚¬íšŒ í™œë™ ì°¸ì—¬ ì˜í–¥ì´ ì¦ê°€í–ˆìœ¼ë©°, 3íšŒì°¨(2024-01-01)ì˜ ê°€ì¡± ì¶”ì–µ ëŒ€í™”ì™€ ê°€ì¡± ì‚¬ì§„ ì •ë¦¬ê°€ ìì•„ì¡´ì¤‘ê° í–¥ìƒì— ê¸°ì—¬í–ˆìŠµë‹ˆë‹¤.</p>
                          <p>â€¢ 1-2íšŒì°¨(2024-12-18~25)ì˜ ì™¸ë¡œì›€ í˜¸ì†Œ(8ì )ì™€ ìš°ìš¸ê°(6-7ì )ì—ì„œ 5íšŒì°¨ì˜ ì™¸ë¡œì›€(5ì )ê³¼ ìš°ìš¸ê°(4ì )ê¹Œì§€ ì ì§„ì  ê°œì„ ì„ ë³´ì´ë‚˜, ì§€ì†ì ì¸ ì •ì„œì  ì§€ì§€ì™€ ì‚¬íšŒì  êµë¥˜ ì¦ì§„ì´ í•„ìš”í•˜ë©°, ê°€ì¡± ì—°ê³„ ê°•í™”ê°€ í•µì‹¬ ê³¼ì œì…ë‹ˆë‹¤.</p>
                        </div>
                      </div>
                    </div>
                  ) : (
                    // ìƒì„¸ ìƒë‹´ ê¸°ë¡
                    <div className="space-y-4">
                      {clientRecords.map((record, index) => {
                        const sessionNumber = clientRecords.length - index
                        const showDetail = showDetailStates[record.id] || false
                        
                        return (
                      <div key={record.id} className="border border-border rounded-lg p-4">
                        <div className="flex items-center justify-between mb-3">
                          <div className="flex items-center gap-3">
                            <Badge variant={record.type === "ê¸´ê¸‰" ? "destructive" : "default"}>{record.type}</Badge>
                            <span className="font-medium">{record.date}</span>
                            <span className="text-sm text-muted-foreground">{record.duration}ë¶„</span>
                                <span className="text-sm font-medium text-primary">{sessionNumber}íšŒì°¨</span>
                          </div>
                        </div>
                              <div className="space-y-2">
                        <div className="grid grid-cols-4 gap-4 mb-3">
                          <div className="text-center">
                            <p className="text-sm text-muted-foreground">ìš°ìš¸</p>
                            <p className="text-lg font-semibold text-blue-600">{record.emotionalScores.depression}</p>
                          </div>
                          <div className="text-center">
                            <p className="text-sm text-muted-foreground">ë¶ˆì•ˆ</p>
                            <p className="text-lg font-semibold text-orange-600">{record.emotionalScores.anxiety}</p>
                          </div>
                          <div className="text-center">
                            <p className="text-sm text-muted-foreground">ì™¸ë¡œì›€</p>
                            <p className="text-lg font-semibold text-purple-600">{record.emotionalScores.loneliness}</p>
                          </div>
                          <div className="text-center">
                            <p className="text-sm text-muted-foreground">ë¶„ë…¸</p>
                            <p className="text-lg font-semibold text-red-600">{record.emotionalScores.anger}</p>
                          </div>
                        </div>

                                <div className="p-4 bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl border border-blue-200 shadow-sm">
                                  {/* ìƒë‹´ ê¸°ë¡ í—¤ë” */}
                                  <div className="flex items-center justify-between mb-4">
                                    <div className="flex items-center space-x-2">
                                      <div className="w-2 h-2 bg-blue-500 rounded-full"></div>
                                      <span className="text-sm font-semibold text-blue-800">ìƒë‹´ ê¸°ë¡</span>
                                    </div>
                                  </div>
                                  
                                  {/* ìƒë‹´ ë‚´ìš© */}
                                  <div className="bg-white rounded-lg p-3 border border-blue-100 shadow-sm">
                                    <div className="whitespace-pre-wrap text-sm leading-relaxed text-gray-700 max-h-40 overflow-y-auto">
                                      {record.notes}
                                    </div>
                                    
                                  </div>
                                  
                                  {/* AI ë¶„ì„ ìš”ì•½ */}
                                  {record.aiSummary && (
                                    <div className="mt-3 pt-3 border-t border-blue-200">
                                      <div className="flex items-center space-x-2 mb-2">
                                        <div className="w-1.5 h-1.5 bg-green-500 rounded-full"></div>
                                        <span className="text-xs font-medium text-green-700">AI ë¶„ì„ ìš”ì•½</span>
                                      </div>
                                      <div className="bg-green-50 rounded-lg p-2 border border-green-100">
                                        <p className="text-xs leading-relaxed text-green-800">
                                          {record.aiSummary || generateDummyAISummary(record.notes, record.date, record.emotionalScores)}
                                        </p>
                                      </div>
                                    </div>
                                  )}
                                </div>
                              </div>
                          </div>
                        )
                      })}
                    </div>
                  )}
                </CardContent>
              </Card>

              {/* AI ê¸°ë°˜ ìƒë‹´ ì§„í–‰ ì¹´ë“œ */}
              <Card>
                <CardHeader>
                  <CardTitle>6íšŒì°¨ ìƒë‹´ ì§„í–‰ - AI ê°€ì´ë“œ ê¸°ë°˜</CardTitle>
                </CardHeader>
                <CardContent>
                  <div className="space-y-6">
                    {/* ê¸°ë³¸ ê°ì •ìƒíƒœ ì²´í¬ */}
                    <div className="p-4 bg-blue-50 rounded-lg">
                      <h4 className="font-semibold mb-3 text-blue-800">ê¸°ë³¸ ê°ì •ìƒíƒœ ì²´í¬</h4>
                      <div className="grid grid-cols-2 gap-4 mb-4">
                    <div className="space-y-2">
                          <label className="text-sm font-medium text-blue-700">ìš°ìš¸ê° (0-10)</label>
                      <div className="flex items-center gap-2">
                            <input 
                              type="range" 
                              min="0" 
                              max="10" 
                              value={emotionalScores.depression}
                              onChange={(e) => handleScoreChange('depression', parseInt(e.target.value))}
                              className="flex-1" 
                            />
                            <span className="text-sm font-semibold text-blue-800 w-8 text-center">{emotionalScores.depression}</span>
                      </div>
                        </div>
                        <div className="space-y-2">
                          <label className="text-sm font-medium text-blue-700">ë¶ˆì•ˆê° (0-10)</label>
                      <div className="flex items-center gap-2">
                            <input 
                              type="range" 
                              min="0" 
                              max="10" 
                              value={emotionalScores.anxiety}
                              onChange={(e) => handleScoreChange('anxiety', parseInt(e.target.value))}
                              className="flex-1" 
                            />
                            <span className="text-sm font-semibold text-blue-800 w-8 text-center">{emotionalScores.anxiety}</span>
                      </div>
                        </div>
                        <div className="space-y-2">
                          <label className="text-sm font-medium text-blue-700">ì™¸ë¡œì›€ (0-10)</label>
                      <div className="flex items-center gap-2">
                            <input 
                              type="range" 
                              min="0" 
                              max="10" 
                              value={emotionalScores.loneliness}
                              onChange={(e) => handleScoreChange('loneliness', parseInt(e.target.value))}
                              className="flex-1" 
                            />
                            <span className="text-sm font-semibold text-blue-800 w-8 text-center">{emotionalScores.loneliness}</span>
                      </div>
                    </div>
                        <div className="space-y-2">
                          <label className="text-sm font-medium text-blue-700">ë¶„ë…¸ (0-10)</label>
                          <div className="flex items-center gap-2">
                            <input 
                              type="range" 
                              min="0" 
                              max="10" 
                              value={emotionalScores.anger}
                              onChange={(e) => handleScoreChange('anger', parseInt(e.target.value))}
                              className="flex-1" 
                            />
                            <span className="text-sm font-semibold text-blue-800 w-8 text-center">{emotionalScores.anger}</span>
                  </div>
                        </div>
                      </div>
                      <div className="space-y-2">
                        <label className="text-sm font-medium text-blue-700">ì „ë°˜ì  ê¸°ë¶„</label>
                        <div className="flex flex-wrap gap-2">
                          {["ë§¤ìš° ì¢‹ìŒ", "ì¢‹ìŒ", "ë³´í†µ", "ë‚˜ì¨", "ë§¤ìš° ë‚˜ì¨", "ë¶ˆì•ˆ", "ìš°ìš¸", "í™”ë‚¨", "ì™¸ë¡œì›€"].map((mood) => (
                            <button
                              key={mood}
                              onClick={() => handleMoodSelect(mood)}
                              className={`px-3 py-1 text-xs rounded-full border ${
                                mood === selectedMood
                                  ? "bg-blue-600 text-white border-blue-600" 
                                  : "bg-white text-blue-700 border-blue-300 hover:bg-blue-50"
                              }`}
                            >
                              {mood}
                            </button>
                          ))}
                        </div>
                      </div>
                    </div>

                    {/* AI ìƒë‹´ ê°€ì´ë“œ */}
                    <div className="p-4 bg-green-50 rounded-lg">
                      <h4 className="font-semibold mb-3 text-green-800">AI ìƒë‹´ ê°€ì´ë“œ</h4>
                      <div className="space-y-4">
                        {/* ìƒë‹´ ëª©í‘œ */}
                        <div className="p-3 bg-white rounded-lg border border-green-200">
                          <h5 className="font-medium text-green-800 mb-2">ìƒë‹´ ëª©í‘œ</h5>
                          <div className="space-y-2 text-sm text-green-700">
                            <p>â€¢ ì •ì„œì  ì§€ì§€ ê°•í™”</p>
                            <p>â€¢ ê°€ì¡±ê´€ê³„ ì† ì™¸ë¡œì›€ ì™„í™”</p>
                            <p>â€¢ ë‹¨ê¸° ê¸°ì–µ ì €í•˜ë¡œ ì¸í•œ í˜¼ë€ ì™„í™”</p>
                          </div>
                        </div>

                        {/* 5ë‹¨ê³„ ì§„í–‰ ê°€ì´ë“œ */}
                        <div className="space-y-3">
                          {/* Step 1: ê¸°ë³¸ì ì¸ ì²´í¬ë¦¬ìŠ¤íŠ¸ */}
                          <div className="p-3 bg-white rounded-lg border border-green-200">
                            <div className="flex items-center justify-between mb-2">
                              <h5 className="font-medium text-green-800">1. ê¸°ë³¸ì ì¸ ì²´í¬ë¦¬ìŠ¤íŠ¸</h5>
                              <Button 
                                size="sm" 
                                variant="outline" 
                                className="text-xs px-2 py-1 h-6"
                                onClick={() => regenerateStep(1)}
                              >
                                ë‹¤ì‹œ ìƒì„±
                              </Button>
                            </div>
                            <div className="text-sm text-green-700">
                              {stepQuestions[1].map((q, index) => (
                                <div key={index} className="flex items-start gap-2 mb-2">
                                  <input
                                    type="checkbox"
                                    checked={checkedQuestions[1]?.has(index) || false}
                                    onChange={() => toggleQuestionCheck(1, index)}
                                    className="mt-1 h-4 w-4 text-green-600 focus:ring-green-500 border-green-300 rounded"
                                  />
                                  <p className="flex-1">{q}</p>
                                </div>
                              ))}
                            </div>
                          </div>

                          {/* Step 2: ê¸°ì¡´ ìƒë‹´ ë°ì´í„° ë°”íƒ•ìœ¼ë¡œ ì£¼ì œ ì„ ì • */}
                          <div className="p-3 bg-white rounded-lg border border-green-200">
                            <div className="flex items-center justify-between mb-2">
                              <h5 className="font-medium text-green-800">2. ê¸°ì¡´ ìƒë‹´ ë°ì´í„° ë°”íƒ•ìœ¼ë¡œ ì£¼ì œ ì„ ì •</h5>
                              <Button 
                                size="sm" 
                                variant="outline" 
                                className="text-xs px-2 py-1 h-6"
                                onClick={() => regenerateStep(2)}
                              >
                                ë‹¤ì‹œ ìƒì„±
                              </Button>
                            </div>
                            <div className="text-sm text-green-700">
                              {stepQuestions[2].map((q, index) => (
                                <div key={index} className="flex items-start gap-2 mb-2">
                                  <input
                                    type="checkbox"
                                    checked={checkedQuestions[2]?.has(index) || false}
                                    onChange={() => toggleQuestionCheck(2, index)}
                                    className="mt-1 h-4 w-4 text-green-600 focus:ring-green-500 border-green-300 rounded"
                                  />
                                  <p className="flex-1">{q}</p>
                                </div>
                              ))}
                            </div>
                          </div>

                          {/* Step 3: ê°ì • í‘œí˜„ ìœ ë„ */}
                          <div className="p-3 bg-white rounded-lg border border-green-200">
                            <div className="flex items-center justify-between mb-2">
                              <h5 className="font-medium text-green-800">3. ê°ì • í‘œí˜„ ìœ ë„</h5>
                              <Button 
                                size="sm" 
                                variant="outline" 
                                className="text-xs px-2 py-1 h-6"
                                onClick={() => regenerateStep(3)}
                              >
                                ë‹¤ì‹œ ìƒì„±
                              </Button>
                            </div>
                            <div className="text-sm text-green-700">
                              {stepQuestions[3].map((q, index) => (
                                <div key={index} className="flex items-start gap-2 mb-2">
                                  <input
                                    type="checkbox"
                                    checked={checkedQuestions[3]?.has(index) || false}
                                    onChange={() => toggleQuestionCheck(3, index)}
                                    className="mt-1 h-4 w-4 text-green-600 focus:ring-green-500 border-green-300 rounded"
                                  />
                                  <p className="flex-1">{q}</p>
                                </div>
                              ))}
                            </div>
                          </div>

                          {/* Step 4: ëŒ€ì²˜ ì „ëµ ì œì•ˆ */}
                          <div className="p-3 bg-white rounded-lg border border-green-200">
                            <div className="flex items-center justify-between mb-2">
                              <h5 className="font-medium text-green-800">4. ëŒ€ì²˜ ì „ëµ ì œì•ˆ</h5>
                              <Button 
                                size="sm" 
                                variant="outline" 
                                className="text-xs px-2 py-1 h-6"
                                onClick={() => regenerateStep(4)}
                              >
                                ë‹¤ì‹œ ìƒì„±
                              </Button>
                            </div>
                            <div className="text-sm text-green-700">
                              {stepQuestions[4].map((q, index) => (
                                <div key={index} className="flex items-start gap-2 mb-2">
                                  <input
                                    type="checkbox"
                                    checked={checkedQuestions[4]?.has(index) || false}
                                    onChange={() => toggleQuestionCheck(4, index)}
                                    className="mt-1 h-4 w-4 text-green-600 focus:ring-green-500 border-green-300 rounded"
                                  />
                                  <p className="flex-1">{q}</p>
                                </div>
                              ))}
                            </div>
                          </div>

                          {/* Step 5: ê°€ì¡± ì—°ê³„ */}
                          <div className="p-3 bg-white rounded-lg border border-green-200">
                            <div className="flex items-center justify-between mb-2">
                              <h5 className="font-medium text-green-800">5. ê°€ì¡± ì—°ê³„</h5>
                              <Button 
                                size="sm" 
                                variant="outline" 
                                className="text-xs px-2 py-1 h-6"
                                onClick={() => regenerateStep(5)}
                              >
                                ë‹¤ì‹œ ìƒì„±
                              </Button>
                            </div>
                            <div className="text-sm text-green-700">
                              {stepQuestions[5].map((q, index) => (
                                <div key={index} className="flex items-start gap-2 mb-2">
                                  <input
                                    type="checkbox"
                                    checked={checkedQuestions[5]?.has(index) || false}
                                    onChange={() => toggleQuestionCheck(5, index)}
                                    className="mt-1 h-4 w-4 text-green-600 focus:ring-green-500 border-green-300 rounded"
                                  />
                                  <p className="flex-1">{q}</p>
                                </div>
                              ))}
                            </div>
                          </div>
                        </div>

                        {/* ì²´í¬ëœ ì§ˆë¬¸ ì €ì¥ ë° ìƒë‹´ ë©”ëª¨ ì‘ì„± */}
                        <div className="p-3 bg-white rounded-lg border border-green-200">
                          <div className="flex items-center justify-between mb-3">
                            <h5 className="font-medium text-green-800">ì²´í¬ëœ ì§ˆë¬¸ ì €ì¥ ë° ìƒë‹´ ë©”ëª¨</h5>
                            <div className="flex gap-2">
                              <Button 
                                size="sm" 
                                variant="outline" 
                                className="text-xs px-2 py-1 h-6"
                                onClick={saveCheckedQuestions}
                              >
                                ì²´í¬ëœ ì§ˆë¬¸ ì €ì¥
                              </Button>
                              <Button 
                                size="sm" 
                                variant="outline" 
                                className="text-xs px-2 py-1 h-6"
                                onClick={() => {
                                  setCounselingNotes("")
                                  setSavedCheckedQuestions({1: [], 2: [], 3: [], 4: [], 5: []})
                                }}
                              >
                                ì´ˆê¸°í™”
                              </Button>
                            </div>
                          </div>
                          
                          {/* ì €ì¥ëœ ì²´í¬ëœ ì§ˆë¬¸ë“¤ í‘œì‹œ */}
                          {Object.entries(savedCheckedQuestions).some(([_, questions]) => questions.length > 0) && (
                            <div className="mb-3 p-3 bg-green-50 rounded-lg border border-green-200">
                              <div className="flex items-center justify-between mb-2">
                                <p className="text-sm font-semibold text-green-700">ğŸ“ ì €ì¥ëœ ì²´í¬ëœ ì§ˆë¬¸ë“¤</p>
                                <span className="text-xs text-green-600 bg-green-100 px-2 py-1 rounded-full">
                                  ì´ {Object.values(savedCheckedQuestions).reduce((sum, questions) => sum + questions.length, 0)}ê°œ ì§ˆë¬¸
                                </span>
                              </div>
                              <div className="space-y-2">
                                {Object.entries(savedCheckedQuestions).map(([stepNum, questions]) => {
                                  if (questions.length === 0) return null
                                  const stepNames = {
                                    1: "ğŸ” ê¸°ë³¸ ì²´í¬ë¦¬ìŠ¤íŠ¸",
                                    2: "ğŸ¯ ì£¼ì œ ì„ ì •", 
                                    3: "ğŸ’­ ê°ì • í‘œí˜„ ìœ ë„",
                                    4: "ğŸ› ï¸ ëŒ€ì²˜ ì „ëµ",
                                    5: "ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ ê°€ì¡± ì—°ê³„"
                                  }
                                  return (
                                    <div key={stepNum} className="p-2 bg-white rounded border border-green-200">
                                      <div className="flex items-start gap-2">
                                        <span className="text-xs font-bold text-green-700 min-w-fit">
                                          {stepNames[parseInt(stepNum) as keyof typeof stepNames]}
                                        </span>
                                        <div className="flex-1">
                                          {questions.map((question, qIndex) => (
                                            <div key={qIndex} className="text-xs text-green-600 mb-1 last:mb-0">
                                              â€¢ {question}
                                            </div>
                                          ))}
                                        </div>
                                      </div>
                                    </div>
                                  )
                                })}
                              </div>
                            </div>
                          )}
                          
                          {/* ìƒë‹´ ë©”ëª¨ ì‘ì„± */}
                          <div className="space-y-2">
                            <label className="text-sm font-medium text-green-700">ìƒë‹´ ë©”ëª¨ ì‘ì„±</label>
                            <textarea
                              value={counselingNotes}
                              onChange={(e) => setCounselingNotes(e.target.value)}
                              placeholder="AI ê°€ì´ë“œì˜ 5ë‹¨ê³„ë¥¼ ë°”íƒ•ìœ¼ë¡œ ìƒë‹´ ë‚´ìš©ì„ ê¸°ë¡í•´ì£¼ì„¸ìš”. ê° ë‹¨ê³„ë³„ ì–´ë¥´ì‹ ì˜ ë°˜ì‘ê³¼ ì¤‘ìš”í•œ ë°œì–¸ì„ í¬í•¨í•´ì£¼ì„¸ìš”..."
                              className="w-full h-32 p-3 text-sm border border-green-300 rounded-lg resize-none focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent"
                            />
                            <div className="flex justify-between items-center text-xs text-green-600">
                              <span>ì²´í¬ëœ ì§ˆë¬¸ë“¤ì´ ìë™ìœ¼ë¡œ ë©”ëª¨ì— ì¶”ê°€ë©ë‹ˆë‹¤</span>
                              <span>{counselingNotes.length}ì</span>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>

                    {/* ë‹¤ìŒ ìƒë‹´ ê³„íš */}
                    <div className="p-4 bg-indigo-50 rounded-lg">
                      <h4 className="font-semibold mb-3 text-indigo-800">ë‹¤ìŒ ìƒë‹´ ê³„íš</h4>
                      <div className="space-y-4">
                        <div className="grid grid-cols-2 gap-4">
                          <div className="space-y-2">
                            <label className="text-sm font-medium text-indigo-700">ë‹¤ìŒ ìƒë‹´ ì£¼ì œ</label>
                            <input 
                              type="text" 
                              value={nextSessionTopic}
                              onChange={(e) => setNextSessionTopic(e.target.value)}
                              placeholder="ë‹¤ìŒ ìƒë‹´ì—ì„œ ë‹¤ë£° ì£¼ì œë¥¼ ì…ë ¥í•˜ì„¸ìš”"
                              className="w-full p-2 text-sm border border-indigo-300 rounded focus:outline-none focus:ring-2 focus:ring-indigo-500"
                            />
                          </div>
                          <div className="space-y-2">
                            <label className="text-sm font-medium text-indigo-700">ì˜ˆì •ì¼</label>
                            <input 
                              type="date" 
                              value={nextSessionDate}
                              onChange={(e) => setNextSessionDate(e.target.value)}
                              className="w-full p-2 text-sm border border-indigo-300 rounded focus:outline-none focus:ring-2 focus:ring-indigo-500"
                            />
                          </div>
                        </div>
                        
                        <div className="space-y-2">
                          <label className="text-sm font-medium text-indigo-700">íŠ¹ì´ì‚¬í•­ ë° ì£¼ì˜ì‚¬í•­</label>
                          <textarea
                            value={specialNotes}
                            onChange={(e) => setSpecialNotes(e.target.value)}
                            placeholder="ë‹¤ìŒ ìƒë‹´ ì‹œ ì°¸ê³ í•  íŠ¹ì´ì‚¬í•­ì´ë‚˜ ì£¼ì˜ì‚¬í•­ì„ ê¸°ë¡í•˜ì„¸ìš”"
                            className="w-full h-20 p-2 text-sm border border-indigo-300 rounded resize-none focus:outline-none focus:ring-2 focus:ring-indigo-500"
                          />
                        </div>
                      </div>
                    </div>

                    {/* ìƒë‹´ ì™„ë£Œ ë²„íŠ¼ */}
                    <div className="flex gap-3">
                      <Button onClick={handleSaveDraft} className="flex-1" variant="outline">
                        ì„ì‹œ ì €ì¥
                      </Button>
                      <Button onClick={loadDraft} className="flex-1" variant="outline">
                        ì„ì‹œ ì €ì¥ ë¶ˆëŸ¬ì˜¤ê¸°
                      </Button>
                      <Button onClick={handleCompleteSession} className="flex-1" disabled={sessionStatus === "ì¤€ë¹„"}>
                        ìƒë‹´ ì™„ë£Œ
                      </Button>
                    </div>
                  </div>
                </CardContent>
              </Card>
            </div>
          </div>
        </main>
      </div>
    )
  }

  return (
    <div className="min-h-screen bg-background">
      {/* Header */}
      <header className="bg-card border-b border-border px-4 py-4">
        <div className="max-w-6xl mx-auto flex items-center justify-between">
          <div className="flex items-center gap-4">
            <Button variant="ghost" size="icon" onClick={onBack}>
              <ArrowLeft className="h-5 w-5" />
            </Button>
            <div>
              <h1 className="text-2xl font-bold text-primary">ìƒë‹´í•˜ê¸°</h1>
              <p className="text-sm text-muted-foreground">ì–´ë¥´ì‹  ë¦¬ìŠ¤íŠ¸ ë° AI ê°€ì´ë“œ</p>
            </div>
          </div>
        </div>
      </header>

      <main className="max-w-6xl mx-auto px-4 py-6">
        {/* Search and Filter */}
        <div className="flex gap-4 mb-6">
          <div className="flex-1 relative">
            <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground" />
            <Input
              placeholder="ì–´ë¥´ì‹  ì´ë¦„ìœ¼ë¡œ ê²€ìƒ‰..."
              value={searchTerm}
              onChange={(e) => setSearchTerm(e.target.value)}
              className="pl-10"
            />
          </div>
          <div className="flex gap-2">
            {["ì „ì²´", "ë†’ìŒ", "ë³´í†µ", "ë‚®ìŒ"].map((priority) => (
              <Button
                key={priority}
                variant={filterPriority === priority ? "default" : "outline"}
                size="sm"
                onClick={() => setFilterPriority(priority as any)}
              >
                {priority}
              </Button>
            ))}
          </div>
        </div>

        {/* Client Grid */}
        <div className="grid gap-4 md:grid-cols-2 lg:grid-cols-3">
          {filteredClients.map((client) => (
            <Card
              key={client.id}
              className="hover:shadow-md transition-shadow cursor-pointer"
              onClick={() => setSelectedClient(client)}
            >
              <CardContent className="p-6">
                <div className="flex items-center gap-4 mb-4">
                  <Avatar className="h-12 w-12">
                    <AvatarImage src={client.photo || "/placeholder.svg"} />
                    <AvatarFallback>{client.name.charAt(0)}</AvatarFallback>
                  </Avatar>
                  <div className="flex-1">
                    <h3 className="font-semibold">{client.name}</h3>
                    <p className="text-sm text-muted-foreground">{client.age}ì„¸</p>
                  </div>
                  <Badge variant={client.priority === "ë†’ìŒ" ? "destructive" : "default"} className="text-xs">
                    {client.priority}
                  </Badge>
                </div>

                <div className="space-y-2 mb-4">
                  <div className="flex items-center gap-2">
                    <Phone className="h-3 w-3 text-muted-foreground" />
                    <span className="text-xs">{client.phone}</span>
                  </div>
                  <div className="flex items-center gap-2">
                    <User className="h-3 w-3 text-muted-foreground" />
                    <span className="text-xs">ë³´í˜¸ì: {client.guardian.name}</span>
                  </div>
                  <div className="flex items-center gap-2">
                    <Calendar className="h-3 w-3 text-muted-foreground" />
                    <span className="text-xs">ìµœê·¼ ë°©ë¬¸: {client.lastVisit}</span>
                  </div>
                </div>

                <div className="p-3 bg-muted/50 rounded-lg">
                  <div className="flex items-center justify-between mb-2">
                    <span className="text-xs font-medium">ì •ì„œ ìƒíƒœ</span>
                    <div className="flex items-center gap-1">
                      {getTrendIcon(client.emotionalState.trend)}
                      <Badge className={`text-xs ${getEmotionalStateColor(client.emotionalState.current)}`}>
                        {client.emotionalState.current}
                      </Badge>
                    </div>
                  </div>
                  <p className="text-xs text-muted-foreground">{client.emotionalState.summary}</p>
                </div>
              </CardContent>
            </Card>
          ))}
        </div>
      </main>
    </div>
  )
})

export { ClientManagement }

